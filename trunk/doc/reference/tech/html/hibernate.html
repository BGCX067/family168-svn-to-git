<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>&#31532;&nbsp;4&nbsp;&#31456;&nbsp;Hibernate</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.2"><style type="text/css">
body { background-image: url('images/draft.png');
       background-repeat: no-repeat;
       background-position: top left;
       /* The following properties make the watermark "fixed" on the page. */
       /* I think that's just a bit too distracting for the reader... */
       /* background-attachment: fixed; */
       /* background-position: center center; */
     }</style><link rel="start" href="index.html" title="Leona"><link rel="up" href="index.html" title="Leona"><link rel="prev" href="spring.html" title="&#31532;&nbsp;3&nbsp;&#31456;&nbsp;Spring"><link rel="next" href="springsecurity.html" title="&#31532;&nbsp;5&nbsp;&#31456;&nbsp;Spring Security&#26435;&#38480;&#31649;&#29702;&#65288;&#24453;&#25972;&#29702;&#65289;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns="http://www.w3.org/TR/xhtml1/transitional" xmlns:fo="http://www.w3.org/1999/XSL/Format" style="background-color:white;border:none;height:73px;border:1px solid black;"><a style="border:none;" href="http://www.family168.com/" title="Family168"><img src="images/family168.png" border="0"></img></a></div><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">&#31532;&nbsp;4&nbsp;&#31456;&nbsp;Hibernate</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="spring.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="springsecurity.html">&#19979;&#19968;&#39029;</a></td></tr></table><hr></div><div class="chapter" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title"><a name="hibernate"></a>&#31532;&nbsp;4&nbsp;&#31456;&nbsp;Hibernate</h2></div></div></div><p>&#24863;&#35273;&#26159;&#30446;&#21069;&#26368;&#25104;&#29087;&#30340;ORM&#26694;&#26550;&#65292;&#23478;&#26063;&#20013;&#26032;&#28155;&#20102;hibernate-shards&#25903;&#25345;&#22810;&#25968;&#25454;&#24211;&#35775;&#38382;&#65292;hibernate-search&#25552;&#20379;&#20840;&#25991;&#26816;&#32034;&#65292;&#22823;&#26377;&#28508;&#21147;&#21487;&#25366;&#12290;</p><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e608"></a>4.1.&nbsp;&#22522;&#20110;annotation&#30340;JPA&#24335;&#37197;&#32622;</h2></div></div></div><p>&#22312;spring&#20013;&#37197;&#32622;&#65306;</p><pre class="programlisting">
sessionFactory&#30340;&#31867;&#22411;&#25913;&#20026;org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean
        </pre><p>&#20351;&#29992;spring-2.5.6&#20013;&#26032;&#21152;&#30340;packagesToScan&#23545;&#25972;&#20010;&#30446;&#24405;&#19979;&#30340;&#31867;&#36827;&#34892;&#25195;&#25551;&#65292;&#36825;&#26679;&#23601;&#19981;&#29992;&#22312;annotatedClasses&#20013;&#20889;&#19968;&#38271;&#20018;&#31867;&#21517;&#20102;&#12290;</p><pre class="programlisting">
&lt;property name="packagesToScan"&gt;
    &lt;list&gt;
        &lt;value&gt;com.family168.domain&lt;/value&gt;
    &lt;/list&gt;
&lt;/property&gt;
        </pre><p>&#23545;&#20110;jbpm&#36825;&#31181;&#20351;&#29992;xml&#26144;&#23556;&#30340;&#24037;&#31243;&#65292;&#36824;&#38656;&#35201;&#37197;&#32622;mappingLocations&#12290;</p><pre class="programlisting">
&lt;property name="mappingLocations"&gt;
    &lt;value&gt;classpath*:/org/jbpm/**/*.hbm.xml&lt;/value&gt;
&lt;/property&gt;
        </pre><pre class="programlisting">package com.family168.domain;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;


@Entity
public class User {
    private Long id;
    private String name;

    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    @Column
    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
        </pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">&#25552;&#31034;</h3>&#22914;&#26524;pojo&#35201;&#23450;&#20041;getter&#26041;&#27861;&#65292;&#36825;&#20010;&#26041;&#27861;&#25968;&#25454;&#24211;&#30340;&#25345;&#20037;&#23383;&#27573;&#27809;&#26377;&#20851;&#32852;&#65292;&#24517;&#39035;&#20351;&#29992;@Transient&#26631;&#27880;&#65292;&#21542;&#21017;hibernate&#20250;&#25226;&#23427;&#24403;&#20316;&#19968;&#20010;&#25345;&#20037;&#23383;&#27573;&#65292;&#21435;&#25968;&#25454;&#24211;&#35835;&#21462;&#30340;&#26102;&#20505;&#20250;&#25253;&#38169;&#12290;</div></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e618"></a>4.2.&nbsp;Hibernate&#25903;&#25345;&#30340;&#20851;&#31995;&#27169;&#22411;</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>&#19968;&#23545;&#22810;&#65292;&#20351;&#29992;&#22806;&#38190;&#36827;&#34892;&#34920;&#38388;&#20851;&#32852;</p><p>&#35265;com.family168.domain.Parent&#21644;com.family168.domain.Child</p></li><li><p>&#19968;&#23545;&#19968;&#65292;&#20351;&#29992;&#22806;&#38190;&#36827;&#34892;&#34920;&#38388;&#20851;&#32852;&#65288;&#22312;&#23376;&#34920;&#20351;&#29992;&#20027;&#38190;&#19982;&#22806;&#38190;&#32467;&#21512;&#30340;&#26041;&#24335;&#19981;&#22815;&#28789;&#27963;&#65289;</p><p>&#25105;&#20204;&#20351;&#29992;&#30340;&#26041;&#27861;&#26159;&#22312;&#22806;&#38190;&#19978;&#21152;&#21807;&#19968;&#32422;&#26463;&#65292;&#35265;com.family168.domain.Father&#21644;com.family168.domain.Mother</p></li><li><p>&#22810;&#23545;&#22810;&#65292;&#20351;&#29992;&#36830;&#25509;&#34920;&#36827;&#34892;&#34920;&#38388;&#20851;&#32852;</p><p>&#35265;com.family168.domain.Role&#21644;com.family168.domain.Resc</p></li><li><p>&#32487;&#25215;&#65292;&#21253;&#25324;&#19968;&#34920;&#22810;&#31867;&#65292;&#27599;&#34920;&#19968;&#31867;&#65292;&#19968;&#20027;&#34920;&#22810;&#23383;&#34920;&#31561;&#24418;&#24335;</p><p>&#23578;&#26410;&#29992;&#21040;&#12290;&#20043;&#21069;&#29992;&#36807;&#19968;&#27425;&#65292;&#19968;&#34920;&#22810;&#31867;&#65292;&#19981;&#30693;&#22914;&#20309;&#30452;&#25509;&#21462;&#24471;&#23376;&#31867;&#25968;&#25454;&#12290;</p></li></ul></div></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e633"></a>4.3.&nbsp;Hibernate&#24212;&#29992;&#22791;&#27880;</h2></div></div></div><p>&#22312;&#20351;&#29992;Hibernate&#26102;&#65292;&#38656;&#35201;&#27880;&#24847;&#30340;&#19968;&#20123;&#26041;&#38754;&#12290;</p><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e636"></a>4.3.1.&nbsp;Open Session In View</h3></div></div></div><p>&#21152;&#19968;&#20010;Spring&#24102;&#30340;Filter&#26159;&#26368;&#31616;&#21333;&#36890;&#29992;&#30340;&#26041;&#27861;</p><pre class="programlisting">
&lt;filter&gt;
    &lt;filter-name&gt;hibernateFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.orm.hibernate3.support.OpenSessionInViewFilter&lt;/filter-class&gt;
&lt;/filter&gt;
            </pre><pre class="programlisting">
&lt;filter-mapping&gt;
    &lt;filter-name&gt;hibernateFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
            </pre></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e641"></a>4.3.2.&nbsp;Event Listener</h3></div></div></div><p>&#21442;&#32771;com.family168History.EventListener, &#22312;&#23545;&#35937;&#30340;update,delete,post-update&#31561;&#20107;&#20214;&#20013;&#21152;&#20837;AOP&#29305;&#24615;.</p><p>&#23427;&#31867;&#20284;&#20110;&#25968;&#25454;&#24211;&#20013;&#30340;trigger&#65292;&#21487;&#20197;&#25318;&#25130;&#21040;&#23545;&#35937;&#30340;&#29983;&#21629;&#21608;&#26399;&#20107;&#20214;&#65292;&#32780;&#19988;&#33021;&#25343;&#21040;&#35832;&#22914;update&#21069;&#21518;&#30340;&#25968;&#25454;&#65292;&#20256;&#32479;&#30340;&#26041;&#24335;&#38656;&#35201;&#20197;&#26041;&#27861;&#25191;&#34892;&#21069;&#21518;&#20026;Point Cut&#20351;&#29992;AOP&#25318;&#25130;&#65292;&#32780;&#25968;&#25454;&#24211;trigger&#21017;&#38656;&#35201;&#27599;&#20010;&#34920;&#20889;&#19968;&#27425;trigger&#65292;&#38590;&#20110;&#31649;&#29702;&#65292;&#36798;&#19981;&#21040;Event Listener&#25209;&#37327;&#22788;&#29702;&#30340;&#25928;&#26524;&#12290;</p><p>Event Listener&#22312;&#25209;&#37327;&#22788;&#29702;&#26102;&#65292;&#19968;&#33324;&#35774;&#35745;&#35753;&#22788;&#29702;&#26041;&#27861;&#30456;&#21516;&#30340;POJO&#23454;&#29616;&#21516;&#19968;&#20010;&#25509;&#21475;&#65292;&#28982;&#21518;&#23601;&#21487;&#20197;&#22312;Event Listener&#37324;&#23601;&#20197;if(pojo instance of MyEventInterface)&#26469;&#21306;&#20998;&#22788;&#29702;&#12290;</p></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e646"></a>4.3.3.&nbsp;&#26597;&#35810;&#36820;&#22238;Map</h3></div></div></div><pre class="programlisting">
String hql = "select new map(goods.goodsNo as goodsNo,goods.code as code) from Goods goods";
// &#21363;&#21487;&#20197;&#29992;Map&#36827;&#34892;&#35775;&#38382;
Map goods = (Map) list.get(0);
String code = (String) goods.get("code");
            </pre><p>&#36825;&#26679;&#21487;&#20197;&#36991;&#20813;&#19968;&#20123;N+1&#30340;&#38382;&#39064;&#65292;&#23545;&#27604;&#30452;&#25509;&#29992;result[0],result[1]&#35775;&#38382;&#30340;&#24656;&#24598;&#20889;&#27861;&#65292;&#25110;&#32773;&#23450;&#20041;&#19968;&#20010;&#26032;pojo&#30340;&#32321;&#29712;&#65292;&#36820;&#22238;map&#27604;&#36739;&#25240;&#34935;&#12290;</p></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e650"></a>4.3.4.&nbsp;&#38480;&#21046;&#20462;&#25913;</h3></div></div></div><p>&#35774;&#32622;@Column(updatable = false)&#65292;&#21017;&#35813;&#23646;&#24615;&#25554;&#20837;&#25968;&#25454;&#24211;&#21518;&#19981;&#21487;&#20462;&#25913;&#12290;&#36825;&#20010;&#23383;&#27573;&#19981;&#20250;&#20986;&#29616;&#22312;update&#35821;&#21477;&#20013;&#12290;</p><p>&#36820;&#22238;Collection&#26102;&#35774;&#32622;unmodifiable&#65292;&#22914;&#65306;</p><pre class="programlisting">
public Set&lt;Category&gt; getCategories() {
    return Collections.unmodifiableSet(categories);
}
            </pre></div></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e655"></a>4.4.&nbsp;&#20108;&#32423;&#32531;&#23384;</h2></div></div></div><p>hibernate&#30340;session&#25552;&#20379;&#20102;&#19968;&#32423;&#32531;&#23384;&#65292;&#22312;&#21516;&#19968;&#20010;session&#20013;&#23545;&#21516;&#19968;&#20010;id&#30340;&#23545;&#35937;load&#20004;&#27425;&#65292;&#24182;&#19981;&#20250;&#21457;&#36865;&#20004;&#26465;sql&#32473;&#25968;&#25454;&#24211;&#12290;session&#20851;&#38381;&#30340;&#26102;&#20505;&#65292;&#19968;&#32423;&#32531;&#23384;&#23601;&#22833;&#25928;&#20102;&#12290;&#22914;&#26524;&#24076;&#26395;&#36328;session&#20351;&#29992;&#32531;&#23384;&#65292;&#23601;&#38656;&#35201;&#20026;hibernate&#37197;&#32622;&#20108;&#32423;&#32531;&#23384;&#12290;</p><p>&#20108;&#32423;&#32531;&#23384;&#26159;SessionFactory&#32423;&#21035;&#30340;&#20840;&#23616;&#32531;&#23384;&#65292;&#23427;&#25903;&#25345;&#19981;&#21516;&#30340;&#32531;&#23384;&#31867;&#24211;&#65292;&#27604;&#22914;ehcache&#12289;oscache&#31561;&#65292;&#20351;&#29992;&#26102;&#38656;&#35201;&#37197;&#32622;&#23545;&#24212;&#30340;&#32531;&#23384;&#23454;&#29616;&#26041;&#26696;&#12290;</p><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e659"></a>4.4.1.&nbsp;&#22522;&#26412;&#35774;&#32622;</h3></div></div></div><p>&#25226;&#19968;&#20010;ehcache.xml&#25991;&#20214;&#25335;&#36125;&#21040;classpath&#19979;&#65292;&#22312;hibernate.properties&#21152;&#19978;</p><pre class="programlisting">
hibernate.cache.use_query_cache=true
hibernate.cache.provider_class=org.hibernate.cache.EhCacheProvider
            </pre><p>applicationContext.xml&#30340;&lt;property name="hibernateProperties"&gt;&#19979;&#21152;&#19978;</p><pre class="programlisting">
&lt;prop key="hibernate.cache.use_query_cache"&gt;${hibernate.cache.use_query_cache}&lt;/prop&gt;
&lt;prop key="hibernate.cache.provider_class"&gt;${hibernate.cache.provider_class}&lt;/prop&gt;
            </pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">&#27880;&#24847;</h3><p>&#22914;&#26524;&#19981;&#24819;&#25226;ehcache.xml&#30452;&#25509;&#25918;&#22312;classpath&#19979;&#65292;&#21487;&#20197;&#20351;&#29992;hibernate.cache.provider_configuration_file_resource_path&#37197;&#32622;ehcache.xml&#25152;&#22312;&#30340;&#36335;&#24452;&#65292;&#27604;&#22914;/cache/ehcache.xml&#65292;&#36825;&#37324;&#25105;&#20204;&#25226;ehcahce.xml&#25918;&#22312;classpath&#19979;&#30340;cache&#30446;&#24405;&#19979;&#12290;</p><p>ehcache&#25552;&#20379;&#20102;&#19968;&#20010;&#20849;&#20139;CacheManager&#30340;&#26041;&#27861;&#65292;&#25105;&#20204;&#27599;&#27425;&#21487;&#20197;&#35843;&#29992;CacheManager&#30340;create()&#26041;&#27861;&#33719;&#24471;&#21333;&#20363;&#65292;&#32780;&#19981;&#38656;&#35201;&#27599;&#27425;new&#19968;&#20010;&#26032;&#30340;CacheManager&#23454;&#20363;&#65292;&#22312;spring&#20013;&#65292;&#21487;&#20197;&#20026;org.springframework.cache.ehcache.EhCacheManagerFactoryBean&#37197;&#32622;shared=true&#26469;&#21551;&#29992;&#36825;&#20010;&#21151;&#33021;&#12290;&#32780;&#22312;hibernate&#30340;svn&#20013;&#21487;&#20197;&#30475;&#21040;&#19968;&#20010;org.hibernate.cache.SingletonEhCacheProvider&#65292;&#23427;&#37324;&#38754;&#20063;&#26159;&#20351;&#29992;create()&#26469;&#33719;&#24471;&#21333;&#20363;&#30340;&#65292;&#21487;&#24796;&#22312;&#29616;&#22312;&#21457;&#24067;&#30340;3.3.1.GA&#20013;&#36824;&#27809;&#26377;&#21253;&#21547;&#36825;&#20010;&#31867;&#12290;</p></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e668"></a>4.4.2.&nbsp;Entity&#32423;&#20108;&#32423;&#32531;&#23384;</h3></div></div></div><p>Entity&#20108;&#32423;&#32531;&#23384;&#26159;&#25226;PO&#25918;&#36827;cache&#65292;&#29992;PO&#30340;id&#20316;&#20026;key&#65292;&#29992;PO&#30340;&#23454;&#20363;&#20316;&#20026;value&#36827;&#34892;&#32531;&#23384;&#12290;</p><p>&#22240;&#20026;&#36824;&#27809;&#26377;&#32463;&#36807;&#35814;&#32454;&#30340;&#27979;&#35797;&#65292;&#25105;&#20204;&#29616;&#22312;&#21807;&#19968;&#30830;&#35748;&#30340;&#21482;&#26377;load()&#26041;&#27861;&#26159;&#32943;&#23450;&#21487;&#20197;&#21033;&#29992;Entity&#32423;&#32531;&#23384;&#30340;&#65292;&#22312;&#23545;&#32423;&#32852;&#25968;&#25454;&#24310;&#36831;&#21152;&#36733;&#30340;&#26102;&#20505;&#20063;&#21487;&#20197;&#21033;&#29992;&#20108;&#32423;&#32531;&#23384;&#65292;&#19981;&#30693;&#36947;get()&#26041;&#27861;&#26159;&#21542;&#20063;&#21487;&#20197;&#21033;&#29992;&#21040;Entity&#32531;&#23384;&#30340;&#65292;&#24076;&#26395;&#21487;&#20197;&#65292;&#36825;&#26679;&#23601;&#21487;&#20197;&#30465;&#21435;&#25105;&#20204;&#24456;&#22810;&#24456;&#22810;&#30340;&#40635;&#28902;&#20102;&#12290;</p><p>&#22312;POJO&#20013;&#28155;&#21152;&#32531;&#23384;&#30340;&#27880;&#35299;&#65306;</p><pre class="programlisting">
@Entity
@Table(name = "MENU")
@Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE)
public class Menu extends LongTreeNode&lt;Menu&gt; {
            </pre><p>&#22914;&#26524;&#20320;&#20351;&#29992;&#30340;&#20108;&#32423;&#32531;&#23384;&#23454;&#29616;&#26159;ehcache&#30340;&#35805;&#65292;&#38656;&#35201;&#37197;&#32622;ehcache.xml&#65292;&#21542;&#21017;ehcache&#20250;&#20351;&#29992;&#40664;&#35748;&#30340;&#37197;&#32622;</p><pre class="programlisting">
&lt;cache name="com.family168.domain.Category"
    maxElementsInMemory="500"
    eternal="false"
    timeToLiveSeconds="7200"
    timeToIdleSeconds="3600"
    overflowToDisk="true" /&gt;
            </pre></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e676"></a>4.4.3.&nbsp;Collection&#20108;&#32423;&#32531;&#23384;</h3></div></div></div><p>&#20809;&#20026;Entity&#37197;&#32622;&#20102;&#20108;&#32423;&#32531;&#23384;&#36824;&#19981;&#22815;&#65292;&#23545;&#20110;&#19968;&#23545;&#19968;&#65292;&#19968;&#23545;&#22810;&#65292;&#22810;&#23545;&#22810;&#36825;&#31867;&#30340;&#32423;&#32852;&#23545;&#35937;&#65292;&#36824;&#38656;&#35201;&#37197;&#32622;Collection&#32531;&#23384;&#12290;&#29992;&#27861;&#23601;&#26159;&#22312;Collection&#23646;&#24615;&#37096;&#20998;&#28155;&#21152;Cache&#27880;&#35299;&#12290;</p><pre class="programlisting">
/** * @return children. */
@OneToMany(cascade = CascadeType.ALL, fetch = FetchType.LAZY, mappedBy = "parent")
@OrderBy("theSort asc, id desc")
@Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE)
public Set&lt;Menu&gt; getChildren() {
    return children;
}
            </pre><p>&#36824;&#35201;&#22312;ehcache.xml&#20013;&#28155;&#21152;&#23545;&#24212;&#30340;&#37197;&#32622;</p><pre class="programlisting">
&lt;cache name="com.family168.leona.security.domain.Menu.children"
    maxElementsInMemory="1000"
    eternal="false"
    timeToLiveSeconds="7200"
    timeToIdleSeconds="3600"
    overflowToDisk="true" /&gt;
            </pre><p>&#27880;&#24847;cache&#30340;name&#65292;&#26159;&#30001;&#20840;&#31867;&#21517;&#21152;&#19978;Collection&#30340;&#23646;&#24615;&#21517;&#32452;&#25104;&#30340;&#12290;</p></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e683"></a>4.4.4.&nbsp;&#26597;&#35810;&#32531;&#23384;</h3></div></div></div><p>&#19978;&#38754;&#30340;&#20108;&#32423;&#32531;&#23384;&#26159;&#38024;&#23545;&#21333;&#20010;&#23545;&#35937;&#30340;&#65292;&#22914;&#26524;&#35201;&#23545;&#26597;&#35810;&#32467;&#26524;&#65292;&#21017;&#26159;&#29992;&#19979;&#38754;&#30340;&#35821;&#21477;</p><pre class="programlisting">
query.setCacheable(true);//&#28608;&#27963;&#26597;&#35810;&#32531;&#23384;
query.setCacheRegion("categoryCacheRegion");//&#25351;&#23450;&#35201;&#20351;&#29992;&#30340;cacheRegion&#65292;&#21487;&#36873;
            </pre><p>cacheRegion&#26159;&#21487;&#36873;&#30340;&#65292;&#21487;&#20197;&#23545;&#20351;&#29992;&#30340;&#32531;&#23384;&#36827;&#34892;&#29305;&#27530;&#35774;&#32622;&#65292; &#22312;ehcahe.xml&#37324;&#35201;&#34917;&#19978;&#19979;&#38754;&#30340;&#19968;&#27573;&#12290;</p><pre class="programlisting">
&lt;cache name="categoryCacheRegion"
    maxElementsInMemory="10"
    eternal="false"
    timeToIdleSeconds="3600"
    timeToLiveSeconds="7200"
    overflowToDisk="true" /&gt;
            </pre><p>&#23545;&#20110;Query&#20108;&#32423;&#32531;&#23384;&#65292;&#23427;&#26159;&#20351;&#29992;hql&#21644;&#21442;&#25968;&#31561;&#20026;key&#65292;List&#20026;value&#23454;&#29616;&#32531;&#23384;&#65292;&#26242;&#26102;&#36824;&#19981;&#30830;&#23450;&#23427;&#37324;&#38754;&#30340;&#23545;&#35937;&#19982;Entity&#21644;Collection&#20013;&#32531;&#23384;&#30340;&#23545;&#35937;&#26159;&#21542;&#33021;&#33258;&#21160;&#20445;&#35777;&#21516;&#27493;&#65292;&#36824;&#26377;&#19968;&#31181;&#35828;&#27861;&#26159;&#22312;&#26597;&#35810;&#30340;&#31532;&#19968;&#27425;&#20351;&#29992;List&#65292;&#25226;&#25968;&#25454;&#37117;&#25628;&#32034;&#20986;&#26469;&#65292;&#20197;&#21518;&#20877;&#20351;&#29992;Iterator&#21033;&#29992;&#20108;&#32423;&#32531;&#23384;&#36827;&#34892;&#25805;&#20316;&#12290;&#19981;&#30693;&#36947;&#36825;&#37324;&#35828;&#30340;Iterator&#21033;&#29992;&#30340;&#26159;Query&#20108;&#32423;&#32531;&#23384;&#36824;&#26159;Entity&#20108;&#32423;&#32531;&#23384;&#12290;</p></div><p>&#30475;&#23436;&#20102;hibernate&#20013;&#30340;&#19977;&#31867;&#20108;&#32423;&#32531;&#23384;&#65292;&#22312;&#32593;&#19978;&#25628;&#21040;&#24456;&#22810;&#31867;&#20284;&#30340;&#24086;&#23376;&#65292;&#24863;&#35273;&#20174;2004&#24180;&#21040;&#29616;&#22312;&#30340;5&#24180;&#26102;&#38388;&#37324;&#65292;&#23545;hibernate&#32531;&#23384;&#30340;&#30740;&#31350;&#19981;&#20294;&#27809;&#26377;&#28145;&#20837;&#21270;&#65292;&#21453;&#32780;&#24840;&#35265;&#24179;&#28129;&#65292;&#20284;&#20046;&#27809;&#26377;&#20154;&#22312;&#39033;&#30446;&#20013;&#23454;&#38469;&#20351;&#29992;&#36807;cache&#19968;&#26679;&#30340;&#24863;&#35273;&#65292;&#26368;&#22810;&#35265;&#21040;&#30340;&#23601;&#26159;Entity&#32531;&#23384;&#65292;&#19981;&#36807;&#25105;&#23545;&#36825;&#20123;&#32531;&#23384;&#30340;&#26356;&#26032;&#31574;&#30053;&#36824;&#26377;&#25152;&#24576;&#30097;&#65292;&#31350;&#31455;&#26159;&#21542;&#33021;&#22815;&#20445;&#35777;&#23454;&#26102;&#26356;&#26032;&#65292;&#26159;&#21542;&#26377;&#38656;&#35201;&#21608;&#26399;&#25163;&#24037;&#32500;&#25252;&#32531;&#23384;&#30340;&#24517;&#35201;&#65292;&#20877;&#21152;&#19978;2004&#24180;java&#19978;&#26377;&#20154;&#25552;&#20986;&#30340;&#38382;&#39064;&#65292;&#36825;&#19977;&#31867;&#32531;&#23384;&#20043;&#20013;&#30340;&#23545;&#35937;&#26159;&#21542;&#26159;&#21542;&#33021;&#20445;&#35777;&#21516;&#27493;&#31561;&#31561;&#12290;&#26368;&#21518;&#20063;&#27809;&#21150;&#27861;&#20102;&#35299;&#21040;read_only, nonstrict_read_write, read_write&#21644;transactional&#36825;&#22235;&#31867;&#32531;&#23384;&#20043;&#38388;&#30340;&#20915;&#23450;&#24615;&#24046;&#21035;&#65292;&#20171;&#20110;ehcache&#21482;&#25903;&#25345;&#21069;&#19977;&#31181;&#32531;&#23384;&#65292;&#20272;&#35745;&#22312;&#23454;&#38469;&#20351;&#29992;&#20013;&#23601;&#20808;&#36873;&#25321;read_write&#36825;&#19968;&#32423;&#21035;&#20102;&#12290;</p><p>&#26368;&#21518;&#25918;&#19978;&#19968;&#20010;log&#30340;&#37197;&#32622;&#65292;&#21487;&#20197;&#26597;&#30475;&#32531;&#23384;&#26159;&#21542;&#21629;&#20013;&#30340;&#26085;&#24535;&#20449;&#24687;&#12290;&#22914;&#26524;&#21629;&#20013;&#20102;&#65292;&#23601;&#20250;&#25171;&#21360;&#20986;hit&#26469;&#12290;</p><pre class="programlisting">
&lt;logger name="net.sf.ehcache" level="debug"&gt;
    &lt;appender-ref ref="FILE"/&gt;
&lt;/logger&gt;
&lt;logger name="org.hibernate.cache" level="debug"&gt;
    &lt;appender-ref ref="FILE"/&gt;
&lt;/logger&gt;
        </pre></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e693"></a>4.5.&nbsp;&#23545;Hibernate&#36827;&#34892;&#23553;&#35013;</h2></div></div></div><p>&#23545;Hibernate&#36827;&#34892;&#23553;&#35013;&#65292;&#20351;&#29992;&#27867;&#22411;&#35753;manager&#21482;&#38656;&#35201;&#32487;&#25215;&#36229;&#31867;&#23601;&#21487;&#20197;&#23454;&#29616;&#25152;&#26377;&#30340;&#22522;&#26412;&#21151;&#33021;&#12290;</p><pre class="programlisting">
public class UserManager extends HibernateEntityDao&lt;User&gt;
        </pre><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e697"></a>4.5.1.&nbsp;&#22522;&#26412;&#26041;&#27861;</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>public Object get(Serializable id)</p></li><li><p>public List getAll()</p></li><li><p>public void save(Object o)</p></li><li><p>public void removeById(Serializable id)</p></li><li><p>public void remove(Object o)</p></li><li><p>public List find(String hql, Object... values)</p></li><li><p>public Object findBy(String name,Object value)</p></li><li><p>public List findByLike(String name, Object value)</p></li><li><p>public T findUnique(String hql, Object... values)</p></li><li><p>public T findUniqueBy(String name, Object value)</p></li></ul></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e720"></a>4.5.2.&nbsp;&#20998;&#39029;&#26041;&#27861;</h3></div></div></div><p>&#25552;&#20379;Criteria&#21644;HQL&#20004;&#31181;&#26041;&#24335;&#30340;&#20998;&#39029;&#26041;&#27861;</p><div class="itemizedlist"><ul type="disc"><li><p>public Page pagedQuery(Criteria c, int pageNo, int pageNo)</p></li><li><p>public Page pagedQuery(String hql, int pageNo, int pageNo, Object... params)</p></li></ul></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">&#25552;&#31034;</h3><p>&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#65292;&#36825;&#37324;&#25552;&#20379;&#30340;&#20998;&#39029;&#26041;&#27861;&#20250;&#30452;&#25509;&#21435;&#25481;select&#65292;order by&#31561;&#23376;&#21477;&#65292;&#20250;&#36896;&#25104;&#22312;&#23376;&#21477;&#23545;&#26597;&#35810;&#32467;&#26524;&#36215;&#20316;&#29992;&#30340;&#26102;&#20505;&#20986;&#29616;&#38382;&#39064;&#65292;&#25454;&#35828;&#20986;&#29616;having&#23376;&#21477;&#30340;&#26102;&#20505;&#23601;&#26377;&#36825;&#20010;&#38382;&#39064;&#12290;&#21548;&#35828;bba96&#21487;&#20197;&#35299;&#20915;&#36825;&#20010;&#38382;&#39064;&#12290;</p></div><p>&#38656;&#35201;&#25552;&#19968;&#19979;&#65306;bba96&#65292;&#36825;&#26159;&#30001;&#22269;&#20154;&#24320;&#21457;&#30340;&#23553;&#35013;hibernate&#30340;&#32452;&#20214;&#65292;&#25454;&#38395;&#25552;&#20379;&#20102;&#24378;&#21147;&#21151;&#33021;&#65292;&#20294;&#26159;&#28304;&#20195;&#30721;&#19968;&#26080;&#27880;&#37322;&#65292;&#20108;&#26080;&#21333;&#20803;&#27979;&#35797;&#65292;&#35753;&#20154;&#26080;&#20174;&#19979;&#25163;&#12290;</p></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e731"></a>4.5.3.&nbsp;&#23545;Hibernate&#20570;&#20102;&#19977;&#23618;&#23553;&#35013;</h3></div></div></div><div class="orderedlist"><ol type="1"><li><p>&#31532;&#19968;&#23618;&#65306;HibernateGenericDao&#65292;&#22522;&#20110;spring&#30340;HibernateDaoSupport&#65292;&#20294;&#21152;&#20837;&#20102;&#20998;&#39029;&#20989;&#25968;&#19982;&#21508;&#31181;Finder&#20989;&#25968;&#65292;&#24182;&#20351;&#29992;&#27867;&#22411;&#36991;&#20813;&#20102;&#36820;&#22238;&#20540;&#24378;&#21046;&#31867;&#22411;&#36716;&#25442;&#12290;</p></li><li><p>&#31532;&#20108;&#23618;&#65306;HibernateEntityDao&#65292;&#22522;&#20110;HibernateGenericDao&#65292;&#29992;&#27867;&#22411;&#22768;&#26126;Dao&#25152;&#31649;&#29702;&#30340;Entity&#31867;&#65292;&#40664;&#35748;&#25317;&#26377;&#35813;entity&#30340;CRUD&#26041;&#27861;&#12290;</p></li><li><p>&#31532;&#19977;&#23618;&#65306;HibernateExtendDao&#65292;&#22522;&#20110;HibernateEntityDao&#65292;&#20027;&#35201;&#25193;&#23637;&#21508;&#31181;&#36873;&#25321;&#24615;&#30340;&#21151;&#33021;&#12290;</p></li></ol></div><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e740"></a>4.5.3.1.&nbsp;HibernateGenericDao</h4></div></div></div><p>&#22312;Spring HibernateDaoSupport&#22522;&#30784;&#19978;&#23553;&#35013;&#30340;DAO&#65292;&#21151;&#33021;&#22914;&#19979;&#65306;</p><div class="orderedlist"><ol type="1"><li><p>&#24212;&#29992;&#27867;&#22411;:&#20351;&#24471;find(), get() &#36825;&#20123;&#20989;&#25968;&#19981;&#20877;&#36820;&#22238;Object&#65292;&#32780;&#26159;&#36820;&#22238;T&#65292;&#19981;&#20877;&#38656;&#35201;&#24378;&#21046;&#31867;&#22411;&#36716;&#25442;&#12290;</p></li><li><p>&#25552;&#20379;&#21508;&#31181;finder&#30340;&#31616;&#20415;&#20989;&#25968;</p><p>&#24212;&#29992;&#20102;JDK5&#21487;&#21464;&#21442;&#25968;&#30340;hsql&#26597;&#35810;&#20989;&#25968;&#65306;List find(String hql, Object... values)&#65292;&#25903;&#25345;find(hql),find(hql, param1); find(hql,param1,param2);find(hql,new Object[] {param1,param2}) &#22235;&#31181;&#25509;&#21475;&#12290; </p><p>&#31616;&#21333;&#26597;&#35810;&#30340;&#31616;&#21270;&#20989;&#25968;&#65306;findBy(Class entityClass,String name,Object value) ,findUniqueBy(Class entityClass,String name, Object value),findByLike(Class entityClass,String name,Object value) </p></li><li><p>&#33719;&#24471;&#35774;&#32622;&#22909;&#30340;Query&#21644;Criteria&#65306;createQuery(String hql,Object... values)  &#21644; createCriteria(Class&lt;T&gt; entityClass,Criterion... criterions)</p><p>Spring&#24182;&#27809;&#26377;&#24456;&#22909;&#30340;&#25509;&#21475;&#23553;&#35013;&#25903;&#25345;firstResult, maxResult, fetchsize,cache,cacheRegion &#31561;&#22810;&#20010;&#26597;&#35810;&#21442;&#25968;&#65292;&#25152;&#20197;springside&#23425;&#24895;&#36820;&#22238;&#24050;&#35774;&#32622;&#22909;&#26597;&#35810;&#26465;&#20214;&#30340;Query&#21644;Criteria&#65292;&#35753;&#22823;&#23478;&#32487;&#32493;&#21097;&#19979;&#30340;&#21442;&#25968;&#35774;&#32622;&#65292;&#26368;&#21518;&#20877;&#25191;&#34892;list()&#65292;&#27880;&#24847;&#37027;&#20960;&#20010;&#21442;&#25968;&#21487;&#20197;&#36830;&#32493;&#35774;&#32622;&#30340;&#65292;&#22914;&#65306;</p><pre class="programlisting">
createQuery(hql,param1).setFirstResult(10).setMaxResult(20).list();
                        </pre></li><li><p>&#20998;&#39029;&#20989;&#25968;:Page pagedQuery(Criteria criteria, int pageNo, int pageSize) &#21644;Page pagedQuery(String hql, int pageNo, int pageSize, Object... args)</p><p>Page&#26159;&#33258;&#34892;&#23553;&#35013;&#20998;&#39029;&#31867;&#65292;&#20854;&#20013;&#26368;&#20027;&#35201;&#30340;&#23646;&#24615;&#26159;totalCount&#21644;result&#65292;pagedQuery&#19982;hibernate&#33258;&#36523;&#20998;&#39029;&#26597;&#35810;&#30340;&#24046;&#21035;&#26159;&#20808;&#36816;&#34892;&#19968;&#27425;count&#65292;&#33719;&#24471;&#31526;&#21512;&#26465;&#20214;&#30340;&#24635;&#35760;&#24405;&#25968;&#12290;</p><p>&#22914;&#26524;&#26597;&#35810;&#19981;&#38656;&#35201;&#24635;&#35760;&#24405;&#25968;&#65292;&#29992;&#26222;&#36890;&#30340;hibernate API&#65292;&#21152;&#19978;setFirstResult(),setMaxResult()&#23601;&#35299;&#20915;&#65292;&#19981;&#38656;&#35201;pagedQuery()&#12290;</p></li><li><p>&#21028;&#21035;&#23545;&#35937;&#23646;&#24615;&#22312;&#25968;&#25454;&#24211;&#20013;&#21807;&#19968;&#30340;&#20989;&#25968;:isUnique(Class&lt;T&gt; entityClass,Object entity,String names)&#12290;</p></li></ol></div></div><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e760"></a>4.5.3.2.&nbsp;HibernateEntityDao</h4></div></div></div><p>&#25152;&#26377;UserManager, RoleManager&#20043;&#31867;&#21482;&#31649;&#29702;&#19968;&#31867;&#23545;&#35937;&#30340;Manager&#31867;&#30340;&#22522;&#31867;&#65292;&#21482;&#38656;&#35201;&#22312;&#31867;&#23450;&#20041;&#22788;&#22768;&#26126;Entity&#31867;&#22411;&#21363;&#21487;</p><pre class="programlisting">
public class UserManager extends HibernateEntityDao&lt;Book&gt; {
}
                </pre><p>&#22914;&#26524;&#38656;&#35201;&#25805;&#20316;&#20854;&#20182;&#30340;Entity&#65292;&#27604;&#22914;UserManager&#21487;&#33021;&#38656;&#35201;&#22788;&#29702;Role&#65292;&#21487;&#20197;&#27880;&#20837;RoleManager&#12290;&#26080;&#38656;&#25285;&#24515;&#20107;&#21153;&#30340;&#38382;&#39064;&#65292;JavaEE&#30340;&#40664;&#35748;&#20107;&#21153;&#27169;&#22411;&#24050;&#33021;&#24456;&#22909;&#22788;&#29702;&#12290;</p><p>&#22914;&#26524;&#27809;&#26377;&#23545;&#24212;&#30340;RoleManager&#65292;&#25110;&#32773;&#21508;&#31181;&#21407;&#22240;&#19981;&#24819;&#27880;&#20837;&#30340;&#35805;&#65292;&#21487;&#20197;&#20351;&#29992;UserManager&#32487;&#25215;&#33258;HibernateGenericDao&#30340;&#24102;entityClass&#21442;&#25968;&#30340;&#20989;&#25968;&#26469;&#25805;&#20316;Role&#30340;&#22686;&#21024;&#25913;&#65292;&#22914;Role role = this.get(Role.class, 1);</p></div><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e766"></a>4.5.3.3.&nbsp;HibernateExtendDao</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>&#25903;&#25345;&#23545;&#35937;&#19981;&#33021;&#34987;&#30452;&#25509;&#21024;&#38500;&#65292;&#21482;&#33021;&#35774;&#32622;&#29366;&#24577;&#21015;&#20026;&#26080;&#25928;&#12290;</p><p>&#25509;&#21475;UndeleteableEntityOperation&#65292;&#23450;&#20041;&#20102;&#35201;&#25903;&#25345;&#27492;&#21151;&#33021;&#24517;&#39035;&#23454;&#29616;&#30340;&#20989;&#25968;&#12290;</p><p> &#21487;&#20197;&#26377;&#25509;&#21475;(UndeletableEntity)&#21644;annotation(@Undeletable)&#20004;&#31181;&#24418;&#24335;&#26469;&#23450;&#20041;&#26080;&#25928;&#21015;&#65292;annotation&#21015;&#24418;&#24335;&#36824;&#21487;&#20197;&#23450;&#20041;&#26631;&#35782;&#23545;&#35937;&#24050;&#21024;&#38500;&#30340;&#29366;&#24577;&#23646;&#24615;&#30340;&#21517;&#31216;&#65292;&#29992;&#25509;&#21475;&#21017;&#24517;&#39035;&#23454;&#29616;setStatus()&#25509;&#21475;&#65292;&#22312;&#37324;&#38754;&#25805;&#20316;&#23454;&#38469;&#30340;&#29366;&#24577;&#23646;&#24615;&#12290;</p></li><li><p>&#37325;&#36733;save()&#65292;&#22312;&#20445;&#23384;&#21069;&#20808;&#35843;&#29992;onValid() &#20989;&#25968;</p></li><li><p>&#22686;&#21152;find(Map map) &#25509;&#21475;</p><p> &#40664;&#35748;&#26597;&#25214;&#19982;map&#20013;&#20840;&#37096;&#26465;&#20214;&#30456;&#21516;&#30340;entity&#12290;</p><p>&#26465;&#20214;&#30340;&#27604;&#36739;&#36816;&#31639;&#31526;&#40664;&#35748;&#20026;&#30456;&#21516;&#65292;&#29992;&#25143;&#20063;&#21487;&#20197;&#20026;&#23646;&#24615;&#21517;&#21152;&#19978;like_&#65292;largerthen_ &#36825;&#26679;&#30340;&#21069;&#32512;&#65292;&#21017;&#20351;&#29992;&#30456;&#24212;&#30340;&#36816;&#31639;&#31526;&#20316;&#27604;&#36739;(&#26410;&#23436;&#25104;)</p></li></ul></div></div></div></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e779"></a>4.6.&nbsp;&#20351;&#29992;envers&#36827;&#34892;&#29256;&#26412;&#25511;&#21046;</h2></div></div></div><p>envers&#26159;jboss&#30340;&#19968;&#20010;&#39033;&#30446;&#65292;&#23427;&#21487;&#20197;&#23545;&#23454;&#20307;&#31867;&#36827;&#34892;&#29256;&#26412;&#25511;&#21046;&#65292;&#29992;&#27861;&#20381;&#28982;&#26159;annotation&#21152;listener&#65292;&#23427;&#20250;&#23545;&#27599;&#20010;&#23454;&#20307;&#31867;&#21019;&#24314;&#39069;&#22806;&#30340;&#25968;&#25454;&#24211;&#34920;&#12290;</p><p>&#20026;&#20102;&#30417;&#21548;&#29256;&#26412;&#26356;&#26032;&#65292;&#38656;&#35201;&#28155;&#21152;&#22914;&#19979;&#30417;&#21548;&#22120;&#65306;</p><pre class="programlisting">
&lt;property name="hibernate.ejb.event.post-insert" value="org.jboss.envers.event.VersionsEventListener" /&gt;
&lt;property name="hibernate.ejb.event.post-update" value="org.jboss.envers.event.VersionsEventListener" /&gt;
&lt;property name="hibernate.ejb.event.post-delete" value="org.jboss.envers.event.VersionsEventListener" /&gt;
&lt;property name="hibernate.ejb.event.pre-collection-update" value="org.jboss.envers.event.VersionsEventListener" /&gt;
&lt;property name="hibernate.ejb.event.pre-collection-remove" value="org.jboss.envers.event.VersionsEventListener" /&gt;
&lt;property name="hibernate.ejb.event.post-collection-recreate" value="org.jboss.envers.event.VersionsEventListener" /&gt;
        </pre><p>&#23454;&#20363;&#20195;&#30721;&#65306;</p><pre class="programlisting">
import org.jboss.versions.Versioned;

import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.GeneratedValue;
import javax.persistence.Column;

@Entity
@Versioned
public class Blog {
    @Id
    @Column(length=32)
    private String id;

    @Versioned
    @Column(length=100)
    private String title;

    @Column(length=2000)
    private String date;

    @Versioned
    @ManyToOne
    private String body;

    @ManyToOne
    private Author author;
    // add getters, setters, constructors, equals and hashCode here
}
        </pre><p>&#22914;&#20309;&#21462;&#24471;&#29256;&#26412;&#24211;&#30340;&#20449;&#24687;&#65306;</p><pre class="programlisting">
VersionsReader reader = VersionsReaderFactory.get(entityManager);

// get Blog all versions id
List&lt;Number&gt; versions = reader.getRevisions(Blog.class, "1"/*blog id*/);
for (Number version : versions) {
    Blog blog = reader.find(Blog.class, "1", version);
}
        </pre></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e788"></a>4.7.&nbsp;Spring JDBCTemplate</h2></div></div></div><p>&#24403;&#25253;&#34920;&#26597;&#35810;&#24517;&#39035;&#20351;&#29992;SQL&#26102;&#65292;&#22823;&#23478;&#26377;&#19977;&#31181;&#36873;&#25321;&#65306;</p><div class="orderedlist"><ol type="1"><li><p>&#20351;&#29992;Hibernate &#30340;sql &#26597;&#35810;&#20989;&#25968;&#23558;&#26597;&#35810;&#32467;&#26524;&#23545;&#35937;&#36716;&#20026;&#23545;&#35937;&#12290;</p></li><li><p>&#20351;&#29992;Hibernate session&#30340;getConnection &#33719;&#24471;JDBC Connection&#65292;&#28982;&#21518;&#36827;&#34892;&#32431;JDBC API&#25805;&#20316;&#12290;&#65288;getConnection()&#24050;&#32463;&#34987;&#24223;&#24323;&#20102;&#65289;</p></li><li><p>&#36873;&#25321;&#25226;JDBC Template&#20316;&#20026;&#19968;&#31181;&#24456;&#19981;&#38169;&#30340;JDBC Utils&#26469;&#20351;&#29992;&#12290;</p></li></ol></div><p>JDBCTemplate&#30340;&#20351;&#29992;&#24456;&#31616;&#21333;&#65292;&#21482;&#35201;&#22312;ApplicationContext&#25991;&#20214;&#37324;&#23450;&#20041;&#19968;&#20010;jdbcTemplate&#33410;&#28857;&#65292;POJO&#33719;&#24471;&#27880;&#20837;&#21518;&#21487;&#20197;&#30452;&#25509;&#25191;&#34892;&#25805;&#20316;&#65292;&#19981;&#38656;&#35201;&#32487;&#25215;&#20160;&#20040;&#22522;&#31867;&#65292;&#20855;&#20307;&#20363;&#23376;&#35265;&#38144;&#21806;&#25253;&#34920;&#26597;&#35810;&#31867;SaleReportManager&#65306;</p><pre class="programlisting">
&lt;bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate"&gt;
    &lt;property name="dataSource" ref="dataSource"/&gt;
&lt;/bean&gt;
        </pre><pre class="programlisting">
SqlRowSet rs = jdbcTemplate.queryForRowSet(sql, params);
        </pre><p>jdbcTemplate&#26377;&#24456;&#22810;&#30340;ORM&#21270;&#22238;&#35843;&#25805;&#20316;&#23558;&#36820;&#22238;&#32467;&#26524;&#36716;&#20026;&#23545;&#35937;&#21015;&#34920;&#65292;&#20294;&#24456;&#22810;&#26102;&#20505;&#36824;&#26159;&#38656;&#35201;&#36820;&#22238;ResultSet&#65292;Spring&#26377;&#25552;&#20379;&#19968;&#20010;&#31867;&#20284;ResultSet&#30340;&#65292;&#23454;&#29616;JDBC3.0 RowSet&#25509;&#21475;&#30340;Spring SqlRowSet&#12290;</p><p>&#27880;&#24847;jdbcTemplate&#23613;&#37327;&#21482;&#25191;&#34892;&#26597;&#35810;&#25805;&#20316;&#65292;&#33707;&#35201;&#36827;&#34892;&#26356;&#26032;&#65292;&#21542;&#21017;&#20250;&#30772;&#22351;Hibernate&#30340;&#20108;&#32423;&#32531;&#23384;&#20307;&#31995;&#12290;</p></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e803"></a>4.8.&nbsp;Spring Error Code &#32479;&#19968;&#32763;&#35793;</h2></div></div></div><p>Spring&#30340;Error Code&#32479;&#19968;&#32763;&#35793;&#26426;&#21046;&#25402;&#23454;&#29992;&#30340;&#65292;&#21487;&#20197;&#25226;&#21508;&#31181;&#25968;&#25454;&#24211;&#30340;&#21508;&#31181;Error Code&#20998;&#25104;&#20845;&#22823;&#31867;&#65292;&#20998;&#21035;&#36716;&#20026;6&#31181;&#24322;&#24120;&#25243;&#20986;&#65292;&#35753;&#20320;&#21487;&#20197;&#29992;&#24322;&#24120;&#25429;&#33719;&#26426;&#21046;&#25429;&#33719;&#33258;&#24049;&#24863;&#20852;&#36259;&#30340;&#24322;&#24120;&#12290;</p><p>&#27604;&#22914;&#25105;&#26368;&#20851;&#24515;&#30340;&#65292;&#23545;&#35937;&#22240;&#20026;&#26377;&#32423;&#32852;&#24341;&#29992;&#65292;&#19981;&#24212;&#35813;&#34987;&#21024;&#38500;&#30340;&#24773;&#20917;&#65292;&#23601;&#23646;&#20110;dataIntegrityViolation(&#25968;&#25454;&#26657;&#39564;)&#24322;&#24120;&#65292;&#21516;&#23646;&#20110;&#27492;&#30340;&#38169;&#35823;&#36824;&#26377;&#20540;&#30340;&#21807;&#19968;&#24615;&#22833;&#36133;&#31561;&#12290;&#36825;&#26679;&#65292;&#25105;&#22312;&#20195;&#30721;&#37324;&#21482;&#35201;&#25429;&#25417;DataInterityViolation&#23601;&#21487;&#20197;&#20102;&#65292;&#19981;&#29992;&#31649;&#20160;&#20040;&#25968;&#25454;&#24211;&#65292;&#20063;&#19981;&#29992;hard code&#20960;&#31181;&#38656;&#35201;&#21516;&#26679;&#22788;&#29702;&#30340;Error Code.</p><p>&#36825;&#20010;&#32763;&#35793;&#26426;&#21046;&#30340;&#37197;&#32622;&#24456;&#31616;&#21333;&#65292;spring&#24050;&#25552;&#20379;&#20102;&#40664;&#35748;&#30340;error code--&#24322;&#24120;&#24433;&#23556;&#34920;&#65292;&#20294;&#36824;&#19981;&#22815;&#23436;&#20840;&#65292;&#20320;&#21487;&#20197;&#23558;sql-error-codes.xml&#25991;&#20214;copy&#21040;src&#26681;&#30446;&#24405;&#65292;spring&#23601;&#20250;&#36716;&#21435;&#35835;&#20320;&#30340;&#21152;&#24378;&#29256;&#12290;</p><p>springside&#30340;src&#30446;&#24405;&#37324;&#26377;&#27492;&#37197;&#32622;&#25991;&#20214;&#65292;&#23545;hsqldb&#30340;error code&#20316;&#20102;&#21152;&#24378;&#65292;&#20320;&#25171;&#24320;&#26469;&#30475;&#19968;&#19979;&#23601;&#30693;&#36947;&#22914;&#20309;]&#37197;&#32622;&#30340;&#20102;&#12290;</p><pre class="programlisting">
&lt;bean id="HSQL" class="org.springframework.jdbc.support.SQLErrorCodes"&gt;
    &lt;property name="databaseProductName"&gt;
        &lt;value&gt;HSQL Database Engine&lt;/value&gt;
    &lt;/property&gt;
    &lt;property name="badSqlGrammarCodes"&gt;
        &lt;value&gt;-22,-28&lt;/value&gt;
    &lt;/property&gt;
        &lt;property name="dataIntegrityViolationCodes"&gt;
            &lt;value&gt;0,-8,-9&lt;/value&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
        </pre></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e810"></a>4.9.&nbsp;bba96 &#35828;&#26126;<span class="emphasis"><em>&#65288;&#24453;&#30740;&#31350;&#65289;</em></span></h2></div></div></div><p>&#20854;&#23454;&#27604;&#36739;&#38738;&#30544;bba96&#20013;&#30340;&#39640;&#32423;&#26597;&#35810;&#35821;&#27861;&#65292;&#22823;&#22823;&#31616;&#21270;&#20102;left join&#26597;&#35810;&#12290;&#25454;&#35828;&#23427;&#36824;&#35299;&#20915;&#20102;&#20998;&#39029;&#26597;&#35810;&#20013;having&#23376;&#21477;&#24433;&#21709;&#26597;&#35810;&#32467;&#26524;&#30340;&#38382;&#39064;&#65292;&#20294;&#26159;&#32456;&#22240;&#20026;&#32570;&#20047;&#27880;&#37322;&#21644;&#21333;&#20803;&#27979;&#35797;&#65292;&#36831;&#36831;&#26080;&#27861;&#21160;&#25163;&#12290;</p><p>&#22914;&#26524;&#20320;&#20351;&#29992;spring+hibernate&#65292;&#32780;&#21448;&#19981;&#21916;&#27426;hibernate criteria&#30340;&#40635;&#28902;&#65292;&#19981;&#22952;&#23581;&#35797;&#19968;&#19979;bba96&#65292;&#20316;&#20026;&#22522;&#20110;Hibernate+Spring&#30340;&#25345;&#20037;&#23618;&#30340;&#26550;&#26500;&#24212;&#29992;&#65292;&#23436;&#20840;&#21487;&#20197;&#29420;&#31435;&#21152;&#20837;&#21040;&#20320;&#30340;&#39033;&#30446;&#20013;&#65292;&#35753;&#20320;&#21487;&#20197;&#25226;&#20027;&#35201;&#31934;&#21147;&#25918;&#21040;&#19994;&#21153;&#26041;&#38754;&#12290;</p><p>com.bba96.tiger.service.DefaultEntityManager &#26159;&#20351;&#29992;&#26368;&#22810;&#30340;&#31867;&#65292;&#25552;&#20379;&#20102;&#24456;&#22810;&#21333;&#23618;&#36923;&#36753;&#30340;&#20415;&#21033;&#26041;&#27861;&#32473;&#20320;&#20351;&#29992;&#65292;&#20854;&#20013;&#20063;&#21253;&#25324;&#25191;&#34892;hsql&#25110;&#32773;sql&#26597;&#35810;/&#26356;&#26032;&#30340;&#26041;&#27861;&#65292;&#22914;&#26524;&#20320;&#35201;&#22810;&#23618;&#27425;&#36923;&#36753;&#30340;&#26465;&#20214;&#26597;&#35810;&#21487;&#20197;&#33258;&#24049;&#32452;&#35013;QueryObject&#65292;&#21442;&#35265;com.bba96.tiger.util.QueryWebUtils&#30340;main&#20989;&#25968;&#12290;</p><p>&#21516;&#26102;bba96&#36824;&#25552;&#20379;&#32473;&#20320;&#22312;view&#23618;&#33258;&#30001;&#22686;&#21152;&#26597;&#35810;&#30340;&#33021;&#21147;&#65292;&#20351;&#29992;&#36215;&#26469;&#24456;&#26041;&#20415;&#12290;&#20197;&#19979;&#23601;&#26159;SpringSide&#20013; org.springside.modules.webwork.action.SSActionSupport &#20351;&#29992;bba96&#23454;&#29616;&#26041;&#20415;&#30340;view&#26597;&#35810;&#30340;&#20363;&#23376;&#65306;</p><pre class="programlisting">
protected QueryWebParameter search;//&#23450;&#20041;&#25509;&#21463;&#26597;&#35810;&#21442;&#25968;&#30340;&#23545;&#35937;
public QueryWebParameter getSearch() {
    return search;
}
public void setSearch(QueryWebParameter search) {
    this.search = search;
}
public Page getPaginationResults() {
    //&#27492;&#22788;&#21487;&#23545;search&#22788;&#29702;&#65292;&#36827;&#34892;&#21442;&#25968;&#21024;&#20943;&#20197;&#23454;&#29616;&#28789;&#27963;&#30340;&#21151;&#33021;&#25110;&#26159;&#22686;&#24378;&#23433;&#20840;
    if (search == null) {
        search = new QueryWebParameter();
    }
    if (search.getPageSize() &lt;= 0) {
        search.setPageSize(Constants.DEFAULT_PAGE_SIZE);//&#35774;&#32622;&#40664;&#35748;&#27599;&#39029;&#35760;&#24405;&#25968;
    }
    return getEntityManager().findByWebParameter(getEntityClass(), search);//&#25191;&#34892;&#26597;&#35810;&#36820;&#22238;&#20998;&#39029;&#30340;&#32467;&#26524;
}
        </pre><p>action&#20013;&#23601;&#26159;&#19978;&#38754;&#36825;&#27573;&#35805;&#23601;&#21487;&#23545;&#25152;&#26377;&#30340;&#23545;&#35937;&#23454;&#29616;&#22522;&#26412;&#30340;&#26597;&#35810;&#21151;&#33021;&#12290;&#22312;jsp&#30340;&#35201;&#22686;&#21152;&#23545;&#24212;&#23383;&#27573;&#30340;&#26597;&#35810;&#21482;&#38656;&#36981;&#24490;&#20197;&#19979;&#20889;&#27861;&#65306;</p><p>&#23545;&#27599;&#20010;&#38656;&#35201;&#26597;&#35810;&#30340;&#23646;&#24615;&#35201;&#23450;&#20041;&#19977;&#20010;&#21464;&#37327;&#65292;search.name, search.operator, search.value</p><p>&#20854;&#20013;search&#23545;&#24212;&#19978;&#38754;&#30340;QueryWebParameter&#30340;&#21464;&#37327;search</p><p>name&#23545;&#24212;&#23646;&#24615;&#21517;</p><p>&#33509;&#26159;&#20851;&#32852;&#20854;&#23427;&#23545;&#35937;&#30340;&#38750;&#20027;&#38190;&#23646;&#24615;&#38656;&#29992;&#20882;&#21495;&#23450;&#20041;&#21035;&#21517;&#12290;</p><p>&#35268;&#21017; -- &#25551;&#36848;&#20851;&#32852;&#23545;&#35937;&#30340;&#23646;&#24615;:&#21035;&#21517;.&#35813;&#20851;&#32852;&#23545;&#35937;&#30340;&#23646;&#24615;</p><p>&#20030;&#20363; -- groups:g.name&#65292;&#25903;&#25345;&#22810;&#26497;&#21035;&#21517;&#65292;&#22914;groups.g.users:gu.name&#65292;&#36825;&#37324;gu&#23601;&#26159;g.users&#30340;&#21035;&#21517;</p><p>operator&#23545;&#24212;&#36923;&#36753;&#25805;&#20316;&#31526;&#65292;&#21442;&#32771;com.bba96.tiger.query.QueryParam</p><p>value&#23545;&#24212;&#20540;&#65292;&#40664;&#35748;&#20026;String&#31867;&#22411;&#65292;&#21487;&#22312;&#26368;&#21518;&#21152;&#19979;&#21010;&#32447;&#21152;&#31867;&#22411;&#22914;_Long&#25110;_Date?mm-DD</p><p>&#20855;&#20307;&#20889;&#27861;&#21442;&#35265;/webapps/ww/admin/book_list.ftl&#65292;&#20851;&#20110;&#26356;&#22810;view&#30340;&#36923;&#36753;&#65292;&#21442;&#35265;com.bba96.tiger.util.QueryWebUtils</p><p>&#22312;Spring&#20013;&#30340;&#37197;&#32622;&#20063;&#38750;&#24120;&#31616;&#21333;&#65292;&#22914;&#19979;&#25152;&#31034;&#65292;&#26356;&#26032;&#20449;&#24687;&#21442;&#35265;src/resources/applicationContext-webwork.xml</p><pre class="programlisting">
&lt;bean id="objectDao" class="com.bba96.tiger.dao.hibernate.HibernateObjectDAO"&gt;
    &lt;property name="sessionFactory"&gt;
        &lt;ref bean="sessionFactory"/&gt;
    &lt;/property&gt;
&lt;/bean&gt;
        </pre><pre class="programlisting">
&lt;bean id="defaultEntityManager" parent="baseTxService"&gt;
    &lt;property name="target"&gt;
        &lt;bean class="com.bba96.tiger.service.DefaultEntityManager"&gt;
            &lt;property name="objectDAO"&gt;
                &lt;ref local="objectDao"/&gt;
            &lt;/property&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
&lt;/bean&gt;
        </pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="spring.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="springsecurity.html">&#19979;&#19968;&#39029;</a></td></tr><tr><td width="40%" align="left" valign="top">&#31532;&nbsp;3&nbsp;&#31456;&nbsp;Spring&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">&#36215;&#22987;&#39029;</a></td><td width="40%" align="right" valign="top">&nbsp;&#31532;&nbsp;5&nbsp;&#31456;&nbsp;Spring Security&#26435;&#38480;&#31649;&#29702;<span class="emphasis"><em>&#65288;&#24453;&#25972;&#29702;&#65289;</em></span></td></tr></table></div></body></html>