<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>&#31532;&nbsp;12&nbsp;&#31456;&nbsp;&#20840;&#25991;&#26816;&#32034;</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.2"><style type="text/css">
body { background-image: url('images/draft.png');
       background-repeat: no-repeat;
       background-position: top left;
       /* The following properties make the watermark "fixed" on the page. */
       /* I think that's just a bit too distracting for the reader... */
       /* background-attachment: fixed; */
       /* background-position: center center; */
     }</style><link rel="start" href="index.html" title="Leona"><link rel="up" href="index.html" title="Leona"><link rel="prev" href="jms.html" title="&#31532;&nbsp;11&nbsp;&#31456;&nbsp;JMS"><link rel="next" href="timer.html" title="&#31532;&nbsp;13&nbsp;&#31456;&nbsp;&#20219;&#21153;&#35843;&#24230;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns="http://www.w3.org/TR/xhtml1/transitional" xmlns:fo="http://www.w3.org/1999/XSL/Format" style="background-color:white;border:none;height:73px;border:1px solid black;"><a style="border:none;" href="http://www.family168.com/" title="Family168"><img src="images/family168.png" border="0"></img></a></div><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">&#31532;&nbsp;12&nbsp;&#31456;&nbsp;&#20840;&#25991;&#26816;&#32034;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="jms.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="timer.html">&#19979;&#19968;&#39029;</a></td></tr></table><hr></div><div class="chapter" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title"><a name="search"></a>&#31532;&nbsp;12&nbsp;&#31456;&nbsp;&#20840;&#25991;&#26816;&#32034;</h2></div></div></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1637"></a>12.1.&nbsp;Lucene &#22522;&#30784;&#25351;&#21335;</h2></div></div></div><p>Lucene&#26159;apache&#19979;&#30340;&#19968;&#20010;&#37319;&#29992;java&#23454;&#29616;&#30340;&#20840;&#25991;&#25628;&#32034;&#24341;&#25806;&#65292;&#21151;&#33021;&#38750;&#24120;&#24378;&#22823;&#65292;&#32780;&#23427;&#30340;API&#21448;&#27604;&#36739;&#31616;&#21333;&#65292;&#20027;&#35201;&#23601;&#20570;&#20004;&#20214;&#20107;&#65306;&#24314;&#31435;&#32034;&#24341;&#21644;&#36827;&#34892;&#25628;&#32034;&#12290;</p><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1640"></a>12.1.1.&nbsp;&#24314;&#31435;&#32034;&#24341;&#30340;&#26415;&#35821;</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Document&#65306;&#19968;&#20010;&#38656;&#35201;&#36827;&#34892;&#32034;&#24341;&#30340;&#21333;&#20803;&#65292;&#30456;&#24403;&#20110;&#25968;&#25454;&#24211;&#30340;&#19968;&#34892;&#32426;&#24405;&#65292;&#20219;&#20309;&#24819;&#35201;&#34987;&#32034;&#24341;&#30340;&#25968;&#25454;&#65292;&#37117;&#24517;&#39035;&#36716;&#21270;&#20026;Document&#23545;&#35937;&#23384;&#25918;&#12290;</p></li><li><p>Field&#65306;Document&#20013;&#30340;&#19968;&#20010;&#23383;&#27573;&#65292;&#30456;&#24403;&#20110;&#25968;&#25454;&#24211;&#20013;&#30340;Column &#65292;Field&#26159;lucene&#20013;&#21547;&#20041;&#27604;&#36739;&#22810;&#30340;&#19968;&#20010;&#26415;&#35821;&#65292;&#35814;&#24773;&#35265;&#21518;&#12290;</p></li><li><p>IndexWriter&#65306;&#36127;&#36131;&#23558;Document&#20889;&#20837;&#32034;&#24341;&#25991;&#20214;&#12290;&#36890;&#24120;&#24773;&#20917;&#19979;,IndexWriter&#30340;&#26500;&#36896;&#20989;&#25968;&#21253;&#25324;&#20102;&#20197;&#19979;3&#20010;&#21442;&#25968;&#65306;&#32034;&#24341;&#23384;&#25918;&#30340;&#36335;&#24452;&#65292;&#20998;&#26512;&#22120;&#21644;&#26159;&#21542;&#37325;&#26032;&#21019;&#24314;&#32034;&#24341;&#12290;&#29305;&#21035;&#27880;&#24847;&#30340;&#19968;&#28857;&#65292;&#24403;IndexWriter&#25191;&#34892;&#23436;addDocument&#26041;&#27861;&#21518;&#65292;&#19968;&#23450;&#35201;&#35760;&#24471;&#35843;&#29992;&#33258;&#36523;&#30340;close&#26041;&#27861;&#26469;&#20851;&#38381;&#23427;&#12290;&#21482;&#26377;&#22312;&#35843;&#29992;&#20102;close&#26041;&#27861;&#21518;&#65292;&#32034;&#24341;&#22120;&#25165;&#20250;&#23558;&#23384;&#25918;&#22312;&#20869;&#22312;&#20013;&#30340;&#25152;&#26377;&#20869;&#23481;&#20889;&#20837;&#30913;&#30424;&#24182;&#20851;&#38381;&#36755;&#20986;&#27969;&#12290;</p></li><li><p>Analyzer&#65306;&#20998;&#26512;&#22120;&#65292;&#20027;&#35201;&#29992;&#20110;&#25991;&#26412;&#20998;&#35789;&#12290;&#24120;&#29992;&#30340;&#26377;StandardAnalyzer&#20998;&#26512;&#22120;&#65292;StopAnalyzer&#20998;&#26512;&#22120;&#65292;WhitespaceAnalyzer&#20998;&#26512;&#22120;&#31561;&#12290;</p></li><li><p>Directory&#65306;&#32034;&#24341;&#23384;&#25918;&#30340;&#20301;&#32622;&#12290;lucene&#25552;&#20379;&#20102;&#20004;&#31181;&#32034;&#24341;&#23384;&#25918;&#30340;&#20301;&#32622;&#65292;&#19968;&#31181;&#26159;&#30913;&#30424;&#65292;&#19968;&#31181;&#26159;&#20869;&#23384;&#12290;&#19968;&#33324;&#24773;&#20917;&#23558;&#32034;&#24341;&#25918;&#22312;&#30913;&#30424;&#19978;&#65307;&#30456;&#24212;&#22320;lucene&#25552;&#20379;&#20102;FSDirectory&#21644;RAMDirectory&#20004;&#20010;&#31867;&#12290;</p></li><li><p>&#27573;&#65306;Segment,&#26159;Lucene&#32034;&#24341;&#25991;&#20214;&#30340;&#26368;&#22522;&#26412;&#30340;&#19968;&#20010;&#21333;&#20301;&#12290;Lucene&#35828;&#21040;&#24213;&#23601;&#26159;&#19981;&#26029;&#21152;&#20837;&#26032;&#30340;Segment&#65292;&#28982;&#21518;&#25353;&#19968;&#23450;&#30340;&#35268;&#21017;&#31639;&#27861;&#21512;&#24182;&#19981;&#21516;&#30340;Segment&#20197;&#21512;&#25104;&#26032;&#30340;Segment&#12290;</p></li></ul></div><p>lucene&#24314;&#31435;&#32034;&#24341;&#30340;&#36807;&#31243;&#23601;&#26159;&#23558;&#24453;&#32034;&#24341;&#30340;&#23545;&#35937;&#36716;&#21270;&#20026;Lucene&#30340;Document&#23545;&#35937;&#65292;&#20351;&#29992;IndexWriter&#23558;&#20854;&#20889;&#20837;lucene&#33258;&#23450;&#20041;&#26684;&#24335;&#30340;&#32034;&#24341;&#25991;&#20214;&#20013;&#12290;</p><p>&#24453;&#32034;&#24341;&#30340;&#23545;&#35937;&#21487;&#20197;&#26469;&#33258;&#25991;&#20214;&#12289;&#25968;&#25454;&#24211;&#31561;&#20219;&#24847;&#36884;&#24452;&#65292;&#29992;&#25143;&#33258;&#34892;&#32534;&#30721;&#36941;&#21382;&#30446;&#24405;&#35835;&#21462;&#25991;&#20214;&#25110;&#32773;&#26597;&#35810;&#25968;&#25454;&#24211;&#34920;&#21462;&#24471;ResultSet&#65292;Lucene&#30340;API&#21482;&#36127;&#36131;&#21644;&#23383;&#31526;&#20018;&#25171;&#20132;&#36947;&#12290;</p><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e1657"></a>12.1.1.1.&nbsp;Field&#30340;&#21547;&#20041;</h4></div></div></div><p>Field&#30340;&#26500;&#36896;&#26041;&#27861;&#22914;&#19979;&#65306;</p><pre class="programlisting">
Field(String name, byte[] value, Field.Store store)
Field(String name, Reader reader)
Field(String name, Reader reader, Field.TermVector termVector)
Field(String name, String value, Field.Store store, Field.Index index)
Field(String name, String value, Field.Store store, Field.Index index, Field.TermVector termVector)
                </pre><p>&#22312;Field&#24403;&#20013;&#26377;&#19977;&#20010;&#20869;&#37096;&#31867;&#65306;Field.Index&#65292;Field.Store&#65292;Field.TermVector&#12290;&#20854;&#20013;</p><div class="itemizedlist"><ul type="disc"><li><p>Field.Index&#26377;&#20116;&#20010;&#23646;&#24615;&#65292;&#20998;&#21035;&#26159;&#65306;</p><div class="itemizedlist"><ul type="circle"><li><p>Field.Index.ANALYZED&#65306;&#20998;&#35789;&#32034;&#24341;</p></li><li><p>Field.Index.NOT_ANALYZED&#65306;&#20998;&#35789;&#36827;&#34892;&#32034;&#24341;&#65292;&#22914;&#20316;&#32773;&#21517;&#65292;&#26085;&#26399;&#31561;&#65292;Rod Johnson&#26412;&#36523;&#20026;&#19968;&#21333;&#35789;&#65292;&#19981;&#20877;&#38656;&#35201;&#20998;&#35789;&#12290;</p></li><li><p>Field.Index.NO&#65306;&#19981;&#36827;&#34892;&#32034;&#24341;&#65292;&#23384;&#25918;&#19981;&#33021;&#34987;&#25628;&#32034;&#30340;&#20869;&#23481;&#22914;&#25991;&#26723;&#30340;&#19968;&#20123;&#38468;&#21152;&#23646;&#24615;&#22914;&#25991;&#26723;&#31867;&#22411;, URL&#31561;&#12290;</p></li><li><p>Field.Index.NOT_ANALYZED_NO_NORMS&#65306;&#19981;&#20351;&#29992;&#20998;&#35789;&#32034;&#24341;&#65292;&#19981;&#20351;&#29992;&#23384;&#20648;&#35268;&#21017;&#12290;</p></li><li><p>Field.Index.ANALYZED_NO_NORMS&#65306;&#20351;&#29992;&#20998;&#35789;&#32034;&#24341;&#65292;&#19981;&#20351;&#29992;&#23384;&#20648;&#35268;&#21017;&#12290;</p></li></ul></div></li><li><p>Field.Store&#26377;&#19977;&#20010;&#23646;&#24615;</p><div class="itemizedlist"><ul type="circle"><li><p>Field.Store.YES&#65306;&#32034;&#24341;&#25991;&#20214;&#26412;&#26469;&#21482;&#23384;&#20648;&#32034;&#24341;&#25968;&#25454;, &#27492;&#35774;&#35745;&#23558;&#21407;&#25991;&#20869;&#23481;&#30452;&#25509;&#20063;&#23384;&#20648;&#22312;&#32034;&#24341;&#25991;&#20214;&#20013;&#65292;&#22914;&#25991;&#26723;&#30340;&#26631;&#39064;&#12290;</p></li><li><p>Field.Store.NO&#65306;&#21407;&#25991;&#19981;&#23384;&#20648;&#22312;&#32034;&#24341;&#25991;&#20214;&#20013;&#65292;&#25628;&#32034;&#32467;&#26524;&#21629;&#20013;&#21518;&#65292;&#20877;&#26681;&#25454;&#20854;&#20182;&#38468;&#21152;&#23646;&#24615;&#22914;&#25991;&#20214;&#30340;Path&#65292;&#25968;&#25454;&#24211;&#30340;&#20027;&#38190;&#31561;&#65292;&#37325;&#26032;&#36830;&#25509;&#25171;&#24320;&#21407;&#25991;&#65292;&#36866;&#21512;&#21407;&#25991;&#20869;&#23481;&#36739;&#22823;&#30340;&#24773;&#20917;&#12290;</p></li><li><p>Field.Store.COMPRESS&#65306;&#21387;&#32553;&#23384;&#20648;&#12290;</p></li></ul></div></li><li><p>termVector&#26159;Lucene 1.4.3&#26032;&#22686;&#30340;&#23427;&#25552;&#20379;&#19968;&#31181;&#21521;&#37327;&#26426;&#21046;&#26469;&#36827;&#34892;&#27169;&#31946;&#26597;&#35810;&#65292;&#19981;&#22826;&#24120;&#29992;&#12290;</p></li></ul></div><p>&#19978;&#38754;&#25152;&#35828;&#30340;Field&#23646;&#24615;&#19982;lucene1.4.3&#29256;&#26412;&#30340;&#26377;&#27604;&#36739;&#22823;&#30340;&#19981;&#21516;&#65292;&#22312;&#26087;&#29256;&#30340;1.4.3&#37324;lucene&#26159;&#36890;&#36807;Field.Keyword(...)&#65292;FieldUnIndexed(...)&#65292;FieldUnstored(...)&#21644;Field.Text(...)&#26469;&#35774;&#32622;&#19981;&#21516;&#23383;&#27573;&#30340;&#31867;&#22411;&#20197;&#36798;&#21040;&#19981;&#21516;&#30340;&#29992;&#36884;&#65292;&#32780;&#24403;&#21069;&#29256;&#26412;&#30001;Field.Index&#21644;Field.Store&#20004;&#20010;&#23383;&#27573;&#30340;&#19981;&#21516;&#32452;&#21512;&#26469;&#36798;&#21040;&#19978;&#36848;&#25928;&#26524;&#12290;</p><p>&#36824;&#26377;&#19968;&#28857;&#35828;&#26126;&#65292;&#20854;&#20013;&#30340;&#20004;&#20010;&#26500;&#36896;&#20989;&#25968;&#20854;&#40664;&#35748;&#30340;&#20540;&#20026;Field.Store.NO&#21644;Field.Index.TOKENIZED&#12290;</p><pre class="programlisting">
Field(String name, Reader reader)
Field(String name, Reader reader, Field.TermVector termVector)
                </pre></div><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e1690"></a>12.1.1.2.&nbsp;&#38480;&#21046;Field&#30340;&#38271;&#24230;</h4></div></div></div><p>IndexWriter&#31867;&#25552;&#20379;&#20102;&#19968;&#20010;setMaxFieldLength&#30340;&#26041;&#27861;&#26469;&#23545;Field&#30340;&#38271;&#24230;&#36827;&#34892;&#38480;&#21046;&#65292;&#30475;&#19968;&#19979;&#28304;&#20195;&#30721;&#23601;&#30693;&#36947;&#20854;&#40664;&#35748;&#20540;&#20026;10000&#65307;&#25105;&#20204;&#21487;&#20197;&#22312;&#20351;&#29992;&#26102;&#37325;&#26032;&#35774;&#32622;&#27492;&#21442;&#25968;&#12290;&#22914;&#26524;&#20351;&#29992;&#40664;&#35748;&#20540;&#65292;&#37027;&#20040;Lucene&#23601;&#20165;&#20165;&#23545;&#25991;&#26723;&#30340;&#21069;&#38754;&#30340;10000&#20010;term&#36827;&#34892;&#32034;&#24341;&#65292;&#36229;&#36807;&#36825;&#19968;&#20010;&#25968;&#30340;&#25991;&#26723;&#23601;&#19981;&#20250;&#34987;&#24314;&#31435;&#32034;&#24341;&#12290; </p></div><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e1693"></a>12.1.1.3.&nbsp;&#32034;&#24341;&#30340;&#21512;&#24182;&#12289;&#21024;&#38500;&#12289;&#20248;&#21270;</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>IndexWriter&#20013;&#30340;addIndexes&#26041;&#27861;&#23558;&#32034;&#24341;&#36827;&#34892;&#21512;&#24182;&#65292;&#24403;&#22312;&#19981;&#21516;&#30340;&#22320;&#26041;&#21019;&#24314;&#20102;&#32034;&#24341;&#21518;&#65292;&#22914;&#26524;&#38656;&#35201;&#23558;&#32034;&#24341;&#21512;&#24182;&#65292;&#36825;&#26102;&#20505;&#20351;&#29992;addIndexes&#26041;&#27861;&#23601;&#26174;&#24471;&#24456;&#26377;&#24847;&#20041;&#12290;</p></li><li><p>&#21487;&#20197;&#36890;&#36807;IndexReader&#31867;&#20174;&#32034;&#24341;&#20013;&#36827;&#34892;&#25991;&#26723;&#30340;&#21024;&#38500;&#12290;IndexReader&#26159;&#24456;&#29305;&#21035;&#30340;&#19968;&#20010;&#31867;&#65292;&#30475;&#28304;&#20195;&#30721;&#23601;&#30693;&#36947;&#23427;&#20027;&#35201;&#26159;&#36890;&#36807;&#33258;&#36523;&#30340;&#38745;&#24577;&#26041;&#27861;&#26469;&#23436;&#25104;&#26500;&#36896;&#30340;&#12290;&#31034;&#20363;&#65306;</p><pre class="programlisting">
IndexReader reader = IndexReader.open("d:/lucene/index");
reader.deleteDocument(X); //&#36825;&#37324;&#30340;X&#26159;&#19968;&#20010;int&#30340;&#24120;&#25968;&#65307;&#19981;&#25512;&#33616;&#36825;&#19968;&#31181;&#21024;&#38500;&#26041;&#27861;
reader.deleteDocument(new Term("name", "oa")); //&#36825;&#26159;&#21478;&#19968;&#31181;&#21024;&#38500;&#32034;&#24341;&#30340;&#26041;&#27861;&#65292;&#25353;&#23383;&#27573;&#26469;&#21024;&#38500;&#65292;&#25512;&#33616;&#20351;&#29992;&#36825;&#19968;&#31181;&#20570;&#27861;
reader.close();
                        </pre></li></ul></div><p>&#20248;&#21270;&#32034;&#24341;&#65306;&#21487;&#20197;&#20351;&#29992;IndexWriter&#31867;&#30340;optimize&#26041;&#27861;&#26469;&#36827;&#34892;&#20248;&#20808;&#65292;&#23427;&#20250;&#23558;&#22810;&#20010;Segment&#36827;&#34892;&#21512;&#24182;&#65292;&#32452;&#25104;&#19968;&#20010;&#26032;&#30340;Segment,&#21487;&#20197;&#21152;&#24555;&#24314;&#31435;&#32034;&#24341;&#21518;&#25628;&#32034;&#30340;&#36895;&#24230;&#12290;&#21478;&#22806;&#38656;&#35201;&#27880;&#24847;&#30340;&#19968;&#28857;&#65292;optimize&#26041;&#27861;&#20250;&#38477;&#20302;&#24314;&#31435;&#32034;&#24341;&#30340;&#36895;&#24230;&#65292;&#32780;&#19988;&#35201;&#27714;&#30340;&#30913;&#30424;&#31354;&#38388;&#20250;&#22686;&#21152;&#12290; </p></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1702"></a>12.1.2.&nbsp;&#36827;&#34892;&#25628;&#32034;&#26102;&#30340;&#26415;&#35821;</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>IndexSearcher&#65306;&#26159;lucene&#20013;&#26368;&#22522;&#26412;&#30340;&#26816;&#32034;&#24037;&#20855;&#65292;&#25152;&#26377;&#30340;&#26816;&#32034;&#37117;&#20250;&#29992;&#21040;IndexSearcher&#24037;&#20855;&#12290;&#21021;&#22987;&#21270;IndexSearcher&#38656;&#35201;&#35774;&#32622;&#32034;&#24341;&#23384;&#25918;&#30340;&#36335;&#24452;&#65292;&#35753;&#26597;&#35810;&#22120;&#33021;&#23450;&#20301;&#32034;&#24341;&#32780;&#36827;&#34892;&#25628;&#32034;&#12290;</p></li><li><p>Query&#65306;&#26597;&#35810;&#65292;lucene&#20013;&#25903;&#25345;&#27169;&#31946;&#26597;&#35810;&#65292;&#35821;&#20041;&#26597;&#35810;&#65292;&#30701;&#35821;&#26597;&#35810;&#65292;&#32452;&#21512;&#26597;&#35810;&#31561;&#31561;&#65292;&#22914;&#26377;TermQuery&#65292;BooleanQuery&#65292;RangeQuery&#65292;WildcardQuery&#31561;&#19968;&#20123;&#31867;&#12290;</p></li><li><p>QueryParser:&#65306;&#26159;&#19968;&#20010;&#35299;&#26512;&#29992;&#25143;&#36755;&#20837;&#30340;&#24037;&#20855;&#65292;&#21487;&#20197;&#36890;&#36807;&#25195;&#25551;&#29992;&#25143;&#36755;&#20837;&#30340;&#23383;&#31526;&#20018;&#65292;&#29983;&#25104;Query&#23545;&#35937;&#12290; </p></li><li><p>Hits&#65306;&#22312;&#25628;&#32034;&#23436;&#25104;&#20043;&#21518;&#65292;&#38656;&#35201;&#25226;&#25628;&#32034;&#32467;&#26524;&#36820;&#22238;&#24182;&#26174;&#31034;&#32473;&#29992;&#25143;&#65292;&#21482;&#26377;&#36825;&#26679;&#25165;&#31639;&#26159;&#23436;&#25104;&#25628;&#32034;&#30340;&#30446;&#30340;&#12290;&#22312;lucene&#20013;&#65292;&#25628;&#32034;&#30340;&#32467;&#26524;&#30340;&#38598;&#21512;&#26159;&#29992;Hits&#31867;&#30340;&#23454;&#20363;&#26469;&#34920;&#31034;&#30340;&#12290;Hits&#23545;&#35937;&#20013;&#20027;&#35201;&#26041;&#27861;&#26377;&#65306; </p><pre class="programlisting">
length(): &#36820;&#22238;&#25628;&#32034;&#32467;&#26524;&#30340;&#24635;&#25968;,&#19979;&#38754;&#31616;&#21333;&#30340;&#29992;&#27861;&#20013;&#26377;&#29992;&#21040;Hit&#30340;&#36825;&#19968;&#20010;&#26041;&#27861;
doc(int n): &#36820;&#22238;&#31532;n&#20010;&#25991;&#26723;
iterator(): &#36820;&#22238;&#19968;&#20010;&#36845;&#20195;&#22120;
                    </pre><p>&#36825;&#37324;&#20877;&#25552;&#19968;&#19979;Hits&#65292;&#36825;&#20063;&#26159;Lucene&#27604;&#36739;&#31934;&#24425;&#30340;&#22320;&#26041;&#65292;&#29087;&#24713;hibernate&#30340;&#26379;&#21451;&#37117;&#30693;&#36947;hibernate&#26377;&#19968;&#20010;&#24310;&#36831;&#21152;&#36733;&#30340;&#23646;&#24615;&#65292;&#21516;&#26679;&#65292;Lucene&#20063;&#26377;&#12290;Hits&#23545;&#35937;&#20063;&#26159;&#37319;&#29992;&#24310;&#36831;&#21152;&#36733;&#30340;&#26041;&#24335;&#36820;&#22238;&#32467;&#26524;&#30340;&#65292;&#24403;&#35201;&#35775;&#38382;&#26576;&#20010;&#25991;&#26723;&#26102;&#65292;Hits&#23545;&#35937;&#23601;&#22312;&#20869;&#37096;&#23545;Lucene&#30340;&#32034;&#24341;&#21448;&#36827;&#34892;&#19968;&#27425;&#26816;&#32034;&#65292;&#26368;&#21518;&#25165;&#23558;&#32467;&#26524;&#36820;&#22238;&#21040;&#39029;&#38754;&#26174;&#31034;&#12290;</p></li></ul></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1715"></a>12.1.3.&nbsp;&#19968;&#20010;&#31616;&#21333;&#30340;&#23454;&#20363;</h3></div></div></div><p>&#39318;&#20808;&#25226;lucene&#30340;&#21253;&#25918;&#22312;classpath&#36335;&#24452;&#20013;&#21435;&#65292;&#20889;&#19979;&#38754;&#19968;&#20010;&#31616;&#21333;&#30340;&#31867;&#65306;</p><pre class="programlisting">
public class FSDirectoryTest {
    //&#24314;&#31435;&#32034;&#24341;&#30340;&#36335;&#24452;
    public static final String path = "d:/index2";

    public static void main(String[] args) throws Exception {
        Document doc1 = new Document();
        doc1.add(new Field("name", "www family168 com", Field.Store.YES,
                Field.Index.TOKENIZED));

        Document doc2 = new Document();
        doc2.add(new Field("name", "family168 blog bbs", Field.Store.YES,
                Field.Index.TOKENIZED));

        IndexWriter writer = new IndexWriter(FSDirectory.getDirectory(
                    path, true), new StandardAnalyzer(), true);
        writer.addDocument(doc1);
        writer.addDocument(doc2);
        writer.close();

        IndexSearcher searcher = new IndexSearcher(path);
        Hits hits = null;
        Query query = null;
        QueryParser qp = new QueryParser("name", new StandardAnalyzer());

        query = qp.parse("family168");
        hits = searcher.search(query);
        System.out.println("&#26597;&#25214;\"family168\" &#20849;" + hits.length() + "&#20010;&#32467;&#26524;");

        query = qp.parse("bbs");
        hits = searcher.search(query);
        System.out.println("&#26597;&#25214;\"bbs\" &#20849;" + hits.length() + "&#20010;&#32467;&#26524;");
    }
}
            </pre><p>&#25191;&#34892;&#30340;&#32467;&#26524;&#65306;</p><pre class="programlisting">
&#26597;&#25214;"family168" &#20849;2&#20010;&#32467;&#26524;
&#26597;&#25214;"bbs" &#20849;1&#20010;&#32467;&#26524;
            </pre></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1721"></a>12.1.4.&nbsp;&#22797;&#26434;&#19968;&#28857;&#30340;&#23454;&#20363;</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>&#22312;windows&#31995;&#32479;&#19979;&#30340;&#30340;C&#30424;&#65292;&#24314;&#19968;&#20010;&#21517;&#21483;s&#30340;&#25991;&#20214;&#22841;&#65292;&#22312;&#35813;&#25991;&#20214;&#22841;&#37324;&#38754;&#38543;&#20415;&#24314;&#19977;&#20010;txt&#25991;&#20214;&#65292;&#38543;&#20415;&#36215;&#21517;&#21862;&#65292;&#23601;&#21483;"1.txt"&#65292;"2.txt"&#21644;"3.txt"&#12290;</p><p>&#20854;&#20013;1.txt&#30340;&#20869;&#23481;&#22914;&#19979;&#65306; </p><pre class="programlisting">
family168
&#25991;&#26723;&#65292;&#36164;&#26009;
2009
                    </pre><p>&#32780;"2.txt"&#21644;"3.txt"&#30340;&#20869;&#23481;&#20063;&#21487;&#20197;&#38543;&#20415;&#20889;&#20960;&#20889;&#65292;&#36825;&#37324;&#25042;&#20889;&#65292;&#23601;&#22797;&#21046;&#19968;&#20010;&#21644;1.txt&#25991;&#20214;&#30340;&#20869;&#23481;&#19968;&#26679;&#21543;</p></li><li><p>&#19979;&#36733;lucene&#21253;&#65292;&#25918;&#22312;classpath&#36335;&#24452;&#20013;&#65292;&#28982;&#21518;&#24314;&#31435;&#32034;&#24341;: </p><pre class="programlisting">
public class LuceneExample {
    public static void main(String[] args) throws Exception {
        File fileDir = new File("D:/lucene");     // &#25351;&#26126;&#35201;&#32034;&#24341;&#25991;&#20214;&#22841;&#30340;&#20301;&#32622;,&#36825;&#37324;&#26159;C&#30424;&#30340;S&#25991;&#20214;&#22841;&#19979;
        File indexDir = new File("D:/lucene/index"); // &#36825;&#37324;&#25918;&#32034;&#24341;&#25991;&#20214;&#30340;&#20301;&#32622;
        File[] textFiles = fileDir.listFiles();

        Analyzer luceneAnalyzer = new StandardAnalyzer();
        IndexWriter indexWriter = new IndexWriter(indexDir,luceneAnalyzer,true);
          indexFile(luceneAnalyzer,indexWriter, textFiles);
        indexWriter.optimize(); // optimize()&#26041;&#27861;&#26159;&#23545;&#32034;&#24341;&#36827;&#34892;&#20248;&#21270;
        indexWriter.close();
    }

    public static void indexFile(Analyzer luceneAnalyzer,IndexWriter indexWriter,File[] textFiles) throws Exception {
        // &#22686;&#21152;document&#21040;&#32034;&#24341;&#21435;
        for (int i = 0; i &lt; textFiles.length; i++) {
            if (textFiles[i].isFile() &amp;&amp; textFiles[i].getName().endsWith(".txt")) {
                String temp = FileReaderAll(textFiles[i].getCanonicalPath(),"GBK");
                Document document = new Document();
                Field FieldBody = new Field("body", temp, Field.Store.YES,Field.Index.TOKENIZED);
                document.add(FieldBody);
                indexWriter.addDocument(document);
            }
        }
    }
    public static String FileReaderAll(String FileName, String charset)throws IOException {
        BufferedReader reader = new BufferedReader(new InputStreamReader(
                new FileInputStream(FileName), charset));
        String line = "";
        String temp = "";
        while ((line = reader.readLine()) != null) {
            temp += line;
        }
        reader.close();
        return temp;
    }
}
                    </pre></li><li><p>&#25191;&#34892;&#26597;&#35810;&#65306;</p><pre class="programlisting">
public class TestQuery {
    public static void main(String[] args)
        throws IOException, ParseException {
        Hits hits = null;
        String queryString = "family168";
        Query query = null;
        IndexSearcher searcher = new IndexSearcher("D:/lucene/index");

        Analyzer analyzer = new StandardAnalyzer();

        try {
            QueryParser qp = new QueryParser("body", analyzer);
            query = qp.parse(queryString);
        } catch (ParseException e) {
            e.printStackTrace();
        }

        if (searcher != null) {
            hits = searcher.search(query);

            if (hits.length() &gt; 0) {
                System.out.println("&#25214;&#21040;:" + hits.length() + " &#20010;&#32467;&#26524;!");
            }
        }
    }
}
                    </pre></li><li><p>&#25191;&#34892;&#32467;&#26524;&#65306; </p><p>&#25214;&#21040;&#65306;3 &#20010;&#32467;&#26524;!</p></li></ul></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1738"></a>12.1.5.&nbsp;Hibernate&#19982;lucene&#30340;&#32467;&#21512;&#20351;&#29992;:</h3></div></div></div><p>&#21442;&#32771;&#36825;&#19968;&#31687;&#25991;&#31456;,&#37324;&#38754;&#35762;&#24471;&#24456;&#35814;&#32454;</p><p>http://wiki.redsaga.com/confluence/display/HART/Hibernate+Lucene+Integration</p></div></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1742"></a>12.2.&nbsp;Compass</h2></div></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1744"></a>12.2.1.&nbsp;&#27010;&#36848;</h3></div></div></div><p>compass&#23448;&#26041;&#32593;&#31449;: <a class="ulink" href="http://www.compass-project.org/" target="_top">http://www.compass-project.org/</a></p><p>Compass&#26159;&#19968;&#27969;&#30340;JAVA&#25628;&#32034;&#26694;&#26550;&#65292;&#21487;&#20197;&#24555;&#36895;&#20462;&#39280;&#20320;&#30340;&#24212;&#29992;&#65292;&#20351;&#20854;&#20855;&#22791;Searchable&#30340;&#33021;&#21147;&#12290;</p><p>&#22312;&#27809;&#26377;Compass&#65292;&#21333;&#32431;&#29992;Lucene&#30340;&#29615;&#22659;&#37324;&#65292;&#19968;&#33324;&#20570;&#27861;&#26159;&#23450;&#26399;&#36941;&#21382;&#25968;&#25454;&#24211;&#65292;&#32534;&#30721;&#23558;&#37324;&#38754;&#30340;&#20869;&#23481;&#36716;&#20026;&#32034;&#24341;&#12290;</p><p>&#32780;Compass&#36890;&#36807;&#19982;Hibernate&#21644;Spring&#30340;&#32467;&#21512;&#65292;&#31616;&#21333;&#30340;&#23558;Domain Object&#36716;&#25442;&#20026;Lucene&#24341;&#25806;&#30340;&#26144;&#23556;&#65292;&#32780;&#19988;&#32034;&#24341;&#24211;&#33021;&#22815;&#38543;Domain Object&#21516;&#27493;&#26356;&#26032;(Data Mirror)&#12290;</p><p>&#20351;&#29992;compass&#24555;&#36895;&#24314;&#31435;&#20840;&#25991;&#25628;&#32034;&#30340;&#27969;&#31243;&#22914;&#19979;&#65306; </p><div class="orderedlist"><ol type="1"><li><p>&#29992;&#31616;&#21333;&#30340;compass annotation&#25226;User&#23545;&#35937;&#26144;&#23556;&#21040;Lucene&#12290;</p></li><li><p>&#25552;&#20379;Index service&#21644;Search service&#12290;</p></li><li><p>&#32534;&#20889;&#26597;&#35810;&#32467;&#26524;&#30340;&#26174;&#31034;&#39029;&#38754;&#65292;&#23558;&#26597;&#35810;&#36820;&#22238;&#30340;&#21464;&#37327;&#26174;&#31034;&#20986;&#26469;&#12290;</p></li></ol></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1759"></a>12.2.2.&nbsp;Object/Search Engine Mapping&#30340;Annotations&#37197;&#32622;</h3></div></div></div><p>&#20351;&#29992;JDK5&#30340;annotation &#26469;&#36827;&#34892;OSEM(Object/Search Engine Mapping)&#27604;&#29992;xml&#25991;&#20214;&#25353;&#31616;&#21333;&#35768;&#22810;&#65292;&#19979;&#38754;&#23601;&#26159;&#31616;&#21333;&#30340;&#25628;&#32034;&#31867;&#65292;&#21487;&#35265;@SearchableID, @SearchableProperty&#19982;@SearchableComponent &#19977;&#20010;&#26631;&#35760;&#65292;&#20998;&#21035;&#20195;&#34920;&#20027;&#38190;&#12289;&#21487;&#25628;&#32034;&#30340;&#23646;&#24615;&#19982;&#20851;&#32852;&#30340;&#65292;&#21478;&#19968;&#20010;&#21487;&#25628;&#32034;&#30340;&#23545;&#35937;&#65292;&#21478;&#22806;Compass&#35201;&#27714;POJO&#35201;&#26377;&#40664;&#35748;&#26500;&#36896;&#20989;&#25968;&#65292;&#35201;&#23454;&#29616;equals()&#21644;hashcode(): </p><pre class="programlisting">
@Entity
@Searchable
public class Child {
    private Long id;
    private String name;
    private Parent parent;

    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    @SearchableId
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    @Column
    @SearchableProperty(name = "name")
    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "PARENT_ID")
    @SearchableComponent(refAlias = "parent")
    public Parent getParent() {
        return parent;
    }

    public void setParent(Parent parent) {
        this.parent = parent;
    }
}
            </pre><p>&#27880;&#24847;&#21487;&#34987;&#25628;&#32034;&#30340;&#23545;&#35937;&#24517;&#39035;&#36981;&#23432;&#19979;&#38754;&#30340;&#35268;&#21017;</p><div class="orderedlist"><ol type="1"><li><p>&#25152;&#26377;&#30340;&#25345;&#20037;&#21270;&#31867;&#24517;&#39035;&#26377;&#40664;&#35748;&#26500;&#36896;&#20989;&#25968;(&#27809;&#21442;&#25968;&#30340;&#26500;&#36896;&#20989;&#25968;).</p></li><li><p>OSEM&#35201;&#27714;&#26144;&#23556;&#31867;JavaBean&#24517;&#39035;&#26377;&#19968;&#20010;&#25110;&#26356;&#22810;&#30340;id&#20027;&#24314;. id&#23646;&#24615;&#21487;&#20197;&#26159;&#23545;&#35937;&#31867;&#22411;,&#20363;&#22914;java.lang.String or java.util.Date.</p><p>&#24182;&#19988;&#31867;&#27880;&#35299;&#20351;&#29992;@SearchableClassConverter&#25110;&#32773;&#20351;&#29992;&#23450;&#20041;Converter(&#36890;&#24120;&#32487;&#25215;Compass AbstractBasicConverter).</p></li><li><p>&#20351;&#29992;JavaBean&#35268;&#33539;, getter/setter. </p></li></ol></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1772"></a>12.2.3.&nbsp;Data Change Mirror&#21151;&#33021;</h3></div></div></div><p>DataMirror&#20250;&#25226;&#25968;&#25454;&#24211;&#30340;&#22686;&#21024;&#25913;&#21464;&#21270;&#23454;&#26102;&#26144;&#23556;&#21040;&#32034;&#24341;&#25991;&#20214;&#20013;&#12290;</p><p>&#22914;&#26524;&#20320;&#37319;&#29992;Hibernate&#31561;ORM&#26041;&#26696;&#65292;Compass&#23601;&#20250;&#19982;Hibernate&#30340;event&#26426;&#21046;&#32467;&#21512;&#65292;&#25110;&#32773;&#20351;&#29992;AOP&#30340;&#26041;&#24335;&#65292;&#33258;&#21160;&#22312;&#25968;&#25454;&#24211;&#22686;&#21024;&#25913;&#26102;&#21464;&#26356;&#32034;&#24341;&#65307;&#22914;&#26524;&#20320;&#21482;&#26159;&#37319;&#29992;JDBC&#65292;&#20063;&#21487;&#20197;&#22312;XML&#25991;&#20214;&#37197;&#32622;Table Mapping&#25110;ResultSet Mapping&#65292;&#25351;&#23450;version&#21015;&#65292;Compasss&#23450;&#26102;&#23545;version&#21015;&#21464;&#21270;&#20102;&#30340;&#25968;&#25454;&#36827;&#34892;&#32034;&#24341;&#26356;&#26032;&#12290;</p><p>&#32780;&#19988;Compass&#36824;&#25903;&#25345;&#20107;&#21153;&#65292;&#22312;&#26597;&#35810;&#25968;&#25454;&#24211;&#36941;&#21382;&#32467;&#26524;&#38598;&#30340;&#36807;&#31243;&#20013;&#22914;&#26524;&#20986;&#29616;&#24322;&#24120;&#65292;&#20250;&#22312;Index Segments&#25991;&#20214;&#19968;&#32423;&#36827;&#34892;&#20107;&#21153;&#25511;&#21046;&#12290;</p><p>&#22914;&#26524;&#27809;&#26377;Compass&#65292;&#25105;&#20204;&#19968;&#33324;&#20250;&#22312;&#27599;&#22825;&#28145;&#22812;&#37325;&#24314;&#19968;&#27425;&#32034;&#24341;&#12290;&#30456;&#27604;Compass&#30340;&#20570;&#27861;&#65292;</p><div class="itemizedlist"><ul type="disc"><li><p>&#19968;&#26469;&#21453;&#24212;&#36831;&#32531;&#65292;&#24179;&#22343;&#24310;&#26102;&#21322;&#22825;&#12290;</p></li><li><p>&#20108;&#26469;&#25928;&#29575;&#27809;&#26377;Compass&#39640;&#12290;&#22914;&#26524;&#37319;&#29992;&#23436;&#20840;&#37325;&#24314;&#32034;&#24341;&#65292;&#25928;&#29575;&#23601;&#19981;&#29992;&#35828;&#20102;&#12290;&#22914;&#26524;&#36827;&#34892;&#22686;&#37327;&#32034;&#24341;&#65292;&#23601;&#35201;&#22686;&#21152;&#19968;&#20010;&#23383;&#27573;&#65292;&#22312;&#25968;&#25454;&#26356;&#26032;&#26102;&#36827;&#34892;&#29305;&#27530;&#30340;&#22788;&#29702;&#65292;&#21024;&#38500;&#26102;&#20063;&#19981;&#33021;&#30452;&#25509;&#21024;&#38500;&#25968;&#25454;&#65292;&#35201;&#31561;lucene&#21024;&#23436;&#32034;&#24341;&#25968;&#25454;&#25165;&#33021;&#21024;&#38500;&#65292;&#36825;&#26679;Lucene&#23545;&#24212;&#29992;&#23601;&#38750;&#24120;&#19981;&#36879;&#26126;&#20102;&#12290;</p></li><li><p>&#19977;&#26469;&#19981;&#25903;&#25345;&#20107;&#21153;&#65292;&#22914;&#26524;&#24314;&#31435;&#32034;&#24341;&#36807;&#31243;&#20013;&#20986;&#29616;&#24322;&#24120;&#65292;&#32034;&#24341;&#25991;&#20214;&#30340;&#29366;&#24577;&#26159;&#19981;&#21487;&#25511;&#30340;&#12290;</p></li></ul></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1785"></a>12.2.4.&nbsp;&#19982;spring&#65292;hibernate&#38598;&#25104;&#37197;&#32622;</h3></div></div></div><p>&#19979;&#38754;&#26159;compass&#22312;spring&#20013;&#30340;&#31616;&#26126;&#37197;&#32622;&#65306;</p><pre class="programlisting">
&lt;bean id="compass" class="org.compass.spring.LocalCompassBean"&gt;
    &lt;!-- anontaition&#24335;&#35774;&#32622; --&gt;
    &lt;property name="classMappings"&gt;
        &lt;list&gt;
            &lt;value&gt;com.family168.domain.Child&lt;/value&gt;
            &lt;value&gt;com.family168.domain.Parent&lt;/value&gt;
        &lt;/list&gt;
    &lt;/property&gt;

    &lt;property name="compassConfiguration"&gt;
        &lt;bean class="org.compass.annotations.config.CompassAnnotationsConfiguration"/&gt;
    &lt;/property&gt;

    &lt;property name="compassSettings"&gt;
        &lt;props&gt;
            &lt;prop key="compass.engine.connection"&gt;
                file://${user.home}/oa/compass
            &lt;/prop&gt;
            &lt;prop key="compass.transaction.factory"&gt;
                org.compass.spring.transaction.SpringSyncTransactionFactory
            &lt;/prop&gt;
        &lt;/props&gt;
    &lt;/property&gt;

    &lt;property name="transactionManager" ref="transactionManager"/&gt;
&lt;/bean&gt;

&lt;!-- Compass&#20013;&#24314;&#31435;&#32034;&#24341;&#19982;mirror database change&#30340;&#37096;&#20214; --&gt;
&lt;bean id="compassGps" class="org.compass.gps.impl.SingleCompassGps"
          init-method="start" destroy-method="stop"&gt;
    &lt;property name="compass" ref="compass"/&gt;
    &lt;property name="gpsDevices"&gt;
        &lt;list&gt;
            &lt;bean class="org.compass.spring.device.hibernate.dep.SpringHibernate3GpsDevice"&gt;
                &lt;property name="name" value="hibernateDevice"/&gt;
                &lt;property name="sessionFactory" ref="sessionFactory"/&gt;
            &lt;/bean&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;
            </pre><p>&#19978;&#38754;&#35201;&#30041;&#24847;&#30340;&#37197;&#32622;&#26377;&#65306;</p><p>annotationConfiguration&#65306;&#20351;&#29992;annotation&#37197;&#32622;&#65292;&#25351;&#23450;&#35201;&#36716;&#25442;&#30340;POJO&#22914;User&#12290;</p><p>compass.engine.connection&#65306;&#32034;&#24341;&#25991;&#20214;&#22312;&#26381;&#21153;&#22120;&#19978;&#30340;&#23384;&#20648;&#36335;&#24452;&#12290;</p><p>hibernateGpsDevice&#65306;&#19982;hibernate&#30340;&#32465;&#23450;&#65292;&#29992;Hibernate 3&#20107;&#20214;&#31995;&#32479;&#65292;&#25903;&#25345;Real Time Data Mirroring .&#32463;Hiberante&#30340;&#25968;&#25454;&#25913;&#21464;&#20250;&#33258;&#21160;&#34987;&#21453;&#23556;&#21040;&#32034;&#24341;&#37324;&#38754;.</p><p>&#19978;&#38754;&#30340;Gps&#23450;&#20041;&#21482;&#26159;&#33258;&#21551;&#21160;Mirror Data Change&#65292;&#20294;&#32034;&#24341;&#21021;&#22987;&#24314;&#31435;&#23601;&#38656;&#35201;&#38752;&#31243;&#24207;&#21592;&#33258;&#24049;&#20889;&#20195;&#30721;&#35843;&#29992;CompassGps.index()&#26469;&#23436;&#25104;&#12290;</p><p>&#29702;&#35770;&#19978;&#65292;&#22240;&#20026;&#21487;&#20197;Mirror Data Change&#65292;&#25152;&#20197;&#32034;&#24341;&#21482;&#38656;&#35201;&#24314;&#31435;&#19968;&#27425;&#21363;&#21487;&#12290;&#22914;&#26524;&#32034;&#24341;&#24050;&#23384;&#22312;&#65292;Compass&#20250;&#23545;&#23427;gracefule override&#65292;&#25152;&#35859;graceful&#65292;&#23601;&#26159;Compass&#20250;&#29616;&#22312;&#20020;&#26102;&#30446;&#24405;&#23384;&#25918;&#26032;&#30340;&#32034;&#24341;&#65292;&#26032;&#32034;&#24341;&#24314;&#31435;&#23436;&#27605;&#21518;&#65292;&#20877;&#19968;&#27425;&#36807;&#35206;&#30422;&#26087;&#32034;&#24341;&#65292;&#37325;&#24314;&#32034;&#24341;&#30340;&#28459;&#38271;&#36807;&#31243;&#20013;&#65292;&#26087;&#32034;&#24341;&#21487;&#20197;&#27491;&#24120;&#24037;&#20316;&#12290;</p><p>&#20026;&#20102;&#26041;&#20415;&#28436;&#31034;&#65292;&#23450;&#20041;&#19968;&#20010;CompassIndexBuilder&#65292;&#23454;&#29616;&#20102;Spring&#30340;InitializingBean&#25509;&#21475;&#65292;&#33258;&#21160;&#22312;Spring&#21551;&#21160;&#26102;&#65292;&#21551;&#21160;&#19968;&#26465;&#32447;&#31243;&#36827;&#34892;&#32034;&#24341;&#37325;&#24314;&#12290;</p></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1796"></a>12.2.5.&nbsp;&#23553;&#35013;&#25628;&#32034;</h3></div></div></div><p>&#33258;&#23450;&#20041;CompassSearchService&#21644;AdvancedSearchCommand&#65292;&#20197;&#27492;&#23454;&#29616;&#39640;&#32423;&#25628;&#32034;&#12290;</p><pre class="programlisting">
&lt;bean id="compassSearchService" class="com.family168.CompassSearchService"&gt;
    &lt;property name="compass" ref="compass"/&gt;
    &lt;property name="pageSize" value="15"/&gt;
&lt;/bean&gt;
            </pre></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1800"></a>12.2.6.&nbsp;View JSP</h3></div></div></div><p>&#31616;&#21333;&#25628;&#32034;&#39029;&#38754;&#65306;&#21482;&#38656;&#35201;&#19968;&#20010;queryString&#21442;&#25968;&#65306;</p><pre class="programlisting">
&lt;INPUT type="text" size="20" name="queryString"&gt;
            </pre><p>&#32467;&#26524;&#39029;&#38754;&#23558;&#36820;&#22238;&#20960;&#20010;&#21464;&#37327;&#65292;&#21253;&#25324;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>searchResults(&#25628;&#32034;&#32467;&#26524;)&#21253;&#25324;hits(&#32467;&#26524;)&#21644;searchtime(&#32791;&#26102;)</p></li><li><p>pages(&#20998;&#39029;&#20449;&#24687;)&#21253;&#25324;page_from&#65292;page_to&#31561;</p></li><li><p>command(&#21407;&#26469;&#30340;&#26597;&#35810;&#35831;&#27714;)</p></li></ul></div><p>&#21442;&#35265;&#19979;&#38754;&#31616;&#21333;&#30340;&#20195;&#30721;:</p><pre class="programlisting">
&lt;c:if test="${not empty searchResults}"&gt;
    &#32791;&#26102;&#65306; ${searchResults.searchTime}ms
    &lt;c:forEach var="hit" items="${searchResults.hits}"&gt;
        &lt;c:choose&gt;
            &lt;c:when test="${hit.alias == 'child'}"&gt;
                &lt;div class="left_content"&gt;
                    &lt;p&gt;
                        &lt;a href="#" class= "title"&gt;${hit.data.name}&lt;/a&gt;
                        &lt;br/&gt; parent&#65306;${hit.data.parent.name}
                        &lt;br/&gt;
                    &lt;/p&gt;
                &lt;/div&gt;
            &lt;/c:when&gt;
        &lt;/c:choose&gt;
    &lt;/c:forEach&gt;
&lt;/c:if&gt;
            </pre></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1814"></a>12.2.7.&nbsp;Compass Highlighter</h3></div></div></div><p>&#23450;&#20041;Highlighter&#23383;&#27573;&#65292;&#21482;&#38656;&#35201;&#22312;AdvancedSearchCommand&#19978;&#23558;&#38656;&#35201;highlighting&#30340;Fields&#21152;&#20837;&#21363;&#21487;&#12290;</p><pre class="programlisting">
searchCommand.setHighlightFields(new String[] {"name"});
            </pre><p>&#23450;&#20041;&#39640;&#20142;&#30340;&#26679;&#24335;</p><p>&#21478;&#22806;&#65292;&#22914;&#26524;&#23545;&#39640;&#20142;&#26174;&#31034;&#30340;&#25928;&#26524;&#19981;&#28385;&#24847;&#30340;&#35805;&#65292;&#21487;&#20197;&#22312;applicationContext-compass.xml &#25991;&#20214;&#37324;&#37197;&#32622;&#65306;</p><pre class="programlisting">
&lt;prop key="compass.engine.highlighter.default.formatter.simple.pre"&gt;
    &lt;![CDATA[&lt;font color="red"&gt;&lt;b&gt;]]&gt;
&lt;/prop&gt;
&lt;prop key="compass.engine.highlighter.default.formatter.simple.post"&gt;
    &lt;![CDATA[&lt;/b&gt;&lt;/font&gt;]]&gt;
&lt;/prop&gt;
            </pre></div></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1821"></a>12.3.&nbsp;Hibernate Search</h2></div></div></div><p>&#22312;applicationContext.xml&#20013;&#28155;&#21152;&#20004;&#20010;&#21442;&#25968;&#65306;</p><pre class="programlisting">
&lt;prop key="hibernate.search.default.directory_provider"&gt;org.hibernate.search.store.FSDirectoryProvider&lt;/prop&gt;
&lt;prop key="hibernate.search.default.indexBase"&gt;d:/lucene/indexes&lt;/prop&gt;
        </pre><p>&#24819;&#20351;&#29992;&#21160;&#24577;&#32034;&#24341;&#30340;&#35805;&#65292;&#36824;&#38656;&#35201;&#37197;&#32622;event listener&#65306;</p><pre class="programlisting">
&lt;property name="eventListeners"&gt;
    &lt;map&gt;
        &lt;entry key="post-update"&gt;
            &lt;bean class="org.hibernate.search.event.FullTextIndexEventListener"/&gt;
        &lt;/entry&gt;
        &lt;entry key="post-insert"&gt;
            &lt;bean class="org.hibernate.search.event.FullTextIndexEventListener"/&gt;
        &lt;/entry&gt;
        &lt;entry key="post-delete"&gt;
            &lt;bean class="org.hibernate.search.event.FullTextIndexEventListener"/&gt;
        &lt;/entry&gt;
        &lt;entry key="post-collection-recreate"&gt;
            &lt;bean class="org.hibernate.search.event.FullTextIndexEventListener"/&gt;
        &lt;/entry&gt;
        &lt;entry key="post-collection-remove"&gt;
            &lt;bean class="org.hibernate.search.event.FullTextIndexEventListener"/&gt;
        &lt;/entry&gt;
        &lt;entry key="post-collection-update"&gt;
            &lt;bean class="org.hibernate.search.event.FullTextIndexEventListener"/&gt;
        &lt;/entry&gt;
    &lt;/map&gt;
&lt;/property&gt;
        </pre><p>&#22240;&#20026;&#20351;&#29992;&#30340;&#26102;&#26085;&#23578;&#30701;&#65292;&#36824;&#19981;&#30693;&#36947;&#22914;&#20309;&#22312;&#31995;&#32479;&#21551;&#21160;&#30340;&#26102;&#20505;&#32479;&#19968;&#21021;&#22987;&#21270;&#32034;&#24341;&#65292;&#22312;hibernate search&#23448;&#26041;&#25991;&#26723;&#19978;&#25214;&#21040;&#30340;&#26041;&#27861;&#26159;&#20808;&#26597;&#35810;&#65292;&#21518;&#36880;&#26465;&#32034;&#24341;&#30340;&#26041;&#24335;&#65306;</p><pre class="programlisting">
public void index() {
    FullTextSession fullTextSession = Search.getFullTextSession(getSession());

    //Transaction tx = fullTextSession.beginTransaction();
    List&lt;User&gt; users = getSession().createQuery("from User").list();

    for (User user : users) {
        fullTextSession.index(user);
    }

    //tx.commit();
}
        </pre><p>&#24314;&#31435;&#32034;&#24341;&#20043;&#21518;&#65292;&#23601;&#21487;&#20197;&#36827;&#34892;&#26597;&#35810;&#65306;</p><pre class="programlisting">
public void search() throws ParseException {
    FullTextSession fullTextSession = Search
        .getFullTextSession(getSession());
    QueryParser parser = new QueryParser("user_name",
            new StopAnalyzer());
    parser.setPhraseSlop(0);

    org.apache.lucene.search.Query luceneQuery = parser.parse(
            "username");
    org.hibernate.Query hibQuery = fullTextSession.createFullTextQuery(luceneQuery,
            User.class);
    List&lt;User&gt; list = hibQuery.list();
    System.out.println(list.size());
}
        </pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="jms.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="timer.html">&#19979;&#19968;&#39029;</a></td></tr><tr><td width="40%" align="left" valign="top">&#31532;&nbsp;11&nbsp;&#31456;&nbsp;JMS&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">&#36215;&#22987;&#39029;</a></td><td width="40%" align="right" valign="top">&nbsp;&#31532;&nbsp;13&nbsp;&#31456;&nbsp;&#20219;&#21153;&#35843;&#24230;</td></tr></table></div></body></html>