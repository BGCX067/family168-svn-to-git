<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>&#31532;&nbsp;11&nbsp;&#31456;&nbsp;JMS</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.2"><style type="text/css">
body { background-image: url('images/draft.png');
       background-repeat: no-repeat;
       background-position: top left;
       /* The following properties make the watermark "fixed" on the page. */
       /* I think that's just a bit too distracting for the reader... */
       /* background-attachment: fixed; */
       /* background-position: center center; */
     }</style><link rel="start" href="index.html" title="Leona"><link rel="up" href="index.html" title="Leona"><link rel="prev" href="drools.html" title="&#31532;&nbsp;10&nbsp;&#31456;&nbsp;drools&#35268;&#21017;&#24341;&#25806;"><link rel="next" href="search.html" title="&#31532;&nbsp;12&nbsp;&#31456;&nbsp;&#20840;&#25991;&#26816;&#32034;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns="http://www.w3.org/TR/xhtml1/transitional" xmlns:fo="http://www.w3.org/1999/XSL/Format" style="background-color:white;border:none;height:73px;border:1px solid black;"><a style="border:none;" href="http://www.family168.com/" title="Family168"><img src="images/family168.png" border="0"></img></a></div><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">&#31532;&nbsp;11&nbsp;&#31456;&nbsp;JMS</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="drools.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="search.html">&#19979;&#19968;&#39029;</a></td></tr></table><hr></div><div class="chapter" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title"><a name="jms"></a>&#31532;&nbsp;11&nbsp;&#31456;&nbsp;JMS</h2></div></div></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1503"></a>11.1.&nbsp;JMS&#19982;ActiveMQ&#29305;&#24615;</h2></div></div></div><p>JMS&#22987;&#32456;&#22312;JavaEE&#20116;&#33457;&#20843;&#38376;&#30340;&#21327;&#35758;&#37324;&#65292;WebService&#28385;&#22825;&#39134;&#30340;&#26102;&#20505;&#21344;&#19968;&#20301;&#32622;&#65292;&#26159;&#22240;&#20026;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>&#23427;&#21487;&#20197;&#25226;&#19981;&#24433;&#21709;&#29992;&#25143;&#25191;&#34892;&#32467;&#26524;&#21448;&#27604;&#36739;&#32791;&#26102;&#30340;&#20219;&#21153;&#65288;&#27604;&#22914;&#21457;&#37038;&#20214;&#36890;&#30693;&#31649;&#29702;&#21592;&#65289;&#24322;&#27493;&#30340;&#25172;&#32473;JMS &#26381;&#21153;&#31471;&#21435;&#20570;&#65292;&#32780;&#23613;&#24555;&#30340;&#25226;&#23631;&#24149;&#36820;&#36824;&#32473;&#29992;&#25143;&#12290; </p></li><li><p>&#26381;&#21153;&#31471;&#33021;&#22815;&#22810;&#32447;&#31243;&#25490;&#38431;&#21709;&#24212;&#39640;&#24182;&#21457;&#30340;&#35831;&#27714;&#65292;&#24182;&#20445;&#35777;&#35831;&#27714;&#19981;&#20002;&#22833;&#12290; </p></li><li><p>&#21487;&#20197;&#22312;Java&#19990;&#30028;&#37324;&#36798;&#21040;&#26368;&#39640;&#30340;&#35299;&#32806;&#12290;&#23458;&#25143;&#31471;&#19982;&#26381;&#21153;&#31471;&#26080;&#38656;&#30452;&#36830;&#65292;&#29978;&#33267;&#26080;&#38656;&#30693;&#26195;&#23545;&#26041;&#26159;&#35841;&#12289;&#22312;&#21738;&#37324;&#12289;&#26377;&#22810;&#23569;&#20154;&#65292;&#21482;&#35201;&#23545;&#27969;&#36807;&#30340;&#20449;&#24687;&#20316;&#21709;&#24212;&#23601;&#34892;&#20102;&#65292;&#22312;&#20225;&#19994;&#24212;&#29992;&#29615;&#22659;&#22797;&#26434;&#26102;&#20316;&#29992;&#26126;&#26174;&#12290; </p></li></ul></div><p>ActiveMQ&#30340;&#29305;&#24615;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>&#23436;&#20840;&#25903;&#25345;JMS1.1&#21644;J2EE 1.4&#35268;&#33539;&#30340; JMS Provider&#23454;&#29616;&#65292;&#20063;&#26159;Apache Geronimo&#40664;&#35748;&#30340;JMS provider&#12290;</p></li><li><p>POJO withdout EJB Container&#65292;&#19981;&#38656;&#35201;&#23454;&#29616;EJB&#32321;&#29712;&#22797;&#26434;&#30340;Message Bean&#25509;&#21475;&#21644;&#37197;&#32622;&#12290;</p></li><li><p>Spring Base&#65292;&#21487;&#20197;&#20351;&#29992;Spring&#30340;&#21508;&#31181;&#29305;&#24615;&#22914;IOC&#12289;AOP &#12290;</p></li><li><p>Effective&#65292;&#22522;&#20110;Jencks&#30340;JCA Container&#23454;&#29616; pool connection&#65292;control transactions and manage security&#12290;</p></li></ul></div><p>&#19968;&#20010;JMS&#22330;&#26223;&#36890;&#24120;&#38656;&#35201;&#19977;&#32773;&#21442;&#19982;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>&#19968;&#20010;POJO&#30340;&#30340;Message Producer&#65292;&#36127;&#36131;&#20351;&#29992;Spring&#30340;JMS Template&#21457;&#36865;&#28040;&#24687;&#12290; </p></li><li><p>&#19968;&#20010;Message Converter&#65292;&#36127;&#36131;&#25226;Java&#23545;&#35937;&#22914;&#35746;&#21333;(Order)&#36716;&#21270;&#20026;&#28040;&#24687;&#65292;&#20351;&#24471;Producer&#33021;&#22815;&#30452;&#25509;&#21457;&#36865;POJO&#12290; </p></li><li><p>&#19968;&#20010;MDP Message Consumer&#65292;&#36127;&#36131;&#25509;&#25910;&#24182;&#22788;&#29702;&#28040;&#24687;&#12290; </p></li></ul></div></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1531"></a>11.2.&nbsp;&#20351;&#29992;ActiveMQ</h2></div></div></div><p>ActiveMQ 5.2.0&#19982;Spring 2.0 &#38598;&#25104;&#26377;&#19977;&#20010;&#20540;&#24471;&#30041;&#24847;&#30340;&#22320;&#26041;&#65292;&#20351;&#24471;&#20195;&#30721;&#20013;&#20960;&#20046;&#19981;&#35265;&#19968;&#19997;JMS&#30340;&#20405;&#20837;&#20195;&#30721;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>&#37319;&#29992;Spring2.0&#30340;Schema&#24335;&#31616;&#21270;&#37197;&#32622;&#12290; </p></li><li><p>&#23454;&#29616;Message Converter&#36716;&#21270;&#28040;&#24687;&#19982;&#23545;&#35937;&#65292;&#20351;&#24471;Producer&#33021;&#22815;&#30452;&#25509;&#21457;&#36865;POJO&#32780;&#19981;&#26159;JMS Message&#12290; </p></li><li><p>&#20351;&#29992;&#20102;Spring2.0&#30340;DefaultMessageListenerContainer&#19982;MessageListenerAdapter&#65292;&#28040;&#24687;&#25509;&#25910;&#32773;&#19981;&#29992;&#23454;&#29616;MessageListener &#25509;&#21475;&#12290; </p></li><li><p>&#21516;&#26102;&#65292;Spring 2.0&#30340;DefaultMessageListenerContainer &#20195;&#26367;&#20102;SS1.0M3&#20013;&#30340;Jenck(JCA Container)&#65292;&#20805;&#24403;MDP Container&#30340;&#35282;&#33394;&#12290; </p></li></ul></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1543"></a>11.2.1.&nbsp;&#24341;&#20837;ActiveMQ&#30340;XSD</h3></div></div></div><p>&#22312;ApplicationContext.xml(Spring&#30340;&#37197;&#32622;&#25991;&#20214;)&#20013;&#24341;&#20837;ActiveMQ&#30340;XML Scheam &#37197;&#32622;&#25991;&#20214;),&#22914;&#19979;:</p><pre class="programlisting">
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:amq="http://activemq.org/config/1.0"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
       http://activemq.org/config/1.0
       http://people.apache.org/repository/org.apache.activemq/xsds/activemq-core-5.2.0.xsd"&gt;
            </pre></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1547"></a>11.2.2.&nbsp;&#37197;&#32622;ActiveMQ Broker</h3></div></div></div><p>&#37319;&#29992;&#22312;JVM&#20013;&#23884;&#20837;&#36825;&#31181;&#26368;&#31616;&#21333;&#30340;&#27169;&#24335;&#65292;&#24403;spring&#21021;&#22987;&#21270;&#26102;&#20505;&#65292;ActiveMQ embedded Broker&#23601;&#20250;&#21551;&#21160;&#20102;&#12290;</p><pre class="programlisting">
&lt;amq:broker useJmx="false" persistent="false"&gt;
    &lt;amq:transportConnectors&gt;
        &lt;amq:transportConnector uri="tcp://localhost:0"/&gt;
    &lt;/amq:transportConnectors&gt;
&lt;/amq:broker&gt;
            </pre></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1551"></a>11.2.3.&nbsp;&#37197;&#32622;(A)ConnectionFactory</h3></div></div></div><p>&#30001;&#20110;&#21069;&#38754;&#37197;&#32622;&#30340;Broker&#26159;JVM embedded &#25152;&#20197;URL&#20026;:vm://localhost</p><pre class="programlisting">
 &lt;amq:connectionFactory id="jmsConnectionFactory" brokerURL="vm://localhost"/&gt;
            </pre></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1555"></a>11.2.4.&nbsp;&#37197;&#32622;(B)Queue</h3></div></div></div><pre class="programlisting">
&lt;amq:queue name="destination" physicalName="org.apache.activemq.spring.Test.spring.embedded"/&gt;
            </pre></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1558"></a>11.2.5.&nbsp;&#37197;&#32622;(C)Converter</h3></div></div></div><p>&#37197;&#32622;Conveter&#65292;&#20351;&#24471;Producer&#33021;&#22815;&#30452;&#25509;&#21457;&#36865;Order&#23545;&#35937;&#65292;&#32780;&#19981;&#26159;JMS&#30340;Message&#23545;&#35937;&#12290;</p><pre class="programlisting">
&lt;bean id="orderMessageConverter" class="org.springside.bookstore.components.activemq.OrderMessageConverter"/&gt;
            </pre></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1562"></a>11.2.6.&nbsp;&#21457;&#36865;&#31471;</h3></div></div></div><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e1564"></a>11.2.6.1.&nbsp;&#37197;&#32622;JmsTemplate</h4></div></div></div><p>Spring&#25552;&#20379;&#30340;Template&#65292;&#32465;&#23450;&#20102;(A)ConnectionFactory&#19982;(C)Converter&#12290;</p><pre class="programlisting">
&lt;bean id="jmsTemplate" class="org.springframework.jms.core.JmsTemplate"&gt;
    &lt;property name="connectionFactory"&gt;
        &lt;bean class="org.springframework.jms.connection.SingleConnectionFactory"&gt;
            &lt;property name="targetConnectionFactory" ref="jmsConnectionFactory"/&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name="messageConverter" ref="userMessageConverter"/&gt;
&lt;/bean&gt;
                </pre></div><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e1568"></a>11.2.6.2.&nbsp;Producer</h4></div></div></div><p>&#28040;&#24687;&#21457;&#36865;&#32773;&#65292;&#20351;&#29992;JmsTemplate&#21457;&#36865;&#28040;&#24687;&#65292;&#32465;&#23450;&#20102;JmsTemplate (&#21547;A&#12289;C)&#19982;(B)Queue&#12290;</p><pre class="programlisting">
&lt;bean id="userMessageProducer" class="com.family168.UserMessageProducer"&gt;
    &lt;property name="template" ref="jmsTemplate"/&gt;
    &lt;property name="destination" ref="destination"/&gt;
&lt;/bean&gt;
                </pre></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1572"></a>11.2.7.&nbsp;&#25509;&#25910;&#31471;</h3></div></div></div><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e1574"></a>11.2.7.1.&nbsp;&#25509;&#25910;&#22788;&#29702;&#32773;(MDP)</h4></div></div></div><p>&#20351;&#29992;Spring&#30340;MessageListenerAdapter&#65292;&#25351;&#23450;&#36127;&#36131;&#22788;&#29702;&#28040;&#24687;&#30340;POJO&#21450;&#20854;&#26041;&#27861;&#21517;&#65292;&#32465;&#23450;(C)Converter&#12290;</p><pre class="programlisting">
&lt;bean id="messageListener" class="org.springframework.jms.listener.adapter.MessageListenerAdapter"&gt;
    &lt;constructor-arg&gt;
        &lt;bean class="com.family168.MessageConsumer"/&gt;
    &lt;/constructor-arg&gt;
    &lt;property name="defaultListenerMethod" value="sendMessage"/&gt;
    &lt;property name="messageConverter" ref="userMessageConverter"/&gt;
&lt;/bean&gt;
                </pre></div><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e1578"></a>11.2.7.2.&nbsp;listenerContainer</h4></div></div></div><p>&#36127;&#36131;&#35843;&#24230;MDP&#65292;&#32465;&#23450;(A) connectionFactory, (B)Queue&#21644;MDP&#12290;</p><pre class="programlisting">
&lt;bean id="listenerContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer"&gt;
    &lt;property name="connectionFactory" ref="jmsConnectionFactory"/&gt;
    &lt;property name="destination" ref="destination"/&gt;
    &lt;property name="messageListener" ref="messageListener"/&gt;
&lt;/bean&gt;
                </pre></div></div><p>&#20114;&#30456;&#32465;&#23450;&#30340;&#20851;&#31995;&#26377;&#28857;&#26197;&#65292;&#21457;&#36865;&#31471;&#21644;&#25509;&#25910;&#31471;&#37117;&#20197;&#19981;&#21516;&#24418;&#24335;&#32465;&#23450;&#20102;(A) connectionFactory, (B)Queue&#21644; (C)Converter&#12290;</p></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1583"></a>11.3.&nbsp;&#25345;&#20037;&#21270;&#28040;&#24687;</h2></div></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1585"></a>11.3.1.&nbsp;&#32473;Broker&#21152;&#20837;Persistence &#37197;&#32622;</h3></div></div></div><pre class="programlisting">
&lt;amq:persistenceAdapter&gt;
    &lt;amq:jdbcPersistenceAdapter id="jdbcAdapter" dataSource="#hsql-ds" createTablesOnStartup="true" useDatabaseLock="false"/&gt;
&lt;/amq:persistenceAdapter&gt;
            </pre><p>&#35831;&#27880;&#24847;MSSQL(2000/2005)&#21644;HSQL&#30001;&#20110;&#19981;&#25903;&#25345;[SELECT * ACTIVEMQ_LOCK FOR UPDATE]&#35821;&#27861;,&#22240;&#27492;&#19981;&#33021;&#20351;&#29992;&#40664;&#35748;&#30340;userDatabaseLock="true",&#21482;&#33021;&#35774;&#32622;&#25104;useDatabaseLock="false"</p></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1589"></a>11.3.2.&nbsp;&#37197;&#32622;&#22810;&#31181;&#25968;&#25454;&#28304;</h3></div></div></div><p>&#20351;&#29992;&#30340;&#20869;&#23884;HSQL</p><pre class="programlisting">
&lt;bean id="hsql-ds" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
    &lt;property name="driverClassName" value="org.hsqldb.jdbcDriver"/&gt;
    &lt;property name="url" value="jdbc:hsqldb:res:db/activemq"/&gt;
    &lt;property name="username" value="sa"/&gt;
    &lt;property name="password" value=""/&gt;
&lt;/bean&gt;
            </pre></div></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1593"></a>11.4.&nbsp;Jenck(JCA Container)</h2></div></div></div><p>Spring 2.0&#26412;&#36523;&#20351;&#29992;DefaultMessageListenerContainer &#21487;&#20197;&#20805;&#24403;MDP&#20013;&#30340;Container&#35282;&#33394;&#65292;&#20294;&#26159;&#37492;&#20110;Jencks&#26159;JCA&#26631;&#20934;&#30340;&#65292;&#23427;&#19981;&#20165;&#20165;&#33021;&#22815;&#25552;&#20379;jms&#30340;jca&#25972;&#21512;&#65292;&#21253;&#25324;&#20854;&#20182;&#36164;&#28304;&#27604;&#22914;jdbc&#37117;&#21487;&#20197;&#20570;&#21040;jca&#31649;&#29702;</p><p>&#25152;&#20197;&#65292;&#21516;&#26102;&#23436;&#25104;&#20102;&#36825;&#20010;ActiveMQ + Spring + Jencks&#37197;&#32622;&#28436;&#31034;&#65292;&#26356;&#22810;&#30340;&#38024;&#23545;&#29983;&#20135;&#31995;&#32479;&#30340;JCA&#29305;&#24615;&#23637;&#31034;&#65292;&#20250;&#22312;&#31245;&#21518;&#30340;&#24320;&#21457;&#35745;&#21010;&#35752;&#35770;&#20013;&#30830;&#23450;&#12290;</p><p>&#27492;&#25991;&#26723;&#36866;&#29992;&#20110;&#35828;&#26126;&#20351;&#29992;Jencks&#21644;&#20351;&#29992;Spring 2.0(DefaultMessageListenerContainer)&#20805;&#24403;MDP Container&#26102;&#30340;&#21306;&#21035;&#65292;&#21516;&#26102;&#28436;&#31034;Jenck&#30340;Spring 2.0&#26032;&#37197;&#32622;&#23454;&#20363;&#12290;</p><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1598"></a>11.4.1.&nbsp;&#24341;&#20837;ActiveMQ ResourceAdapter&#21644;Jencks&#30340;XSD</h3></div></div></div><p>&#22312;ApplicationContext.xml(Spring&#30340;&#37197;&#32622;&#25991;&#20214;)&#20013;&#24341;&#20837;ActiveMQ ResourceAdapter&#21644;Jencks&#30340;XML Scheam&#37197;&#32622;&#25991;&#20214;)&#65292;&#22914;&#19979;&#65306;</p><pre class="programlisting">
&lt;beans
  xmlns="http://www.springframework.org/schema/beans"
  xmlns:amq="http://activemq.apache.org/schema/core"
  xmlns:amqra="http://activemq.apache.org/schema/ra"
  xmlns:jencks="http://jencks.org/2.1"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
  http://activemq.apache.org/schema/core
  http://activemq.apache.org/schema/core/activemq-core-5.2.0.xsd
  http://activemq.apache.org/schema/ra
  http://activemq.apache.org/schema/ra/activemq-ra-5.2.0.xsd
  http://jencks.org/2.1
  http://repository.codehaus.org/org/jencks/jencks/2.1/jencks-2.1.xsd"&gt;
            </pre><p>&#37197;&#32622;ActiveMQ Broker&#21442;&#35265;ActiveMQ + Spring</p><p>Jencks&#25552;&#20379;&#30340;&#37027;&#20010;xsd&#26377;&#28857;&#20799;&#38382;&#39064;&#65292;&#19981;&#25903;&#25345;&#26631;&#31614;&#23884;&#22871;(&#26159;xs:any&#20803;&#32032;&#24341;&#36215;&#30340;&#38169;&#35823;)&#65292;&#25152;&#20197;&#25105;&#20204;&#25226;&#23427;&#30340;xsd&#20462;&#25913;&#19968;&#19979;&#65292;&#21487;&#20197;&#35753;&#37197;&#32622;&#25991;&#20214;&#37324;&#26174;&#24471;&#26356;&#32039;&#20945;&#19968;&#20123;&#12290;</p><p>&#22312;classpath/META-INF&#30446;&#24405;&#19979;&#25918;&#32622;jencks&#38656;&#35201;&#30340;services&#30446;&#24405;&#65292;jencks.xsd&#65292;spring.handlers&#21644;spring.schemas&#12290;</p></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1605"></a>11.4.2.&nbsp;&#37197;&#32622;ActiveMQ Resource Adapter</h3></div></div></div><pre class="programlisting">
&lt;amqra:resourceAdapter id="resourceAdapter" serverUrl="vm://localhost" /&gt;
&lt;amqra:managedConnectionFactory id="jmsManagedConnectionFactory" resourceAdapter="#resourceAdapter"/&gt;
            </pre></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1608"></a>11.4.3.&nbsp;&#37197;&#32622;Jencks&#22522;&#30784;&#37197;&#32622;</h3></div></div></div><p>&#20855;&#20307;&#30340;&#37197;&#32622;&#21487;&#20197;&#21442;&#35265;Jencks&#30340;XSD</p><pre class="programlisting">
&lt;jencks:transactionManager id="transactionManager"/&gt;

&lt;jencks:connectionManager id="connectionManager" transactionManager="#transactionManager"/&gt;
            </pre><p>&#37197;&#32622;&#32473;JmsTemplate&#20351;&#29992;&#30340;connectionFactory (&#20027;&#35201;&#26159;&#29983;&#25104;&#32773;/&#21457;&#36865;&#32773; &#20351;&#29992;)</p><p>&#36825;&#37324;&#27880;&#24847;&#19979;,&#22312;&#37197;&#32622;jmsTemplate&#30340;&#20351;&#29992;&#30340;targetConnectionFactory&#23601;&#26159;&#20351;&#29992;jencks&#37197;&#32622;&#30340;connectionManager</p><pre class="programlisting">
&lt;bean id="jmsManagerConnectionFactory" class="org.springframework.jca.support.LocalConnectionFactoryBean"&gt;
    &lt;property name="managedConnectionFactory" ref="jmsManagedConnectionFactory"/&gt;
    &lt;property name="connectionManager" ref="connectionManager"/&gt;
&lt;/bean&gt;

&lt;bean id="jmsTemplate" class="org.springframework.jms.core.JmsTemplate"&gt;
    &lt;property name="connectionFactory"&gt;
        &lt;bean class="org.springframework.jms.connection.SingleConnectionFactory"&gt;
            &lt;property name="targetConnectionFactory" ref="jmsManagerConnectionFactory"/&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name="messageConverter" ref="userMessageConverter"/&gt;
&lt;/bean&gt;
            </pre><p>&#37197;&#32622;Spring 2.0&#30340;MessageListenerAdapter,&#20445;&#35777;&#19981;&#38656;&#35201;&#29992;&#25143;&#23454;&#29616;MessageListener</p></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1616"></a>11.4.4.&nbsp;&#37197;&#32622;Jencks&#20805;&#24403;MDP&#30340;Container</h3></div></div></div><p>&#23601;&#26159;&#25226;&#19978;&#38754;&#30340;MessageListenerAdapter&#37197;&#32622;&#21040;Jencks&#37324;&#38754;,&#23436;&#25104;&#25972;&#20010;MDP&#30340;&#37197;&#32622;</p><pre class="programlisting">
&lt;jencks:connector ref="messageListener"&gt;
    &lt;jencks:activationSpec&gt;
        &lt;amqra:activationSpec destination="org.apache.activemq.spring.Test.spring.embedded"
                              destinationType="javax.jms.Queue"/&gt;
    &lt;/jencks:activationSpec&gt;
    &lt;jencks:jcaContainer&gt;
        &lt;jencks:jcaContainer resourceAdapter="#resourceAdapter"&gt;
            &lt;jencks:bootstrapContext&gt;
                &lt;jencks:bootstrapContext threadPoolSize="25" transactionManager="#transactionManager"/&gt;
            &lt;/jencks:bootstrapContext&gt;
        &lt;/jencks:jcaContainer&gt;
    &lt;/jencks:jcaContainer&gt;
&lt;/jencks:connector&gt;
            </pre></div></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1620"></a>11.5.&nbsp;Lingo</h2></div></div></div><p>Lingo&#26159;&#36827;&#19968;&#27493;&#23553;&#35013;JMS&#32454;&#33410;&#30340;Pure POJO&#36828;&#31243;&#35843;&#29992;&#26694;&#26550;&#65292;&#25552;&#20379;&#19968;&#31181;&#36828;&#31243;&#35843;&#29992;&#65292;&#23588;&#20854;&#26159;&#23427;&#30340;&#24322;&#27493;&#35843;&#29992;(&#21253;&#25324;&#24322;&#27493;&#22238;&#35843;)&#21487;&#20197;&#24110;&#21161;&#26500;&#24314;&#24378;&#22823;&#30340;&#24322;&#27493;&#20107;&#20214;&#36890;&#30693;&#31995;&#32479;&#12290;</p><p>&#20854;&#24037;&#20316;&#27969;&#31243;&#22914;&#19979;&#25152;&#31034;&#65306;</p><pre class="screen">
&#38750;&#24120;&#32321;&#37325;&#30340;&#24037;&#20316;&#38431;&#21015; -------&gt; &#19994;&#21153;A(&#24517;&#39035;&#35201;&#35843;&#29992;&#36828;&#31243;&#19994;&#21153;B[&#32780;&#19988;B&#19994;&#21153;&#36825;&#37324;&#38750;&#24120;&#32791;&#26102;])
                                                |
                                                | callBack&#27744;(&#27599;&#20010;callBack&#21487;&#20197;&#29420;&#31435;,&#20063;&#21487;&#20197;&#20351;&#29992;&#19968;&#20010;callBack)
                                                |
                                                | &#20351;&#29992;&#24322;&#27493;&#22238;&#35843;(callBack,&#21442;&#25968;)
                                                |
                                                |
                                                v
                               &#36828;&#31243;&#19994;&#21153;B(&#32791;&#26102;&#30340;IO/DAO&#35843;&#29992;,&#28982;&#21518;&#22238;&#35843;callBack)

        </pre><p>lingo&#23454;&#38469;&#19978;&#26159;&#25226;&#26080;&#29366;&#24577;&#65292;&#19981;&#21516;&#27493;&#30340;jms&#23553;&#35013;&#25104;&#21516;&#27493;&#35843;&#29992;&#30340;&#24418;&#24335;&#26469;&#20351;&#29992;&#65292;&#23427;&#20808;&#32473;&#23458;&#25143;&#31471;&#29983;&#25104;&#19968;&#20010;&#22522;&#20110;&#26381;&#21153;&#31471;&#30340;proxy&#65292;&#22312;&#23458;&#25143;&#31471;&#35843;&#29992;proxy&#30340;&#26102;&#20505;&#21457;&#36865;jms&#28040;&#24687;&#65292;&#21516;&#26102;&#22312;&#23458;&#25143;&#31471;&#29983;&#25104;&#19968;&#20010;&#20250;&#35843;&#29992;&#30340;&#20020;&#26102;queue&#65292;&#36825;&#26679;&#26381;&#21153;&#22120;&#31471;&#22312;&#22788;&#29702;&#20102;&#25968;&#25454;&#20043;&#21518;&#20250;&#21521;&#23458;&#25143;&#31471;&#30340;&#20020;&#26102;queue&#21457;&#36865;&#28040;&#24687;&#65292;&#22312;&#26381;&#21153;&#22120;&#31471;&#36827;&#34892;&#35745;&#31639;&#30340;&#26102;&#20505;&#65292;lingo&#20351;&#29992;concurrent&#21253;&#20013;&#30340;api&#19968;&#30452;&#22581;&#22622;&#30417;&#21548;&#65292;&#30452;&#21040;&#26381;&#21153;&#22120;&#31471;&#36820;&#22238;&#20102;&#25968;&#25454;&#65292;&#25165;&#23558;&#25968;&#25454;&#36820;&#22238;&#12290;&#20197;&#27492;&#26041;&#24335;&#26469;&#27169;&#25311;&#21516;&#27493;&#35843;&#29992;&#12290;</p><p>&#22914;&#26524;&#26159;&#24322;&#27493;&#35843;&#29992;&#65292;&#23458;&#25143;&#31471;&#20250;&#30452;&#25509;&#21457;&#36865;jms&#35831;&#27714;&#65292;&#36825;&#26102;&#38656;&#35201;&#22312;&#35843;&#29992;&#26041;&#27861;&#30340;&#21442;&#25968;&#20013;&#21152;&#20837;&#19968;&#20010;&#23454;&#29616;&#20102;EventListener&#30340;&#21442;&#25968;&#65292;lingo&#20250;&#33258;&#21160;&#25226;&#36825;&#20010;&#21442;&#25968;&#20316;&#20026;&#36828;&#31243;&#23545;&#35937;&#65292;&#22312;&#23458;&#25143;&#31471;&#29983;&#25104;&#20020;&#26102;queue&#65292;&#26381;&#21153;&#22120;&#31471;&#22312;&#33719;&#24471;&#28040;&#24687;&#21518;&#20063;&#20026;&#36825;&#20010;EventListener&#29983;&#25104;&#23545;&#24212;&#30340;proxy&#65292;&#24182;&#26381;&#21153;&#22120;&#31471;&#35843;&#29992;proxy&#30340;&#26102;&#20505;&#65292;&#21457;&#36865;jms&#28040;&#24687;&#65292;&#23458;&#25143;&#31471;&#30417;&#21548;&#21040;&#28040;&#24687;&#30340;&#36820;&#22238;&#65292;&#23601;&#23454;&#29616;&#20102;&#24322;&#27493;&#22238;&#35843;&#12290;</p><p>&#20351;&#29992;&#26102;&#38656;&#35201;&#27880;&#24847;&#20960;&#28857;&#65306;</p><div class="orderedlist"><ol type="1"><li><p>&#39318;&#20808;&#32487;&#25215;JmsServiceExporter&#65292;&#20462;&#25913;createRemoteProxy()&#26041;&#27861;&#65292;&#25226;oneway=true&#30340;MetadataStrategy&#25918;&#21040;JmsProxyFactoryBean&#20013;&#65292;&#22914;&#26524;&#20351;&#29992;&#23427;&#40664;&#35748;&#25552;&#20379;&#30340;JmsServiceExporter&#20316;&#20026;&#26381;&#21153;&#31471;&#65292;&#20250;&#19968;&#30452;&#25253;&#36229;&#26102;&#38169;&#35823;&#12290;</p><p>&#36825;&#26159;&#22240;&#20026;lingo&#30340;&#21407;&#29702;&#26159;&#20351;&#29992;proxy&#65292;&#25226;&#26041;&#27861;&#35843;&#29992;&#30340;&#35831;&#27714;&#23553;&#35013;&#21040;ObjectMessage&#20013;&#65292;&#21457;&#36865;&#32473;&#26381;&#21153;&#22120;&#65292;&#22914;&#26524;&#26041;&#27861;&#35843;&#29992;&#30340;&#21442;&#25968;&#20026;Remote&#25110;EventListener&#31867;&#22411;&#65292;&#23601;&#20250;&#20808;&#22312;&#23458;&#25143;&#31471;&#20934;&#22791;&#19968;&#20010;&#20020;&#26102;&#30340;queue&#65292;&#31561;&#24453;&#28040;&#24687;&#20256;&#36882;&#32473;&#26381;&#21153;&#22120;&#21518;&#65292;&#20877;&#27425;&#29983;&#25104;&#23545;&#24212;&#30340;proxy&#65292;&#22312;&#26381;&#21153;&#22120;&#31471;&#35843;&#29992;proxy&#30340;&#26102;&#20505;&#65292;&#21457;&#36865;&#28040;&#24687;&#32473;&#23458;&#25143;&#31471;&#30340;&#20020;&#26102;queue&#65292;&#36825;&#26679;&#24418;&#25104;&#20102;callback&#22238;&#35843;&#12290;&#20294;&#26159;&#20174;&#26381;&#21153;&#22120;&#21040;&#26412;&#22320;&#30340;jms&#26159;&#19981;&#20250;&#26377;&#21709;&#24212;&#30340;&#65292;&#22914;&#26524;&#19981;&#25226;&#26381;&#21153;&#22120;&#31471;&#30340;oneway&#35774;&#32622;&#20026;true&#65292;&#26381;&#21153;&#22120;&#31471;&#20250;&#20197;&#20026;&#23458;&#25143;&#31471;&#36824;&#35201;&#36820;&#22238;&#19968;&#26465;jms&#28040;&#24687;&#65292;&#23601;&#20250;&#36896;&#25104;&#31561;&#24453;&#65292;&#19968;&#30452;&#31561;&#24453;&#19981;&#21040;&#32467;&#26524;&#65292;&#23601;&#20250;&#20986;&#29616;&#36229;&#26102;&#38169;&#35823;&#12290;</p></li><li><p>&#20854;&#27425;&#65292;&#20174;lingo-1.1&#20043;&#21518;&#30340;&#25152;&#26377;&#29256;&#26412;&#37117;&#23384;&#22312;&#19968;&#20010;&#38382;&#39064;&#65292;&#40664;&#35748;&#30340;Requestor&#19981;&#25903;&#25345;&#22238;&#35843;&#65292;&#22312;&#25191;&#34892;send()&#30340;&#26102;&#20505;&#27809;&#26377;&#25226;&#23458;&#25143;&#31471;&#29983;&#25104;&#30340;&#20020;&#26102;queue&#21517;&#31216;&#25918;&#21040;jms&#28040;&#24687;&#20013;&#65292;&#36896;&#25104;callback&#30340;&#26102;&#20505;&#19968;&#30452;&#25253;&#38169;&#12290;</p><p>&#38656;&#35201;&#32487;&#25215;MultiplexingRequestor&#65292;&#22312;doSend()&#26041;&#27861;&#20013;&#28155;&#21152;populateHeaders(message);&#35774;&#32622;&#23458;&#25143;&#31471;&#29983;&#25104;&#30340;&#20020;&#26102;queue&#65292;&#25165;&#33021;&#23454;&#29616;&#22238;&#35843;&#12290;</p></li></ol></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="drools.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="search.html">&#19979;&#19968;&#39029;</a></td></tr><tr><td width="40%" align="left" valign="top">&#31532;&nbsp;10&nbsp;&#31456;&nbsp;drools&#35268;&#21017;&#24341;&#25806;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">&#36215;&#22987;&#39029;</a></td><td width="40%" align="right" valign="top">&nbsp;&#31532;&nbsp;12&nbsp;&#31456;&nbsp;&#20840;&#25991;&#26816;&#32034;</td></tr></table></div></body></html>