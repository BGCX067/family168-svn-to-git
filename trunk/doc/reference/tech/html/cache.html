<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>&#31532;&nbsp;20&nbsp;&#31456;&nbsp;&#32531;&#23384;</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.2"><style type="text/css">
body { background-image: url('images/draft.png');
       background-repeat: no-repeat;
       background-position: top left;
       /* The following properties make the watermark "fixed" on the page. */
       /* I think that's just a bit too distracting for the reader... */
       /* background-attachment: fixed; */
       /* background-position: center center; */
     }</style><link rel="start" href="index.html" title="Leona"><link rel="up" href="index.html" title="Leona"><link rel="prev" href="logger.html" title="&#31532;&nbsp;19&nbsp;&#31456;&nbsp;&#26085;&#24535;"><link rel="next" href="test.html" title="&#31532;&nbsp;21&nbsp;&#31456;&nbsp;&#27979;&#35797;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns="http://www.w3.org/TR/xhtml1/transitional" xmlns:fo="http://www.w3.org/1999/XSL/Format" style="background-color:white;border:none;height:73px;border:1px solid black;"><a style="border:none;" href="http://www.family168.com/" title="Family168"><img src="images/family168.png" border="0"></img></a></div><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">&#31532;&nbsp;20&nbsp;&#31456;&nbsp;&#32531;&#23384;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="logger.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="test.html">&#19979;&#19968;&#39029;</a></td></tr></table><hr></div><div class="chapter" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title"><a name="cache"></a>&#31532;&nbsp;20&nbsp;&#31456;&nbsp;&#32531;&#23384;</h2></div></div></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e2155"></a>20.1.&nbsp;Cache&#36164;&#26009;</h2></div></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e2157"></a>20.1.1.&nbsp;&#27010;&#36848;</h3></div></div></div><p>Cache&#26377;&#20174;&#21069;&#21040;&#21518;&#26377;&#24456;&#22810;&#20010;&#23618;&#27425;&#65292;&#36234;&#38752;&#36817;&#23458;&#25143;&#65292;&#32531;&#23384;&#30340;&#25928;&#26524;&#36234;&#26126;&#26174;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>&#25968;&#25454;&#24211;&#33258;&#36523;&#30340;&#32531;&#23384;</p></li><li><p>Data Access&#23545;&#25968;&#25454;&#23545;&#35937;&#21450;&#26597;&#35810;&#32467;&#26524;&#30340;&#20108;&#32423;&#32531;&#23384;&#65292;&#20856;&#22411;&#22914;Hibernate&#12290;</p></li><li><p>&#19994;&#21153;&#32423;&#32531;&#23384;&#65292;&#21253;&#25324;Spring&#29992;AOP&#23454;&#29616;&#30340;&#26041;&#27861;&#32423;&#32531;&#23384;&#12290;</p></li><li><p>&#39029;&#38754;&#29255;&#27573;&#19982;&#39029;&#38754;&#20869;&#23481;&#30340;&#32531;&#23384;&#12290;</p></li></ul></div><p>&#32531;&#23384;&#26159;&#23545;&#33719;&#21462;&#20195;&#20215;&#36739;&#20026;&#26114;&#36149;&#36164;&#28304;&#30340;cache&#65292;&#24847;&#24605;&#26159;cache&#26159;&#21487;&#20002;&#22833;&#30340;&#65292;&#22240;&#27492;&#36890;&#24120;&#20250;&#38480;&#21046;&#24635;&#37327;&#22823;&#23567;&#65292;&#28982;&#21518;&#37319;&#29992;&#20808;&#36827;&#20808;&#20986;&#65292;&#26368;&#36817;&#35775;&#38382;&#31561;&#31639;&#27861;&#22312;&#28322;&#20986;&#26102;&#20002;&#22833;&#37096;&#20998;&#32531;&#23384;&#65292;&#25110;&#32773;&#37319;&#29992;max_idle_time&#65292;max_live_time&#26102;&#20027;&#21160;&#28165;&#38500;&#21033;&#29992;&#29575;&#20559;&#20302;&#30340;&#32531;&#23384;&#65292;&#23458;&#25143;&#22312;&#37325;&#26032;&#38656;&#35201;&#24050;&#34987;&#20002;&#22833;&#30340;&#32531;&#23384;&#26102;&#65292;&#20250;&#37325;&#26032;&#20174;&#36164;&#28304;&#22788;&#33719;&#21462;&#65292;&#36825;&#26159;&#21644;&#20869;&#23384;/HashMap&#26368;&#22823;&#30340;&#19981;&#21516;&#12290;</p><p>&#32531;&#23384;&#21448;&#20998;&#26377;&#26412;&#22320;&#29420;&#31435;&#32531;&#23384;&#19982;&#38598;&#32676;&#20998;&#24067;&#24335;&#32531;&#23384;&#20004;&#31181;&#65292;&#30446;&#21069;&#22823;&#37096;&#20998;&#29420;&#31435;&#32531;&#23384;&#26041;&#26696;&#37117;&#25903;&#25345;&#20102;&#20998;&#24067;&#24335;&#30340;&#25193;&#23637;&#12290;</p><p>&#21478;&#22806;&#26377;&#20010;Jofti&#65292;&#33021;&#22815;&#23545;Ehcance&#65292;OSCache&#65292;JBoss Cache&#20013;&#30340;&#20869;&#23481;&#36827;&#34892;&#32034;&#24341;&#19982;&#26597;&#25214;&#65292;&#21487;&#24796;&#19981;&#21457;&#23637;&#20102;&#12290;(Cache&#26041;&#26696;&#26412;&#36523;&#21482;&#25903;&#25345;&#20197;key&#26597;&#25214;)</p></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e2172"></a>20.1.2.&nbsp;&#20998;&#24067;&#24335;&#32531;&#23384;</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Give your DB a Break(TSS)</p></li><li><p>The Essential Lessons of Distributed Caching(JavaZone 2006)</p></li><li><p>Caching and Grid in a Nutshell(JavaZone 2006)</p></li></ul></div><p>&#32531;&#23384;&#65292;&#29992;&#19968;&#20010;&#20027;&#38190;&#21487;&#20197;&#23384;&#25918;&#21644;&#33719;&#21462;&#25968;&#25454;&#12290;&#32780;&#20998;&#24067;&#24335;&#32531;&#23384;&#65292;&#21017;&#23454;&#29616;&#20102;&#22312;&#25968;&#21488;&#26426;&#22120;&#38388;&#65292;&#29992;&#21516;&#19968;&#20010;&#20027;&#38190;&#33021;&#33719;&#24471;&#30456;&#31561;&#30340;&#23545;&#35937;&#12290;</p><p>&#38500;&#20102;&#29992;&#20316;&#32531;&#23384;&#36229;&#22823;&#35268;&#27169;&#25968;&#25454;&#22806;&#65292;&#20998;&#24067;&#24335;&#32531;&#23384;&#20063;&#26159;&#23454;&#29616;&#32676;&#38598;&#30340;&#37325;&#35201;&#25163;&#27573;&#12290;&#22240;&#20026;JavaEE&#30340;&#32676;&#38598;&#20027;&#35201;&#23454;&#29616;&#20102;HTTP Session&#12289;EJB&#12289;JMS&#30340;&#32676;&#38598;&#65292;&#20294;&#20854;&#23454;&#36824;&#26377;&#26356;&#22810;&#30340;&#26222;&#36890;Java&#23545;&#35937;&#38656;&#35201;&#34987;&#38598;&#32676;&#30340;&#65292;&#21542;&#21017;&#23601;&#20250;&#38480;&#20110;Stateless, Share Nothing&#30340;&#26550;&#26500;&#12290;</p><p>&#20998;&#24067;&#24335;&#32531;&#23384;&#30340;&#26041;&#24335;&#26377;&#20004;&#31181;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>&#19968;&#31181;&#23601;&#26159;&#31616;&#21333;&#30340;&#21508;&#33258;&#20445;&#30041;&#33258;&#24049;&#30340;&#32531;&#23384;&#23545;&#35937;&#65292;&#32676;&#21457;invalid&#36890;&#30693;&#12290;</p></li><li><p>&#19968;&#31181;&#26159;&#23454;&#29616;&#25968;&#25454;&#22797;&#21046;&#30340;&#38598;&#32676;&#27169;&#24335;&#12290;</p></li></ul></div><p>&#20998;&#24067;&#24335;&#32531;&#23384;&#30340;&#30446;&#30340;&#26377;&#20004;&#20010;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>Load Balance&#65306;&#25152;&#26377;&#30340;&#22788;&#29702;&#33410;&#28857;&#29992;&#30456;&#21516;&#30340;Key&#33719;&#24471;&#30456;&#21516;&#30340;&#25968;&#25454;&#65292;&#20351;&#24471;&#27599;&#20010;&#33410;&#28857;&#21487;&#20197;&#24179;&#31561;&#30340;&#39046;&#21462;&#20219;&#21153;&#22788;&#29702;&#32780;&#19981;&#24517;&#39038;&#24524;&#26410;&#34987;&#32676;&#38598;Share&#30340;&#31169;&#26377;State&#20449;&#24687;&#12290;</p></li><li><p>HA&#65306;Failover&#30340;&#25509;&#25163;&#22788;&#29702;&#26381;&#21153;&#22120;&#33021;&#29992;Key&#33719;&#24471;&#21069;&#19968;&#21488;&#22833;&#25928;&#26381;&#21153;&#22120;&#20013;&#30340;&#25152;&#26377;&#25968;&#25454;&#12290;</p></li></ul></div><p>&#20998;&#24067;&#24335;&#32531;&#23384;&#26550;&#26500;&#19978;&#26368;&#37325;&#35201;&#30340;&#23601;&#26159;&#22797;&#21046;&#31574;&#30053;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>&#20840;&#22797;&#21046;&#65306;&#27599;&#20010;&#33410;&#28857;&#25317;&#26377;&#25152;&#26377;&#25968;&#25454;&#30340;&#22791;&#20221;&#12290;&#36895;&#24230;&#26368;&#24555;&#30340;&#26041;&#24335;&#65292;&#21069;&#25552;&#26159;&#33410;&#28857;&#19981;&#22810;&#65292;&#20869;&#23384;&#22815;&#22823;&#65292;&#20889;&#25805;&#20316;&#19981;&#39057;&#32321;&#12290;</p></li><li><p>&#20998;&#21306;&#65306;&#26576;&#19968;&#25968;&#25454;&#21482;&#23384;&#22312;&#20110;&#20027;&#22791;&#26426;&#19978;&#12290;&#20294;&#23545;&#20351;&#29992;&#32773;&#26469;&#35828;&#20998;&#21306;&#26159;&#36879;&#26126;&#30340;--&#32447;&#24615;&#25193;&#23637;&#24615;&#26368;&#39640;&#30340;&#26041;&#24335;&#12290;</p></li><li><p>Near&#65306;&#22312;&#20998;&#21306;&#30340;&#22522;&#30784;&#19978;&#65292;&#22686;&#21152;L1&#32423;&#32531;&#23384;&#65292;&#26412;&#22320;&#32531;&#23384;&#24120;&#29992;&#25968;&#25454;&#65292;&#20197;&#22823;&#24133;&#22686;&#21152;&#35835;&#21462;&#24615;&#33021;&#12290;</p></li><li><p>&#20013;&#22830;&#26381;&#21153;&#22120;&#65306;&#25152;&#26377;&#33410;&#28857;&#37117;&#25226;&#25968;&#25454;&#21516;&#27493;&#21040;&#20013;&#22830;&#33410;&#28857;&#12290;&#23454;&#29616;&#26368;&#31616;&#21333;&#30340;&#26041;&#24335;&#12290;</p></li></ul></div><p>&#21487;&#35265;&#65292;Memcached&#26159;&#20013;&#22830;&#26381;&#21153;&#22120;&#24335;&#65292;TerraCotta&#26159;&#36879;&#26126;&#30340;&#20013;&#22830;&#26381;&#21153;&#22120;&#38598;&#32676;&#24335;&#12290;Tangosol&#25903;&#25345;&#20840;&#22797;&#21046;/&#20998;&#21306;/Near&#26550;&#26500;&#12290;</p><p>&#32780;&#20687;Ehcache&#65292;OSCache&#65292;JBossCache&#36825;&#20123;&#36731;&#37327;&#32423;&#30340;cache&#26041;&#26696;&#20063;&#22522;&#20110;JXTA/JGroups&#25903;&#25345;&#20102;&#20998;&#24067;&#24335;&#12290;</p><p>&#20998;&#24067;&#24335;&#32531;&#23384;&#26356;&#26032;&#23545;&#35937;&#26102;&#65292;&#20250;&#20351;&#29992;&#33258;&#23454;&#29616;&#30340;Field&#32423;&#21464;&#21270;&#22797;&#21046;&#65292;&#32780;&#19981;&#26159;&#25928;&#29575;&#36739;&#20302;&#22320;&#35753;&#25972;&#20010;Java&#23545;&#35937;&#20018;&#34892;&#21270;&#20256;&#36755;&#20063;&#24456;&#37325;&#35201;&#12290;</p><p>&#21478;&#22806;&#20998;&#24067;&#24335;&#32531;&#23384;&#36824;&#26377;&#19968;&#31181;&#38656;&#27714;&#65292;&#23601;&#26159;&#24212;&#29992;&#26356;&#25913;&#25968;&#25454;&#24211;&#25968;&#25454;&#21518;&#65292;&#21487;&#20197;&#36890;&#30693;&#25152;&#26377;&#32531;&#23384;&#38598;&#32676;&#30340;&#33410;&#28857;&#65292;Ehcache&#30340;JMS Replicator&#25552;&#20379;&#20102;&#19968;&#31181;&#26631;&#20934;&#30340;&#26041;&#26696;&#65292;&#32780;&#26080;&#38656;&#22823;&#23478;&#33258;&#34892;&#29992;JMS&#23454;&#29616;&#12290;</p></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e2209"></a>20.1.3.&nbsp;Ehcache</h3></div></div></div><p>Ehcache&#26368;&#36817;&#39118;&#22836;&#29978;&#21170;&#65292;&#36880;&#27493;&#25670;&#33073;OSCache&#65292;JBossCache&#31561;&#32769;&#31454;&#20105;&#23545;&#25163;&#12290;</p></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e2212"></a>20.1.4.&nbsp;TerraCotta</h3></div></div></div><p>TerraCotta&#26377;&#36259;&#30340;JVM&#32423;AOP&#30340;&#36879;&#26126;POJO&#38598;&#32676;&#26041;&#26696;&#12290;</p></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e2215"></a>20.1.5.&nbsp;Memcached</h3></div></div></div><p>Memcached&#25903;&#25345;.Net&#65292;Java&#65292;C&#65292;Ruby&#65292;Php&#31561;&#35821;&#35328;&#30340;&#20998;&#24067;&#24335;&#32531;&#23384;&#31995;&#32479;&#12290;&#26412;&#36136;&#23601;&#26159;&#24314;&#19968;&#32452;TCP Server&#65292;&#27599;&#20010;Server&#37324;&#38754;&#25918;&#19968;&#20010;HashMap&#12290;LiveJournal&#24320;&#21457;&#65292;Facebook&#31561;&#32593;&#31449;&#22343;&#20351;&#29992;&#12290;</p><p>Memcached&#30340;&#38598;&#32676;&#26041;&#26696;&#65306;&#27599;&#20010;&#26381;&#21153;&#23454;&#20363;&#38388;&#27809;&#26377;&#22797;&#21046;/HA&#30340;&#21151;&#33021;&#12290;&#22312;client&#31471;hash(key)&#20915;&#23450;&#23384;&#20648;&#22312;&#21738;&#21488;&#65292;&#22240;&#20026;hash&#31639;&#27861;&#27010;&#29575;&#22266;&#23450;&#65292;&#25152;&#20197;&#30828;&#20214;&#36739;&#22909;&#30340;&#26381;&#21153;&#22120;&#19978;&#21487;&#20197;&#22810;&#36215;&#20960;&#20010;&#23454;&#20363;&#12290;</p><p>&#23458;&#25143;&#31471;hash&#31639;&#27861;&#65292;&#20256;&#32479;&#26159;&#26368;&#31616;&#21333;&#30340;CRC32(key) mod N( N&#26159;&#23454;&#20363;&#25968;)&#65292;&#20294;&#22914;&#26524;&#21152;&#20837;&#25110;&#20943;&#23569;&#26381;&#21153;&#22120;&#65292;N&#25913;&#21464;&#20250;&#23548;&#33268;&#25152;&#26377;&#30340;&#32531;&#23384;&#20301;&#32622;&#31227;&#20301;&#12290;&#25152;&#20197;&#26032;&#30340;Consistent Hashing&#65292;&#20808;&#36873;&#19968;&#23450;&#33539;&#22260;&#30340;&#25968;&#23383;&#32452;&#25104;&#19968;&#20010;&#22278;&#22280;&#65292;&#27604;&#22914;0...100&#65292;&#28982;&#21518;&#25226;server url hash&#25104;&#25968;&#23383;&#65292;key&#20063;hash&#25104;&#25968;&#23383;&#65292;cache&#23601;&#23384;&#25918;&#22312;hash(server)&#22312;hash(key)&#22312;&#39034;&#26102;&#38024;&#26041;&#21521;&#19978;&#22823;&#19968;&#28857;&#30340;server&#37324;&#12290;&#36825;&#26679;&#22686;&#20943;&#26381;&#21153;&#23454;&#20363;&#65292;&#21482;&#20250;&#24433;&#21709;&#30456;&#37051;&#30340;&#20004;&#20010;&#26381;&#21153;&#23454;&#20363;&#38388;&#30340;&#19968;&#20123;cache</p><div class="itemizedlist"><ul type="disc"><li><p>&#20351;&#29992;memcached&#36827;&#34892;&#20869;&#23384;&#32531;&#23384;</p></li><li><p>Distributed Caching with Memcached</p></li><li><p>memcached &#35828;&#26126;part1&#65292;part2</p></li><li><p>FAQ</p></li></ul></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e2229"></a>20.1.6.&nbsp;Others</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Tangosol Coherence Oracle&#26071;&#19979;&#65292;&#26368;&#36149;&#26368;&#26435;&#23041;&#30340;&#20998;&#24067;&#24335;&#32531;&#23384;&#26041;&#26696;&#12290;</p></li><li><p>Gigaspaces Data Grid&#26041;&#26696;&#12290;</p></li><li><p>GemFire &#32769;&#29260;&#21378;&#21830;&#12290;</p></li><li><p>JBossCache &#20256;&#32479;&#30340;&#24320;&#28304;&#26041;&#26696;&#12290;</p></li></ul></div></div></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e2240"></a>20.2.&nbsp;Ehcache</h2></div></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e2242"></a>20.2.1.&nbsp;Overview</h3></div></div></div><p>Ehcache&#20174;Hibernate&#21457;&#23637;&#32780;&#26469;&#65292;&#36880;&#28176;&#28085;&#30422;&#20102;Cahce&#30028;&#30340;&#20840;&#37096;&#21151;&#33021;&#65292;&#26159;&#30446;&#21069;&#21457;&#23637;&#21183;&#22836;&#26368;&#22909;&#30340;&#19968;&#20010;&#39033;&#30446;&#12290;</p><div class="itemizedlist"><ul type="disc"><li><p>&#26631;&#20934;&#32531;&#23384;</p></li><li><p>&#20998;&#24067;&#24335;&#32531;&#23384;(&#22522;&#20110;RMI/JGroups/JMS)</p></li><li><p>URL&#65292;&#39029;&#38754;&#29255;&#27573;&#32531;&#23384;(&#31867;&#20284;OSCache&#30340;&#30456;&#20851;&#37096;&#20998;)</p></li><li><p>&#20013;&#22830;&#32531;&#23384;&#26381;&#21153;&#22120;(&#31867;&#20284;Memcached)</p></li></ul></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e2254"></a>20.2.2.&nbsp;&#22522;&#26412;&#21151;&#33021;&#19982;&#37197;&#32622;</h3></div></div></div><p>Ehcache&#30340;&#22522;&#26412;&#21151;&#33021;&#65292;&#21487;&#20197;&#20174;&#37197;&#32622;&#25991;&#20214;&#20013;&#23398;&#20064;&#12290;&#35814;&#35265;Ehcache&#30340;&#25991;&#26723;&#12290;</p><p>&#24635;&#30340;&#26469;&#35828;&#65292;&#32531;&#23384;&#19982;HashMap&#30340;&#26368;&#22823;&#19981;&#21516;&#65292;&#23601;&#26159;&#32531;&#23384;&#35774;&#24819;&#20869;&#23384;&#26159;&#26377;&#38480;&#30340;&#65292;&#32531;&#23384;&#30340;&#26102;&#25928;&#24615;&#20063;&#26159;&#26377;&#38480;&#30340;&#65292;&#25152;&#20197;&#21487;&#20197;&#35774;&#23450;&#20869;&#23384;&#25968;&#37327;&#30340;&#22823;&#23567;&#65292;&#21487;&#20197;&#25191;&#34892;&#22833;&#25928;&#31639;&#27861;&#65292;&#21487;&#20197;&#22312;&#20869;&#23384;&#28385;&#20102;&#30340;&#26102;&#20505;&#65292;&#25353;&#29031;&#26368;&#23569;&#35775;&#38382;&#31561;&#31639;&#27861;&#23558;&#32531;&#23384;&#30452;&#25509;&#31227;&#38500;&#25110;&#20999;&#25442;&#21040;&#30828;&#30424;&#19978;&#12290;</p><p>&#21478;&#22806;&#27880;&#24847;&#65292;ehcache&#30340;CacheManager&#26412;&#36523;&#26377;&#19968;&#23450;&#30340;&#40664;&#35748;&#20540;&#12290;&#32780;&#22312;&#27809;&#26377;&#25351;&#23450;ehcache.xml&#30340;&#24773;&#20917;&#19979;&#65292;&#20250;&#20351;&#29992;ehcache.jar&#37324;&#33258;&#24102;&#30340;ehcache_failsafe.xml&#12290;</p><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e2259"></a>20.2.2.1.&nbsp;&#23545;&#35937;&#22312;&#20869;&#23384;&#20013;&#30340;&#26368;&#22823;&#25968;&#37327;</h4></div></div></div><p>&#22240;&#20026;&#20869;&#23384;&#26159;&#26377;&#38480;&#30340;&#65292;&#25152;&#20197;&#24517;&#39035;&#29992;maxElementsInMemory(&#24517;&#22635;&#39033;)&#35774;&#32622;&#27599;&#31867;&#23545;&#35937;&#22312;&#20869;&#23384;&#20013;&#30340;&#26368;&#22823;&#25968;&#37327;&#12290;ehcache_failsafe.xml&#20013;&#20026;10000&#12290;</p></div><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e2262"></a>20.2.2.2.&nbsp;&#21040;&#36798;&#20869;&#23384;&#20013;&#26368;&#22823;&#37327;&#26102;&#30340;&#36807;&#26399;/&#31227;&#20986;&#31639;&#27861;</h4></div></div></div><p>&#36807;&#26399;&#31639;&#27861;&#65306;&#22914;&#26524;&#32531;&#23384;&#24050;&#32463;&#22833;&#25928;&#65292;&#20154;&#36947;&#27585;&#28781;&#20043;&#12290;&#22833;&#25928;&#31639;&#27861;&#30001;3&#20010;&#21442;&#25968;&#32452;&#25104;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>eternal(&#24517;&#22635;&#39033;)&#65306;&#22914;&#26524;&#20026;true&#65292;&#21017;&#27704;&#19981;&#36807;&#26399;&#65292;&#24573;&#30053;&#21518;&#20004;&#20010;&#21442;&#25968;&#30340;&#35774;&#32622;&#12290;ehcache_failsafe.xml &#20026;false&#12290;</p></li><li><p>timeToIdleSeconds&#65306;&#31354;&#38386;&#26080;&#35775;&#38382;&#26102;&#38388;&#65292;&#40664;&#35748;&#20026;0&#65292;&#27704;&#19981;&#36807;&#26102;&#12290;ehcache_failsafe.xml&#35774;&#20026;120&#31186;&#12290;</p></li><li><p>timeToLiveSeconds&#65306;&#31354;&#38386;&#26080;&#35775;&#38382;&#26102;&#38388;&#65292;&#40664;&#35748;&#20026;0&#65292;&#27704;&#19981;&#36807;&#26102;&#12290;ehcache_failsafe.xml &#35774;&#20026;120&#31186;&#12290;</p></li></ul></div><p>&#31227;&#20986;&#31639;&#27861;&#65306;&#22914;&#26524;&#32463;&#36807;&#22833;&#25928;&#31639;&#27861;&#21518;&#65292;&#36824;&#26159;&#26377;&#24456;&#22810;&#26377;&#25928;&#30340;&#32531;&#23384;&#65292;&#21017;&#25191;&#34892;&#28165;&#38500;&#31639;&#27861;&#12290;&#28165;&#38500;&#31639;&#27861;&#30001;&#20004;&#20010;&#21442;&#25968;&#32452;&#25104;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>memoryStoreEvictionPolicy: &#40664;&#35748;&#20026;LRU(&#26368;&#36817;&#26368;&#23569;&#35775;&#38382;),&#21478;&#26377;&#20808;&#36827;&#20808;&#20986;(FIFO)&#65292;&#26368;&#23569;&#35775;&#38382;&#27425;&#25968;(LFU)</p></li><li><p>overflowToDisk(&#24517;&#22635;&#39033;) &#20026;true&#65292;&#21017;&#23558;&#28165;&#38500;&#20986;&#26469;&#30340;&#32531;&#23384;&#25345;&#20037;&#21270;&#21040;&#30913;&#30424;&#65292;&#21542;&#21017;&#20154;&#36947;&#27585;&#28781;&#20043;&#12290;</p></li></ul></div></div><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e2278"></a>20.2.2.3.&nbsp;&#20648;&#23384;&#21040;&#30828;&#30424;</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>maxElementsOnDisk&#65306;&#40664;&#35748;&#20026;0&#65292;&#26080;&#38480;&#22810;&#12290;ehcache_failsafe.xml&#20026;10000000&#12290;</p></li><li><p>diskExpiryThreadIntervalSeconds&#65306;&#20351;&#29992;&#36807;&#26399;&#31639;&#27861;&#28165;&#38500;&#30913;&#30424;&#20013;&#22833;&#25928;&#23545;&#35937;&#30340;&#38388;&#38548;&#65292;&#40664;&#35748;&#20026;120&#31186;&#12290;</p></li><li><p>diskSpoolBufferSizeMB&#65292;&#40664;&#35748;&#20026;30M&#12290;</p></li></ul></div></div><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e2287"></a>20.2.2.4.&nbsp;&#37325;&#21551;&#26102;&#32531;&#23384;&#25345;&#20037;&#21270;</h4></div></div></div><p>diskPersistent&#24403;&#24212;&#29992;&#37325;&#21551;&#26102;&#65292;&#21487;&#23558;&#32531;&#23384;&#20808;&#25345;&#20037;&#21270;&#21040;&#30828;&#30424;&#65292;&#37325;&#21551;&#21518;&#20877;&#34892;&#36733;&#20837;&#65292;&#33410;&#30465;&#22823;&#37327;&#30340;&#37325;&#26032;&#20174;&#25968;&#25454;&#24211;&#36733;&#20837;&#12290;&#20294;&#21482;&#36866;&#21512;&#37027;&#20123;&#32531;&#23384;&#19981;&#24590;&#20040;&#21464;&#21270;&#65292;&#25110;&#32773;&#26377;&#29305;&#27530;&#26426;&#21046;&#20445;&#35777;&#37325;&#21551;&#21518;&#24212;&#29992;&#33021;&#25509;&#25910;&#21040;&#37325;&#21551;&#36825;&#27573;&#26102;&#38388;&#37324;&#32531;&#23384;&#21464;&#21270;&#20449;&#24687;&#30340;&#24773;&#20917;&#12290;</p></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e2290"></a>20.2.3.&nbsp;&#20998;&#24067;&#24335;&#32531;&#23384;</h3></div></div></div><p>Ehcache&#26377;&#20256;&#32479;&#30340;RMI&#65292;1.5&#29256;&#30340;JGroups&#65292;1.6&#29256;&#30340;JMS&#65292;&#38543;&#22823;&#27969;&#36824;&#26159;&#20808;&#29992;RMI&#30340;&#22909;&#20123;&#12290;</p><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e2293"></a>20.2.3.1.&nbsp;&#35774;&#32622;&#33258;&#36523;</h4></div></div></div><p>&#36825;&#37324;&#35774;&#32622;&#22312;localhost&#30340;40001&#31471;&#21475;&#19978;&#20390;&#21548;&#12290;&#22914;&#26524;&#35201;&#20114;&#30456;&#21516;&#27493;&#30340;CahceManager&#19981;&#37117;&#22312;&#19968;&#21488;&#26426;&#22120;&#19978;&#30340;&#35805;&#65292;hostName&#24212;&#35813;&#26159;&#23454;&#38469;IP&#12290;)</p><pre class="programlisting">
&lt;cacheManagerPeerListenerFactory class="net.sf.ehcache.distribution.RMICacheManagerPeerListenerFactory"
    properties="hostName=localhost,port=40001,socketTimeoutMillis=2000" /&gt;
                    </pre></div><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e2297"></a>20.2.3.2.&nbsp;&#35774;&#32622;&#38656;&#35201;&#21516;&#27493;&#30340;&#23545;&#26041;&#26381;&#21153;&#22120;&#21450;&#32531;&#23384;&#23545;&#35937;</h4></div></div></div><p>&#36825;&#37324;&#35774;&#32622;&#19982;40002&#31471;&#21475;&#19978;&#30340;CacheManager&#21516;&#27493;User&#19982;Role&#23545;&#35937;&#65292;&#22914;&#26524;&#36824;&#26377;&#31532;&#19977;&#21488;&#26426;&#22120;&#65292;&#21017;&#32487;&#32493;&#29992;|&#20998;&#21106;&#65292;&#32487;&#32493;&#24448;&#19979;&#21015;&#12290;&#21516;&#29702;&#65292;&#22312;40002&#31471;&#21475;&#19978;&#30340;cacheManager&#30340;ehcache.xml&#37324;&#65292;&#23601;&#38656;&#35201;&#37197;&#32622;&#19982;400001,40003&#30340;&#20114;&#36890;&#12290;</p><p>&#20063;&#26377;&#33258;&#21160;&#21457;&#29616;&#65292;&#24191;&#25773;&#30340;&#31616;&#21333;&#37197;&#27861;&#65292;&#20294;&#23545;&#24191;&#25773;&#22825;&#28982;&#24656;&#24807;&#65292;&#36824;&#26159;&#36763;&#33510;&#19968;&#28857;&#19968;&#20010;&#20010;&#38745;&#24577;&#21015;&#34920;&#37197;&#32622;&#25991;&#20214;&#30340;&#20889;&#20102;&#65292;&#34429;&#28982;&#26377;&#28857;&#28902;&#12290;</p><pre class="programlisting">
&lt;cacheManagerPeerProviderFactory class="net.sf.ehcache.distribution.RMICacheManagerPeerProviderFactory"
    properties="peerDiscovery=manual,
    rmiUrls=//localhost:40002/com.family168.User|//localhost:40002/com.family168.Role"/&gt;
                </pre></div><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e2302"></a>20.2.3.3.&nbsp;&#32531;&#23384;&#23545;&#35937;&#30340;&#37197;&#32622;</h4></div></div></div><p>&#24448;&#27599;&#19968;&#20010;&#38656;&#35201;&#32531;&#23384;&#30340;&#23545;&#35937;&#21152;&#20837;&#23376;&#23545;&#35937;cacheEventListenerFactory</p><pre class="programlisting">
&lt;cacheEventListenerFactory class="net.sf.ehcache.distribution.RMICacheReplicatorFactory"
    properties="replicateAsynchronously=true,
    replicatePuts=true,
    replicateUpdates=true,
    replicateUpdatesViaCopy=true,
    replicateRemovals=true
    asynchronousReplicationIntervalMillis=100"
    propertySeparator="," /&gt;
                </pre><div class="itemizedlist"><ul type="disc"><li><p>replicateAsynchronously&#23545;&#35937;&#21516;&#27493;&#26159;&#21542;&#24322;&#27493;&#23436;&#25104;&#65292;&#40664;&#35748;&#20026;true&#12290;&#22914;&#26524;&#27604;&#36739;&#32039;&#24613;&#23601;&#35774;&#20026;false&#12290;</p><p>&#22312;&#19968;&#33268;&#24615;&#26102;&#38388;&#24615;&#35201;&#27714;&#19981;&#24378;&#30340;&#26102;&#20505;&#65292;&#35774;&#20026;&#24322;&#27493;&#21487;&#22823;&#22823;&#25552;&#20379;&#24615;&#33021;&#65292;&#22240;&#20026;&#23427;&#26159;&#24322;&#27493;&#31435;&#21363;&#36820;&#22238;&#30340;&#65292;&#32780;&#19988;&#21487;&#20197;&#25209;&#37327;&#25552;&#20132;&#12290;</p></li><li><p>replicateUpdatesViaCopy &#26159;&#21542;&#23558;&#23545;&#35937;&#21464;&#26356;&#22797;&#21046;&#21040;&#25152;&#26377;&#33410;&#28857;&#65292;&#36824;&#26159;&#21482;&#26159;&#21457;&#36865;&#19968;&#20010;&#22833;&#25928;&#20449;&#24687;&#65292;&#35753;&#23545;&#26041;&#35813;&#32531;&#23384;&#22833;&#25928;&#65292;&#24403;&#23545;&#26041;&#38656;&#35201;&#35813;&#32531;&#23384;&#26102;&#37325;&#26032;&#35745;&#31639;&#36733;&#20837;&#12290;</p><p>&#40664;&#35748;&#20026;true&#12290;&#37492;&#20110;&#23545;&#35937;&#22797;&#21046;&#30340;&#28040;&#32791;&#25402;&#22823;&#30340;&#65292;&#21448;&#26377;&#38145;&#30340;&#38382;&#39064;&#65292;&#32780;&#19988;&#23545;&#26041;&#20063;&#26410;&#24517;&#38656;&#35201;&#35813;&#23545;&#35937;&#65292;&#25152;&#20197;&#27492;&#23646;&#24615;&#24314;&#35758;&#35774;&#20026;false&#12290;&#22914;&#26524;&#19994;&#21153;&#19978;&#30495;&#30340;&#38656;&#35201;&#35774;&#20026;true&#26102;&#65292;&#23601;&#21487;&#32771;&#34385;&#20351;&#29992;Terracotta&#20102;&#12290;</p></li><li><p>replicatePuts&#12289;replicateUpdates&#12289;replicateRemovals&#22686;&#21024;&#25913;&#26159;&#21542;&#21516;&#27493;&#65292;&#40664;&#35748;&#37117;&#20026;true&#12290;&#20294;&#22240;&#20026;&#25105;&#20204;&#21069;&#38754;&#36873;&#25321;&#20102;&#22833;&#25928;&#31639;&#27861;&#65292;&#25152;&#20197;replicatePuts&#35201;&#35774;&#20026;false&#12290;</p></li></ul></div><p>&#25152;&#20197;&#25105;&#20204;&#19968;&#33324;&#30340;&#35774;&#32622;&#22914;&#19979;&#65306;</p><pre class="programlisting">
&lt;cache name="com.family168.User"
    maxElementsInMemory="500"
    overflowToDisk="true"
    eternal="true"&gt;
    &lt;cacheEventListenerFactory class="net.sf.ehcache.distribution.RMICacheReplicatorFactory"
        properties="replicateAsynchronously=false,replicatePuts=false,replicateUpdatesViaCopy=false" /&gt;
&lt;/cache&gt;
                </pre></div><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e2317"></a>20.2.3.4.&nbsp;Shutdown</h4></div></div></div><p>&#22312;&#20998;&#24067;&#24335;&#29615;&#22659;&#25110;&#25345;&#20037;&#21270;&#30828;&#30424;&#26102;&#65292;&#38656;&#35201;&#35843;&#29992;CacheManager&#30340;shutdown&#25805;&#20316;&#65292;Hibernate&#20250;&#33258;&#21160;shutdown&#23427;&#33258;&#24049;&#30340;cacheManager&#65292;&#22914;&#26524;&#22312;hibernate&#20043;&#22806;&#20351;&#29992;&#65292;&#20320;&#38656;&#35201;&#22686;&#21152;&#65306;</p><pre class="programlisting">
&lt;listener&gt;
    &lt;listener-class&gt;net.sf.ehcache.constructs.web.ShutdownListener&lt;/listener-class&gt;
&lt;/listener&gt;
                </pre></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e2321"></a>20.2.4.&nbsp;JMS&#24335;&#24182;&#21457;&#21516;&#27493;</h3></div></div></div><p>&#19982;&#20854;&#20182;&#21516;&#27493;&#26041;&#24335;&#30456;&#27604;&#65292;JMS&#21516;&#27493;&#25903;&#25345;&#20102;&#38750;Cache&#33410;&#28857;&#30340;&#31243;&#24207;&#23545;Cahce&#30340;&#20462;&#25913;&#12290;</p><p>&#22312;&#20998;&#24067;&#24335;&#32531;&#23384;&#20013;&#26377;&#19968;&#31181;&#38656;&#27714;&#65306;&#24212;&#29992;&#33410;&#28857;&#26356;&#25913;&#25968;&#25454;&#24211;&#25968;&#25454;&#21518;&#65292;&#38656;&#35201;&#36890;&#30693;&#25152;&#26377;&#32531;&#23384;&#38598;&#32676;&#30340;&#33410;&#28857;&#65292;&#36890;&#24120;&#22823;&#23478;&#37117;&#26159;&#33258;&#34892;&#36890;&#36807;JMS&#23454;&#29616;&#30340;&#65292;&#32780;Ehcache&#30340;JMS Replicator&#25552;&#20379;&#20102;&#19968;&#31181;&#26631;&#20934;&#30340;&#26041;&#26696;&#65292;&#25552;&#20379;PUT,REMOVE,REMOVE_ALL&#30340;&#26631;&#20934;&#25805;&#20316;&#12290;</p></div></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e2325"></a>20.3.&nbsp;Ehcache&#36873;&#22411;</h2></div></div></div><p>Ehcache&#26159;&#26368;&#36817;&#21457;&#23637;&#21183;&#22836;&#26368;&#22909;&#30340;&#24320;&#28304;&#36731;&#37327;&#32423;Cache&#26041;&#26696;&#65292;&#28085;&#30422;&#20102;&#26222;&#36890;&#32531;&#23384;&#65292;&#36731;&#37327;&#32423;&#32531;&#23384;&#65292;URL/&#39029;&#38754;&#20869;&#23481;&#32531;&#23384;&#65292;&#20013;&#22830;&#32531;&#23384;&#26381;&#21153;&#22120;&#31561;&#26041;&#38754;&#65292;OSCahce&#27809;&#21160;&#38745;&#20102;&#65292;&#32780;JBossCache&#27604;&#36739;&#37325;&#22823;&#12290;</p><p>&#20027;&#35201;&#20316;&#20026;Hibernate&#30340;&#20108;&#32423;&#32531;&#23384;&#65292;&#26085;&#21518;&#36824;&#20250;&#29992;&#21040;&#26356;&#22810;&#22320;&#26041;&#12290;</p><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e2329"></a>20.3.1.&nbsp;DefaultCache</h3></div></div></div><p>&#23545;&#35937;&#30340;&#40664;&#35748;&#37197;&#32622;&#65292;&#30456;&#23545;&#20110;ehcache-safe.xml&#20013;&#30340;&#35774;&#32622;&#65292;&#21152;&#22823;&#20102;timeToIdleSeconds&#65292;timeToLiveSecond, diskExpiryThreadIntervalSeconds&#19977;&#39033;&#30340;&#20540;&#12290;</p><p>&#22312;&#20869;&#23384;&#20013;&#26368;&#22810;10000&#20010;&#23545;&#35937;&#65292;Idle&#31354;&#38386;1&#23567;&#26102;&#65292;&#23384;&#22312;100000&#31186;&#20043;&#21518;&#36807;&#26399;&#12290;&#23545;&#35937;&#36798;&#21040;10000&#20010;&#21518;&#65292;&#25353;&#26368;&#36817;&#35775;&#38382;&#31639;&#27861;&#20999;&#25442;&#21040;&#30828;&#30424;&#20013;&#65292;&#30828;&#30424;&#20013;&#26368;&#22810;10000000&#20010;&#23545;&#35937;&#65292;&#27599;600&#31186;&#25195;&#25551;&#19968;&#27425;&#30913;&#30424;&#20013;&#30340;&#36807;&#26399;&#23545;&#35937;&#12290;&#37325;&#21551;&#26102;&#20869;&#23384;&#19981;&#25345;&#20037;&#21270;&#21040;&#30828;&#30424;&#12290;</p><pre class="programlisting">
&lt;defaultCache maxElementsInMemory="10000"
    overflowToDisk="true"
    eternal="false"
    memoryStoreEvictionPolicy="LRU"
    maxElementsOnDisk="10000000"
    diskExpiryThreadIntervalSeconds="600"
    timeToIdleSeconds="3600"
    timeToLiveSeconds="100000"
    diskPersistent="false" /&gt;
            </pre></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e2334"></a>20.3.2.&nbsp;Cache</h3></div></div></div><p>Cache&#19968;&#33324;&#20250;&#22312;&#40664;&#35748;&#37197;&#32622;&#22522;&#30784;&#19978;&#36827;&#34892;&#37197;&#32622;&#65292;&#27604;&#22914;User&#23545;&#35937;&#30340;&#37197;&#32622;&#65292;&#23601;&#22240;&#20026;&#29992;&#25143;&#23545;&#35937;&#21407;&#26412;&#23601;&#19981;&#22810;&#65292;&#25152;&#20197;&#35774;&#26368;&#22810;500&#20010;&#23545;&#35937;&#65292;&#27704;&#19981;&#36807;&#26399;&#65292;&#21040;&#36798;500&#21518;&#25353;&#40664;&#35748;&#30340;&#26368;&#36817;&#35775;&#38382;&#31639;&#27861;&#20999;&#25442;&#21040;&#30828;&#30424;&#20013;&#65292;&#30828;&#30424;&#22823;&#23567;&#26080;&#38480;&#12290;</p><p>&#21516;&#26102;&#65292;&#20351;&#29992;&#21516;&#27493;&#21457;&#36865;&#22833;&#25928;&#28040;&#24687;&#30340;&#26041;&#24335;&#23454;&#29616;&#26381;&#21153;&#22120;&#38388;&#20108;&#32423;&#32531;&#23384;&#30340;&#21516;&#27493;&#12290;&#22833;&#25928;&#28040;&#24687;&#21578;&#35785;&#23545;&#26041;&#35813;&#32531;&#23384;&#24050;&#22833;&#25928;&#12290;&#22914;&#26524;&#38656;&#35201;&#26102;&#37325;&#26032;&#20174;&#25968;&#25454;&#24211;&#31561;&#22320;&#26041;&#36733;&#20837;&#12290;</p><pre class="programlisting">
&lt;cache name="org.springside.examples.miniweb.entity.user.User"
    maxElementsInMemory="500"
    overflowToDisk="true"
    eternal="true"&gt;
    &lt;cacheEventListenerFactory class="net.sf.ehcache.distribution.RMICacheReplicatorFactory"
        properties="replicatePuts=false,replicateUpdatesViaCopy=false" /&gt;
&lt;/cache&gt;
            </pre></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e2339"></a>20.3.3.&nbsp;&#20998;&#24067;&#24335;</h3></div></div></div><p>&#35265;resources/ehcache/ehcache-cluster1.xml  &#21644; resources/ehcache/ehcache-cluster2.xml&#65292;&#37319;&#29992;&#30456;&#23545;&#25104;&#29087;&#30340;RMI&#26426;&#21046;&#65292;&#26085;&#21518;&#20250;&#20999;&#25442;&#21040;JGroups.</p></div></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e2342"></a>20.4.&nbsp;AOP&#24335;&#32531;&#23384;</h2></div></div></div><p>&#20351;&#29992;ehcache&#30340;&#25130;&#33719;&#26041;&#27861;&#30340;&#36820;&#22238;&#20540;&#65292;&#19979;&#27425;&#20877;&#35843;&#29992;&#35813;&#26041;&#27861;&#26102;&#65292;&#36890;&#36807;AOP&#25130;&#33719;&#20854;&#35831;&#27714;&#65292;&#30452;&#25509;&#36820;&#22238;Cache&#20013;&#30340;&#25968;&#20540;&#32780;&#19981;&#20877;&#37325;&#26032;&#25191;&#34892;&#26041;&#27861;&#26159;&#19968;&#20010;&#24456;&#19981;&#38169;&#30340;&#24819;&#27861;&#12290;&#32780;&#19988;&#36890;&#36807;AOP&#65292;&#21487;&#20197;&#20351;&#36825;&#19968;&#27169;&#24335;&#25104;&#20026;&#36890;&#29992;&#30340;&#26041;&#27861;&#65292;&#22312;&#37197;&#32622;&#25991;&#20214;&#20013;&#25209;&#37327;&#23450;&#20041;&#38656;&#35201;&#32531;&#23384;&#30340;&#26041;&#27861;&#65292;&#26080;&#38656;&#26356;&#25913;&#20195;&#30721;&#12290;</p><p>cache&#26041;&#26696;&#20013;ehcache&#30340;API&#26368;&#20026;&#31616;&#21333;&#65292;&#32780;Spring AOP 2.0&#36890;&#36807;&#20854;&#37197;&#32622;&#25991;&#20214;&#30340;&#22823;&#24133;&#31616;&#21270;&#65292;&#20197;&#21450;aspectJ pointcut&#35821;&#35328;&#30340;&#24341;&#20837;&#65292;&#20063;&#20351;&#25209;&#37327;&#23450;&#20041;AOP + Ehcache&#25104;&#20026;&#20102;&#21487;&#33021;&#12290;</p><p>&#25105;&#20204;&#22312;&#26597;&#35810;&#30340;&#26102;&#20505;&#32531;&#23384;&#32467;&#26524;&#65292;&#22312;&#26356;&#26032;&#30340;&#26102;&#20505;&#21047;&#26032;&#32531;&#23384;&#12290;</p><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e2347"></a>20.4.1.&nbsp;&#20934;&#22791;&#24037;&#20316;</h3></div></div></div><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e2349"></a>20.4.1.1.&nbsp;&#32531;&#23384;&#26597;&#35810;&#32467;&#26524;</h4></div></div></div><pre class="programlisting">
public Object invoke(MethodInvocation invocation) throws Throwable {
    Element element = methodCache.get(cacheKey);
    if (element == null) {
        result = invocation.proceed();
        element = new Element(cacheKey, (Serializable) result);
        methodCache.put(element);
    }
    return element.getValue();
}
                </pre></div><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e2352"></a>20.4.1.2.&nbsp;&#21047;&#26032;&#32531;&#23384;</h4></div></div></div><pre class="programlisting">
public void afterReturning(Object returnValueObject, Method method,
                        Object[] args, Object target) throws Throwable {
    Element element = methodCache.get(cacheKey);
    if (element != null) {
        methodCache.remove(cacheKey);
    }
}
                </pre></div><div class="sect3" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="d4e2355"></a>20.4.1.3.&nbsp;&#37197;&#32622;Advice</h4></div></div></div><pre class="programlisting">
&lt;bean id="lowStockBookFlushingAdvice" class="org.springside.framework.spring.aopcache.FlushingInterceptor"&gt;
    &lt;property name="cacheKeys" value="LowStockBooks"/&gt;
&lt;/bean&gt;
&lt;bean id="lowStockBookCachingAdvice" class="org.springside.framework.spring.aopcache.CachingInterceptor"&gt;
    &lt;property name="cacheKey" value="LowStockBooks"/&gt;
&lt;/bean&gt;
                </pre></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="d4e2358"></a>20.4.2.&nbsp;&#20351;&#29992;AOP</h3></div></div></div><p>Spring 2.0 &#32467;&#21512;AspectJ pointcut&#35821;&#27861;&#30340;&#22823;&#24133;&#31616;&#21270;&#65292;&#23545;&#27604;&#25105;&#20204;&#20197;&#20351;&#29992;ProxyFactoryBean&#37197;&#32622;AOP&#65292;&#31616;&#30452;&#26159;&#19968;&#20010;&#22825;&#19978;&#19968;&#20010;&#22320;&#19979;&#21834;&#12290;</p><pre class="programlisting">
&lt;aop:config proxy-target-class="true"&gt;
    &lt;aop:advisor pointcut="execution(* com.family168.*..UserManager.save(..))||execution(* com.family168.*..UserManager.remove(..))" advice-ref="lowStockBookFlushingAdvice"/&gt;
    &lt;aop:advisor pointcut="execution(* *..UserStockChecker.getLowStockBooks())" advice-ref="lowStockBookCachingAdvice"/&gt;
&lt;/aop:config&gt;
            </pre><p>&#20197;&#19978;&#20960;&#21477;&#23450;&#20041;&#20351;&#29992;cglib&#21019;&#24314;Proxy, &#20026;UserManager&#30340;save()&#21644;remove()&#21152;&#19978;lowStockBookFlushingAdvice&#65292;&#20026;UserStockChecker.getLowStockBooks&#21152;&#19978;lowStockBookCachingAdvice.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="logger.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="test.html">&#19979;&#19968;&#39029;</a></td></tr><tr><td width="40%" align="left" valign="top">&#31532;&nbsp;19&nbsp;&#31456;&nbsp;&#26085;&#24535;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">&#36215;&#22987;&#39029;</a></td><td width="40%" align="right" valign="top">&nbsp;&#31532;&nbsp;21&nbsp;&#31456;&nbsp;&#27979;&#35797;</td></tr></table></div></body></html>