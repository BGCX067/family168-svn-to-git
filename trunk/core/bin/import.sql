
drop schema PUBLIC cascade;

-- 部门
create table dept(
    id bigint, -- 主键
    name varchar(50), -- 部门名称
    the_sort integer, -- 排序
    descn varchar(200), -- 描述
    parent_id bigint -- 上级部门
);
alter table dept
    add constraint pk_dept primary key (id);
alter table dept
    alter column id bigint generated by default as identity (start with 1, increment by 1);
alter table dept
    add constraint fk_dept_parent
    foreign key (parent_id) references dept (id);

-- 菜单
create table menu(
    id bigint, -- 主键
    name varchar(50), -- 菜单名称
    image varchar(50), -- 图标
    url varchar(50), -- 链接
    the_sort integer, -- 排序
    descn varchar(200), -- 描述
    parent_id bigint -- 上级菜单
);
alter table menu
    add constraint pk_menu primary key (id);
alter table menu
    alter column id bigint generated by default as identity (start with 1, increment by 1);
alter table menu
    add constraint fk_menu_parent
    foreign key (parent_id) references menu (id);

-- 资源
create table resc(
    id bigint, -- 主键
    name varchar(50), -- 资源名称
    res_type varchar(50), -- 资源类型
    res_string varchar(200), -- 资源内容
    descn varchar(200) -- 描述
);
alter table resc
    add constraint pk_resc primary key (id);
alter table resc
    alter column id bigint generated by default as identity (start with 1, increment by 1);

-- 角色
create table role(
    id bigint, -- 主键
    name varchar(50), -- 角色名称
    descn varchar(200) -- 描述
);
alter table role
    add constraint pk_role primary key (id);
alter table role
    alter column id bigint generated by default as identity (start with 1, increment by 1);

-- 用户
create table user(
    id bigint, -- 主键
    username varchar(50), -- 用户名
    password varchar(50), -- 密码
    status integer, -- 状态
    descn varchar(200), -- 描述
    dept_id bigint -- 所在部门
);
alter table user
    add constraint pk_user primary key (id);
alter table user
    alter column id bigint generated by default as identity (start with 1, increment by 1);
alter table user
    add constraint fk_user_dept
    foreign key (dept_id) references dept (id);

-- 菜单角色
create table menu_role(
    menu_id bigint, -- 菜单主键
    role_id bigint -- 角色主键
);
alter table menu_role
    add constraint pk_menu_role primary key (menu_id, role_id);
alter table menu_role
    add constraint fk_menu_role_menu
    foreign key (menu_id) references menu (id);
alter table menu_role
    add constraint fk_menu_role_role
    foreign key (role_id) references role (id);

-- 资源角色
create table resc_role(
    resc_id bigint, -- 资源主键
    role_id bigint -- 角色主键
);
alter table resc_role
    add constraint pk_resc_role primary key (resc_id, role_id);
alter table resc_role
    add constraint fk_resc_role_resource
    foreign key (resc_id) references resc (id);
alter table resc_role
    add constraint fk_resc_role_role
    foreign key (role_id) references role (id);

-- 用户角色
create table user_role(
    user_id bigint, -- 用户主键
    role_id bigint -- 角色主键
);
alter table user_role
    add constraint pk_user_role primary key (user_id, role_id);
alter table user_role
    add constraint fk_user_role_user
    foreign key (user_id) references user (id);
alter table user_role
    add constraint fk_user_role_role
    foreign key (role_id) references role (id);

-- ACL_SID
create table acl_sid(
    id bigint, -- 主键
    principal integer, -- 主要的
    sid varchar(100) -- 权限内容
);
alter table acl_sid
    add constraint pk_acl_sid primary key (id);
alter table acl_sid
    alter column id bigint generated by default as identity (start with 100, increment by 1);
alter table acl_sid
    add constraint uk_acl_sid unique (sid, principal);

-- ACL_CLASS
create table acl_class(
    id bigint, -- 主键
    class varchar(100) -- 类名
);
alter table acl_class
    add constraint pk_scl_class primary key (id);
alter table acl_class
    alter column id bigint generated by default as identity (start with 100, increment by 1);
alter table acl_class
    add constraint uk_acl_class unique(class);

-- ACL_OBJECT_IDENTITY
create table acl_object_identity(
    id bigint, -- 主键
    object_id_class bigint, -- 对应class,
    object_id_identity bigint, -- 保存的是类的唯一标识
    parent_object bigint, -- 上级object_identity
    owner_sid bigint, -- 拥有者sid
    entries_inheriting integer -- 是否继承
);
alter table acl_object_identity
    add constraint pk_acl_object_identity primary key (id);
alter table acl_object_identity
    alter column id bigint generated by default as identity (start with 100, increment by 1);
alter table acl_object_identity
    add constraint uk_object_identity unique(object_id_class,object_id_identity);
alter table acl_object_identity
    add constraint fk_object_identity_parent_object
    foreign key (parent_object) references acl_object_identity (id);
alter table acl_object_identity
    add constraint fk_object_identity_object_id_class
    foreign key (object_id_class) references acl_class (id);
alter table acl_object_identity
    add constraint fk_object_identity_owner_sid
    foreign key (owner_sid) references acl_sid (id);

-- ACL_ENTRY
create table acl_entry(
    id bigint, -- 主键
    acl_object_identity bigint, -- 对应的类实例
    ace_order integer, -- 排序？
    sid bigint, -- 对应sid
    mask integer, -- 权限掩码
    granting integer, -- 是否授权
    audit_success integer, -- 是否验证成功
    audit_failure integer -- 是否验证失败
);
alter table acl_entry
    add constraint pk_acl_entry primary key (id);
alter table acl_entry
    alter column id bigint generated by default as identity (start with 100, increment by 1);
alter table acl_entry
    add constraint uk_acl_entry unique(acl_object_identity,ace_order);
alter table acl_entry
    add constraint fk_acl_entry_acl_object_identity
    foreign key (acl_object_identity) references acl_object_identity (id);
alter table acl_entry
    add constraint fk_acl_entry_sid
    foreign key (sid) references acl_sid (id);


---------------------------------------------------------------------
---------------------------------------------------------------------

insert into user(id,username,password,status,descn,dept_id)
    values(1,'test','098f6bcd4621d373cade4e832627b4f6',1,'',null);

commit;

shutdown;






